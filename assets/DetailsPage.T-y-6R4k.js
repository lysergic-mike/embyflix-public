import{d as e,r as a,p as t,i as o,o as s,a as l,c as r,l as i,f as n,q as u,b as d,F as c,e as v,z as m,n as f,t as p,h as y,k as h,u as g,B as w,g as I}from"./vue-vendor.BTt2NdZz.js";import{c as D,C as k,M as P,_ as E}from"./components.CrWKfICq.js";import{u as b,c as A,a as S,x as T,e as L,r as U,b as _,v as C,d as R,i as M,T as q}from"./composables.Ca-YutS5.js";const N={key:0,id:"content-container"},F={key:0,class:"tv-show-content"},O={class:"season-selector"},B={class:"season-buttons"},H=["onClick","onKeydown"],x={key:0,class:"episode-list"},K={class:"episodes-container"},W={class:"episodes-slider"},j=["onKeydown","onClick"],Y={class:"episode-image"},$=["src","alt"],z={key:0,class:"episode-runtime"},G={key:1,class:"episode-watched",title:"Watched"},V={class:"episode-info"},X={key:0,class:"episode-overview"},J={key:0,class:"episode-progress"},Q={key:1,class:"similar-titles"},Z={key:1,id:"content-container"},ee=E(e({__name:"DetailsPage",setup(e){const E=g(),ee=h(),ae=S(),te=b(),oe=_(),se=C(),le=A(oe,te,ae.isDemoMode),re=T(ae.isDemoMode),{formatRuntime:ie}=L(),{handleBack:ne}=U("Home"),ue=a(null),de=a([]),ce=a(null),ve=a([]),me=a([]),fe=a(0),pe=a(0),ye=a([]),he=a([]),ge=(e,a="Primary",t)=>{const o="Primary"===a?k.DETAILS_POSTER:void 0;return le.getImageUrl(e,a,t??o)},we=t(()=>ue.value?ge(ue.value.Id):""),Ie=a(""),De=a(""),ke=async e=>{try{const a=await le.getHeroImageUrl(e.Id);Ie.value=a,window.dispatchEvent(new CustomEvent("update-backdrop",{detail:a}))}catch(a){console.error("[DetailsPage] Failed to load backdrop image:",a),Ie.value="",window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""}))}},Pe=e=>{if(ae.isDemoMode.value)De.value="";else try{const a=oe.getImageUrl(e.Id,"Logo",500);De.value=a}catch(a){console.error("[DetailsPage] Failed to load logo image:",a),De.value=""}},Ee=t(()=>"Series"===ue.value?.Type),be=async e=>{if(ae.isDemoMode.value)return me.value=te.getSimilarItems(e.Id,15),void me.value.length;try{const a=await oe.getSimilarItems(e.Id,15);me.value=a,a.length}catch(a){console.error("[DetailsPage] Failed to load similar items:",a),me.value=[]}},Ae=async()=>{const e=ee.params.itemId;if(ae.isDemoMode.value)ue.value=te.getItemDetails(e)||null,ue.value&&(ke(ue.value),Pe(ue.value),"Series"===ue.value.Type&&await Te(ue.value.Id),be(ue.value));else try{const a=await oe.getItemDetails(e);ue.value=a,ke(a),Pe(a),"Series"===a.Type&&await Te(a.Id),be(a),re.startBrowseTracking(a)}catch(a){console.error("[DetailsPage] Failed to load item details:",a),ue.value=null}},Se=()=>{re.trackCurrentBrowseEvent()},Te=async e=>{if(ae.isDemoMode.value){const a=te.getSeasons(e);return de.value=a,void(a.length>0&&await _e(a[0]))}try{const a=await oe.getSeasons(e);de.value=a,a.length>0&&await _e(a[0])}catch(a){console.error("[DetailsPage] Failed to load seasons:",a)}},Le=e=>{let a=-1;for(let t=e.length-1;t>=0;t--)if(e[t].UserData?.Played){a=t;break}return a>=0?Math.min(a+1,e.length-1):0},Ue=()=>{w(()=>{setTimeout(()=>{const e=he.value[pe.value],a=document.querySelector(".episodes-slider");if(e&&a){const t=e.offsetLeft-20;a.scrollLeft=t}},150)})},_e=async e=>{if(ce.value=e,ue.value){if(ae.isDemoMode.value){const a=te.getEpisodes(ue.value.Id,e.Id);return ve.value=a,pe.value=Le(a),void Ue()}try{const a=await oe.getEpisodes(ue.value.Id,e.Id);ve.value=a,pe.value=Le(a),Ue()}catch(a){console.error("[DetailsPage] Failed to load episodes:",a)}}},Ce=()=>{ue.value&&("Series"===ue.value.Type&&ve.value.length>0?(se.pushToHistory("Player",void 0,{itemId:ve.value[0].Id}),E.push({name:"Player",params:{itemId:ve.value[0].Id}})):(se.pushToHistory("Player",void 0,{itemId:ue.value.Id}),E.push({name:"Player",params:{itemId:ue.value.Id}})))},Re=e=>{se.pushToHistory("Player",void 0,{itemId:e.Id}),E.push({name:"Player",params:{itemId:e.Id}})},Me=e=>{},qe=async e=>{if(!ae.isDemoMode.value)try{e.Id,await oe.markAsPlayed(e.Id),ue.value&&ue.value.UserData&&(ue.value.UserData.Played=!0),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as watched:",a)}},Ne=async e=>{if(!ae.isDemoMode.value)try{e.Id,await oe.markAsUnplayed(e.Id),ue.value&&ue.value.UserData&&(ue.value.UserData.Played=!1),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as unwatched:",a)}},Fe=e=>{const a=e;se.pushToHistory("Details",void 0,{itemId:a.Id}),E.push({name:"Details",params:{itemId:a.Id}})},Oe=a(!1),Be=()=>{E.push({name:"Home"})};o(()=>ee.params.itemId,(e,a)=>{e&&e!==a&&(Se(),ue.value=null,Ie.value="",De.value="",de.value=[],ce.value=null,ve.value=[],me.value=[],Ae())});const He=a(!1),xe=e=>{if(R(e),M(e,q.MEDIA_PLAY)||M(e,q.MEDIA_PLAY_PAUSE))return e.preventDefault(),void Ce();if(Ee.value&&ve.value.length>0){if(M(e,q.CHANNEL_UP)||M(e,q.MEDIA_TRACK_NEXT))return e.preventDefault(),void(pe.value<ve.value.length-1&&(pe.value++,w(()=>{he.value[pe.value]?.focus();const e=document.querySelector(".episodes-slider"),a=he.value[pe.value];if(e&&a){const t=a.offsetLeft-20;e.scrollTo({left:t,behavior:"smooth"})}})));if(M(e,q.CHANNEL_DOWN)||M(e,q.MEDIA_TRACK_PREVIOUS))return e.preventDefault(),void(pe.value>0&&(pe.value--,w(()=>{he.value[pe.value]?.focus();const e=document.querySelector(".episodes-slider"),a=he.value[pe.value];if(e&&a){const t=a.offsetLeft-20;e.scrollTo({left:t,behavior:"smooth"})}})))}if(M(e,q.INFO)){e.preventDefault();const a=document.querySelector(".main-content");return void(a&&a.scrollBy({top:300,behavior:"smooth"}))}if(M(e,q.COLOR_RED))return e.preventDefault(),void Ce();(M(e,q.COLOR_GREEN)||M(e,q.MEDIA_RECORD))&&e.preventDefault()},Ke=e=>{const a=document.activeElement;a&&a.closest(".sidebar")&&"ArrowRight"===e.key&&He.value&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),de.value.length>0&&fe.value>=0?(Oe.value=!0,w(()=>{const e=ye.value[fe.value];e&&e.focus(),Oe.value=!1})):ve.value.length>0&&pe.value>=0&&(Oe.value=!0,w(()=>{const e=he.value[pe.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a&&e){const t=e.offsetLeft-20;a.scrollTo({left:t,behavior:"smooth"})}}Oe.value=!1})),He.value=!1)};return s(()=>{Ae(),window.addEventListener("sidebar-navigate",Be),window.addEventListener("keydown",Ke,!0),document.addEventListener("keydown",xe)}),l(()=>{Se(),window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""})),window.removeEventListener("sidebar-navigate",Be),window.removeEventListener("keydown",Ke,!0),document.removeEventListener("keydown",xe)}),(e,a)=>ue.value?(I(),r("div",N,[i(D,{item:ue.value,"image-url":we.value,"backdrop-url":Ie.value,"logo-url":De.value,onPlay:Ce,onBack:u(ne),onBrowse:Me,onRemoveFromContinueWatching:qe,onMarkAsUnwatched:Ne},null,8,["item","image-url","backdrop-url","logo-url","onBack"]),Ee.value&&de.value.length>0?(I(),r("div",F,[d("div",O,[a[0]||(a[0]=d("h3",null,"Seasons",-1)),d("div",B,[(I(!0),r(c,null,v(de.value,(e,a)=>(I(),r("button",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(ye.value[a]=e)})(e,a),type:"button",class:f({active:ce.value?.Id===e.Id}),onClick:a=>_e(e),onKeydown:[m(a=>_e(e),["enter"]),e=>((e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if(0===a){fe.value=a,He.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else fe.value=a-1,w(()=>{ye.value[a-1]?.focus()});break;case"ArrowRight":a<de.value.length-1?(fe.value=a+1,w(()=>{ye.value[a+1]?.focus()})):(pe.value=0,w(()=>{he.value[0]?.focus()}));break;case"ArrowDown":w(()=>{const e=he.value[pe.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a){const e=a.getBoundingClientRect(),t=window.innerHeight,o=e.top+e.height/2-t/2,s=document.querySelector(".main-content");s&&s.scrollBy({top:o,behavior:"smooth"})}}});break;case"ArrowUp":const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");if(e)e.focus();else{const e=document.querySelector(".btn-hero-play");e?.focus()}}})(e,a)],tabindex:"0"},p(e.Name||`Season ${e.IndexNumber}`),43,H))),128))])]),ve.value.length>0?(I(),r("div",x,[a[2]||(a[2]=d("h3",null,"Episodes",-1)),d("div",K,[d("div",W,[(I(!0),r(c,null,v(ve.value,(e,t)=>(I(),r("div",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(he.value[a]=e)})(e,t),class:"episode-card",onKeydown:[m(a=>Re(e),["enter"]),e=>((e,a)=>{if(!e.key.startsWith("Arrow"))return;e.preventDefault(),e.stopPropagation();const t=document.querySelector(".episodes-slider");switch(e.key){case"ArrowLeft":if(0===a){pe.value=a,He.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else pe.value=a-1,w(()=>{const e=he.value[a-1];if(e?.focus(),t&&e){const a=e.offsetLeft-20;t.scrollTo({left:a,behavior:"smooth"})}});break;case"ArrowRight":a<ve.value.length-1&&(pe.value=a+1,w(()=>{const e=he.value[a+1];if(e?.focus(),t&&e){const a=e.offsetLeft-20;t.scrollTo({left:a,behavior:"smooth"})}}));break;case"ArrowUp":fe.value=0,w(()=>{ye.value[0]?.focus()});break;case"ArrowDown":const e=document.querySelector(".similar-titles .media-card");e?.focus()}})(e,t)],onClick:a=>Re(e),tabindex:"0"},[d("div",Y,[d("img",{src:e.ImageUrl||ge(e.Id,"Primary",u(k).EPISODE_CARD),alt:e.Name},null,8,$),e.RunTimeTicks?(I(),r("span",z,p(u(ie)(e.RunTimeTicks)),1)):n("",!0),e.UserData?.Played?(I(),r("div",G,[...a[1]||(a[1]=[d("span",null,"Watched",-1)])])):n("",!0)]),d("div",V,[d("h4",null,p(e.IndexNumber)+". "+p(e.Name),1),e.Overview?(I(),r("p",X,p(e.Overview),1)):n("",!0)]),e.UserData&&e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>0&&!e.UserData.Played?(I(),r("div",J,[d("div",{class:"episode-progress-bar",style:y({width:`${e.UserData.PlayedPercentage}%`})},null,4)])):n("",!0)],40,j))),128))])])])):n("",!0)])):n("",!0),me.value.length>0?(I(),r("div",Q,[a[3]||(a[3]=d("h3",null,"Similar Titles",-1)),i(P,{items:me.value,"get-image-url":e=>ge(e.Id,"Primary",u(k).MEDIA_CARD_DEFAULT),onItemClick:Fe},null,8,["items","get-image-url"])])):n("",!0)])):(I(),r("div",Z,[...a[4]||(a[4]=[d("p",null,"Loading...",-1)])]))}}),[["__scopeId","data-v-9cb6b17e"]]);export{ee as default};

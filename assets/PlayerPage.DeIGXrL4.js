import{d as e,r as a,o as s,c as o,l as r,q as l,b as t,k as i,u as n,g as c}from"./vue-vendor.BTt2NdZz.js";import{V as u,_ as d}from"./components.CrWKfICq.js";import{u as m,r as p,y as v,a as y,b as g}from"./composables.Ca-YutS5.js";const S={key:0,id:"player-screen"},P={key:1,id:"player-screen"},b=d(e({__name:"PlayerPage",setup(e){const d=n(),b=i(),I=y(),f=m(),k=g(),{handleBack:$}=p("Home"),h=v(k),D=a(null),U=a(""),w=async()=>{const e=b.params.itemId;if(h.initializeSession(e),I.isDemoMode.value)D.value=f.getItemDetails(e)||null,U.value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";else try{const a=await k.getItemDetails(e);D.value=a;const s=await k.getPlaybackInfo(e);if(!s.MediaSources||0===s.MediaSources.length)return console.error("[PlayerPage] No media sources available"),void(U.value="");const o=s.MediaSources[0],r=s.PlaySessionId||h.playSessionId.value;if(o.SupportsDirectPlay&&o.DirectStreamUrl)U.value=`${k.serverUrl.value}${o.DirectStreamUrl}`;else if(o.SupportsTranscoding)if(o.TranscodingUrl&&"hls"===o.TranscodingSubProtocol){let e=o.TranscodingUrl;e.startsWith("/emby/")||(e="/emby"+e),U.value=`${k.serverUrl.value}${e}`}else U.value=`${k.serverUrl.value}/emby/Videos/${e}/master.m3u8?MediaSourceId=${o.Id}&DeviceId=embyflix-tizen&api_key=${k.accessToken.value}&PlaySessionId=${r}&AudioStreamIndex=${o.DefaultAudioStreamIndex||1}&AudioCodec=aac&VideoCodec=h264`;else console.error("[PlayerPage] No streaming options available"),U.value=""}catch(a){console.error("[PlayerPage] Failed to load item for player:",a),D.value=null,U.value=""}},_=()=>{h.reportStart()};return s(()=>{w()}),(e,a)=>D.value?(c(),o("div",S,[r(u,{item:D.value,"stream-url":U.value,onClose:l($),onProgress:a[0]||(a[0]=(e,a)=>((e,a)=>{h.reportProgress(e,a)})(e,a)),onPlaybackStart:_,onPlaybackStop:a[1]||(a[1]=e=>(e=>{h.reportStop(e)})(e)),onSwitchEpisode:a[2]||(a[2]=e=>(async e=>{h.switchItem(e),await d.replace({name:"Player",params:{itemId:e}}),await w()})(e))},null,8,["item","stream-url","onClose"])])):(c(),o("div",P,[...a[3]||(a[3]=[t("p",null,"Loading player...",-1)])]))}}),[["__scopeId","data-v-550fc5b9"]]);export{b as default};

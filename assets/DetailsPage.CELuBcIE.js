import{d as e,r as a,k as t,m as o,o as s,a as l,c as i,i as n,f as r,p as u,b as c,F as d,e as v,z as m,n as g,t as f,h as p,l as h,u as y,B as w,g as D}from"./vue-vendor.B0WUDMXT.js";import{c as I,C as k,M as P,_ as b}from"./components.BQNxwHwS.js";import{u as E,c as A,a as S,y as T,e as L,s as C,b as U,w as _,d as M,i as R,T as q}from"./composables.CNmb4RHD.js";const N={key:0,id:"content-container"},F={key:0,class:"tv-show-content"},O={class:"season-selector"},B={class:"season-buttons"},H=["onClick","onKeydown"],x={key:0,class:"episode-list"},K={class:"episodes-container"},W={class:"episodes-slider"},j=["onKeydown","onClick"],Y={class:"episode-image"},$=["src","alt"],z={key:0,class:"episode-runtime"},G={key:1,class:"episode-watched",title:"Watched"},V={class:"episode-info"},X={key:0,class:"episode-overview"},J={key:0,class:"episode-progress"},Q={key:1,class:"similar-titles"},Z={key:1,id:"content-container"},ee=b(e({__name:"DetailsPage",setup(e){const b=y(),ee=h(),ae=S(),te=E(),oe=U(),se=_(),le=A(oe,te,ae.isDemoMode),ie=T(ae.isDemoMode),{formatRuntime:ne}=L(),{handleBack:re}=C("Home"),ue=a(null),ce=a([]),de=a(null),ve=a([]),me=a([]),ge=a(0),fe=a(0),pe=a([]),he=a([]),ye=(e,a="Primary",t)=>{const o="Primary"===a?k.DETAILS_POSTER:void 0;return le.getImageUrl(e,a,t??o)},we=t(()=>ue.value?ye(ue.value.Id):""),De=a(""),Ie=a(""),ke=async e=>{try{const a=await le.getHeroImageUrl(e.Id);De.value=a,window.dispatchEvent(new CustomEvent("update-backdrop",{detail:a}))}catch(a){console.error("[DetailsPage] Failed to load backdrop image:",a),De.value="",window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""}))}},Pe=e=>{if(ae.isDemoMode.value)Ie.value="";else try{const a=oe.getImageUrl(e.Id,"Logo",500);Ie.value=a}catch(a){console.error("[DetailsPage] Failed to load logo image:",a),Ie.value=""}},be=t(()=>"Series"===ue.value?.Type),Ee=async e=>{if(ae.isDemoMode.value)return me.value=te.getSimilarItems(e.Id,15),void console.log("[DetailsPage] Loaded",me.value.length,"demo similar items");try{const a=await oe.getSimilarItems(e.Id,15);me.value=a,console.log("[DetailsPage] Loaded",a.length,"similar items")}catch(a){console.error("[DetailsPage] Failed to load similar items:",a),me.value=[]}},Ae=async()=>{const e=ee.params.itemId;if(ae.isDemoMode.value)ue.value=te.getItemDetails(e)||null,ue.value&&(ke(ue.value),Pe(ue.value),"Series"===ue.value.Type&&await Te(ue.value.Id),Ee(ue.value));else try{const a=await oe.getItemDetails(e);ue.value=a,ke(a),Pe(a),"Series"===a.Type&&await Te(a.Id),Ee(a),ie.startBrowseTracking(a)}catch(a){console.error("[DetailsPage] Failed to load item details:",a),ue.value=null}},Se=()=>{ie.trackCurrentBrowseEvent()},Te=async e=>{if(ae.isDemoMode.value){const a=te.getSeasons(e);return ce.value=a,void(a.length>0&&await Ue(a[0]))}try{const a=await oe.getSeasons(e);ce.value=a,a.length>0&&await Ue(a[0])}catch(a){console.error("[DetailsPage] Failed to load seasons:",a)}},Le=e=>{let a=-1;for(let t=e.length-1;t>=0;t--)if(e[t].UserData?.Played){a=t;break}return a>=0?Math.min(a+1,e.length-1):0},Ce=()=>{w(()=>{setTimeout(()=>{const e=he.value[fe.value],a=document.querySelector(".episodes-slider");if(e&&a){const t=e.offsetLeft-20;a.scrollLeft=t}},150)})},Ue=async e=>{if(de.value=e,ue.value){if(ae.isDemoMode.value){const a=te.getEpisodes(ue.value.Id,e.Id);return ve.value=a,fe.value=Le(a),void Ce()}try{const a=await oe.getEpisodes(ue.value.Id,e.Id);ve.value=a,fe.value=Le(a),Ce()}catch(a){console.error("[DetailsPage] Failed to load episodes:",a)}}},_e=()=>{ue.value&&("Series"===ue.value.Type&&ve.value.length>0?(se.pushToHistory("Player",void 0,{itemId:ve.value[0].Id}),b.push({name:"Player",params:{itemId:ve.value[0].Id}})):(se.pushToHistory("Player",void 0,{itemId:ue.value.Id}),b.push({name:"Player",params:{itemId:ue.value.Id}})))},Me=e=>{se.pushToHistory("Player",void 0,{itemId:e.Id}),b.push({name:"Player",params:{itemId:e.Id}})},Re=e=>{console.log("Browse collection:",e)},qe=async e=>{if(ae.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot remove from continue watching");else try{console.log("[DetailsPage] Marking item as watched:",e.Id),await oe.markAsPlayed(e.Id),console.log("[DetailsPage] Successfully marked as watched"),ue.value&&ue.value.UserData&&(ue.value.UserData.Played=!0),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as watched:",a)}},Ne=async e=>{if(ae.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot mark as unwatched");else try{console.log("[DetailsPage] Marking item as unwatched:",e.Id),await oe.markAsUnplayed(e.Id),console.log("[DetailsPage] Successfully marked as unwatched"),ue.value&&ue.value.UserData&&(ue.value.UserData.Played=!1),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as unwatched:",a)}},Fe=e=>{const a=e;se.pushToHistory("Details",void 0,{itemId:a.Id}),b.push({name:"Details",params:{itemId:a.Id}})},Oe=a(!1),Be=()=>{b.push({name:"Home"})};o(()=>ee.params.itemId,(e,a)=>{e&&e!==a&&(Se(),ue.value=null,De.value="",Ie.value="",ce.value=[],de.value=null,ve.value=[],me.value=[],Ae())});const He=a(!1),xe=e=>{if(console.log(M(e)),R(e,q.MEDIA_PLAY)||R(e,q.MEDIA_PLAY_PAUSE))return e.preventDefault(),void _e();if(be.value&&ve.value.length>0){if(R(e,q.CHANNEL_UP)||R(e,q.MEDIA_TRACK_NEXT))return e.preventDefault(),void(fe.value<ve.value.length-1&&(fe.value++,w(()=>{he.value[fe.value]?.focus();const e=document.querySelector(".episodes-slider"),a=he.value[fe.value];if(e&&a){const t=a.offsetLeft-20;e.scrollTo({left:t,behavior:"smooth"})}})));if(R(e,q.CHANNEL_DOWN)||R(e,q.MEDIA_TRACK_PREVIOUS))return e.preventDefault(),void(fe.value>0&&(fe.value--,w(()=>{he.value[fe.value]?.focus();const e=document.querySelector(".episodes-slider"),a=he.value[fe.value];if(e&&a){const t=a.offsetLeft-20;e.scrollTo({left:t,behavior:"smooth"})}})))}if(R(e,q.INFO)){e.preventDefault();const a=document.querySelector(".main-content");return void(a&&a.scrollBy({top:300,behavior:"smooth"}))}return R(e,q.COLOR_RED)?(e.preventDefault(),void _e()):R(e,q.COLOR_GREEN)||R(e,q.MEDIA_RECORD)?(e.preventDefault(),void console.log("[DetailsPage] Toggle watchlist feature - to be implemented")):void 0},Ke=e=>{const a=document.activeElement;a&&a.closest(".sidebar")&&"ArrowRight"===e.key&&He.value&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),ce.value.length>0&&ge.value>=0?(Oe.value=!0,w(()=>{const e=pe.value[ge.value];e&&e.focus(),Oe.value=!1})):ve.value.length>0&&fe.value>=0&&(Oe.value=!0,w(()=>{const e=he.value[fe.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a&&e){const t=e.offsetLeft-20;a.scrollTo({left:t,behavior:"smooth"})}}Oe.value=!1})),He.value=!1)};return s(()=>{Ae(),window.addEventListener("sidebar-navigate",Be),window.addEventListener("keydown",Ke,!0),document.addEventListener("keydown",xe)}),l(()=>{Se(),window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""})),window.removeEventListener("sidebar-navigate",Be),window.removeEventListener("keydown",Ke,!0),document.removeEventListener("keydown",xe)}),(e,a)=>ue.value?(D(),i("div",N,[n(I,{item:ue.value,"image-url":we.value,"backdrop-url":De.value,"logo-url":Ie.value,onPlay:_e,onBack:u(re),onBrowse:Re,onRemoveFromContinueWatching:qe,onMarkAsUnwatched:Ne},null,8,["item","image-url","backdrop-url","logo-url","onBack"]),be.value&&ce.value.length>0?(D(),i("div",F,[c("div",O,[a[0]||(a[0]=c("h3",null,"Seasons",-1)),c("div",B,[(D(!0),i(d,null,v(ce.value,(e,a)=>(D(),i("button",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(pe.value[a]=e)})(e,a),type:"button",class:g({active:de.value?.Id===e.Id}),onClick:a=>Ue(e),onKeydown:[m(a=>Ue(e),["enter"]),e=>((e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if(0===a){ge.value=a,He.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else ge.value=a-1,w(()=>{pe.value[a-1]?.focus()});break;case"ArrowRight":a<ce.value.length-1?(ge.value=a+1,w(()=>{pe.value[a+1]?.focus()})):(fe.value=0,w(()=>{he.value[0]?.focus()}));break;case"ArrowDown":w(()=>{const e=he.value[fe.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a){const e=a.getBoundingClientRect(),t=window.innerHeight,o=e.top+e.height/2-t/2,s=document.querySelector(".main-content");s&&s.scrollBy({top:o,behavior:"smooth"})}}});break;case"ArrowUp":const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");if(e)e.focus();else{const e=document.querySelector(".btn-hero-play");e?.focus()}}})(e,a)],tabindex:"0"},f(e.Name||`Season ${e.IndexNumber}`),43,H))),128))])]),ve.value.length>0?(D(),i("div",x,[a[2]||(a[2]=c("h3",null,"Episodes",-1)),c("div",K,[c("div",W,[(D(!0),i(d,null,v(ve.value,(e,t)=>(D(),i("div",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(he.value[a]=e)})(e,t),class:"episode-card",onKeydown:[m(a=>Me(e),["enter"]),e=>((e,a)=>{if(!e.key.startsWith("Arrow"))return;e.preventDefault(),e.stopPropagation();const t=document.querySelector(".episodes-slider");switch(e.key){case"ArrowLeft":if(0===a){fe.value=a,He.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else fe.value=a-1,w(()=>{const e=he.value[a-1];if(e?.focus(),t&&e){const a=e.offsetLeft-20;t.scrollTo({left:a,behavior:"smooth"})}});break;case"ArrowRight":a<ve.value.length-1&&(fe.value=a+1,w(()=>{const e=he.value[a+1];if(e?.focus(),t&&e){const a=e.offsetLeft-20;t.scrollTo({left:a,behavior:"smooth"})}}));break;case"ArrowUp":ge.value=0,w(()=>{pe.value[0]?.focus()});break;case"ArrowDown":const e=document.querySelector(".similar-titles .media-card");e?.focus()}})(e,t)],onClick:a=>Me(e),tabindex:"0"},[c("div",Y,[c("img",{src:e.ImageUrl||ye(e.Id,"Primary",u(k).EPISODE_CARD),alt:e.Name},null,8,$),e.RunTimeTicks?(D(),i("span",z,f(u(ne)(e.RunTimeTicks)),1)):r("",!0),e.UserData?.Played?(D(),i("div",G,[...a[1]||(a[1]=[c("span",null,"Watched",-1)])])):r("",!0)]),c("div",V,[c("h4",null,f(e.IndexNumber)+". "+f(e.Name),1),e.Overview?(D(),i("p",X,f(e.Overview),1)):r("",!0)]),e.UserData&&e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>0&&!e.UserData.Played?(D(),i("div",J,[c("div",{class:"episode-progress-bar",style:p({width:`${e.UserData.PlayedPercentage}%`})},null,4)])):r("",!0)],40,j))),128))])])])):r("",!0)])):r("",!0),me.value.length>0?(D(),i("div",Q,[a[3]||(a[3]=c("h3",null,"Similar Titles",-1)),n(P,{items:me.value,"get-image-url":e=>ye(e.Id,"Primary",u(k).MEDIA_CARD_DEFAULT),onItemClick:Fe},null,8,["items","get-image-url"])])):r("",!0)])):(D(),i("div",Z,[...a[4]||(a[4]=[c("p",null,"Loading...",-1)])]))}}),[["__scopeId","data-v-9cb6b17e"]]);export{ee as default};

import{d as e,r as a,o as l,a as s,c as i,f as t,b as o,C as r,m as n,F as u,l as c,u as d,g as v,q as m,j as g,z as y,s as p,t as h,e as f,B as w,h as b,n as k,i as I,k as T,A as P,D as L,E as D,G as S,H as C}from"./vue-vendor.BVNoDdZ5.js";import{L as M,H as N,G as H,M as E,_ as A,T as F,C as U,a as R,b as q,V as _,c as x,d as B}from"./components.BlTirnO1.js";import{h as V,a as G,u as $,i as K,j as Q,k as O,d as j,b as W,l as z,m as Y,n as Z,o as J,p as X,q as ee,r as ae,e as le,s as se}from"./composables.Cfo3sM-Q.js";/* empty css               */import"./hls-vendor.swFHWmXm.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)}).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const ie={key:0,class:"splash-screen"},te={id:"app"},oe=e({__name:"App",setup(e){const m=c(),g=d();V();const y=a(!1),p=()=>{y.value=!0},h=()=>{y.value=!1},f=()=>{console.log("[App.vue] Custom Back Navigation Event Received."),"Login"!==m.name?g.back():console.log("[App.vue] On Login page, preventing back.")},w=a("home");return l(()=>{console.log("[App] Mounting - adding keydown listener"),(()=>{switch(m.name){case"Home":default:w.value="home";break;case"Details":w.value="details";break;case"Player":w.value="player"}})(),window.addEventListener("app-back-navigation",f),window.addEventListener("show-splash",p),window.addEventListener("hide-splash",h)}),s(()=>{console.log("[App] Unmounting - removing keydown listener"),window.removeEventListener("app-back-navigation",f),window.removeEventListener("show-splash",p),window.removeEventListener("hide-splash",h)}),(e,a)=>(v(),i(u,null,[y.value?(v(),i("div",ie,[...a[0]||(a[0]=[r('<div class="splash-content"><div class="splash-logo"><i class="fas fa-film"></i></div><h1 class="splash-title">EmbyFlix</h1><div class="splash-spinner"><div class="spinner"></div></div><p class="splash-text">Building your personalized content library...</p><p class="splash-subtext">This may take a moment on first load</p></div>',1)])])):t("",!0),o("div",te,[n(M)])],64))}}),re={id:"content-container"},ne={key:1,class:"hero-skeleton"},ue={key:3,class:"trending-section"},ce={class:"trending-movies-section"},de={class:"trending-tv-section"},ve={key:0,class:"because-you-watched-section"},me={class:"ml-0 mb-3.75 text-7"},ge={key:1,class:"daily-movies-section"},ye={class:"ml-0 mb-3.75 text-7"},pe={key:2,class:"daily-tv-section"},he={class:"ml-0 mb-3.75 text-7"},fe=R(e({__name:"HomePage",setup(e){const u=d(),f=c(),w=W(),b=G(),k=$(),I=ee(),T=K(),P=Q(),L=O(),D=j(b,k,w.isDemoMode),S=z(b,k,T,P,w.isDemoMode,true),C=Y(T,b,L,w.isDemoMode),M=Z(),R=J(),q=m(()=>C.trendingMovies.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),_=m(()=>C.trendingTvShows.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),x=X(T,q),B=X(T,_),V=a([]),ae=a(!1),le=a(""),se=async()=>{T.isConfigured&&await Promise.all([x.loadGenres("movie"),B.loadGenres("tv")])},ie=x.availableGenres,te=B.availableGenres,oe=async()=>{await C.loadTrendingContent({onShow:()=>window.dispatchEvent(new Event("show-splash")),onHide:()=>window.dispatchEvent(new Event("hide-splash"))})},fe=async()=>{await M.loadDailyContent(b,w.isDemoMode.value)},we=async()=>{w.isDemoMode.value||await R.loadBecauseYouWatched(b)},be=m(()=>C.filterMoviesByGenres(x.selectedGenres.value)),ke=m(()=>C.filterTvShowsByGenres(B.selectedGenres.value)),Ie=e=>{if("Id"in e&&"Name"in e&&!("tmdbData"in e))return D.getImageUrl(e.Id,"Primary",U.MEDIA_CARD_DEFAULT);const a="tmdbData"in e?e.tmdbData:e;return T.getPosterUrl(a.poster_path,"w500")},Te=async e=>{if("Id"in e&&"Name"in e)return void Se(e);const a="title"in e?e.title:e.name;console.log("[HomePage] TMDB item clicked:",a);const l=[...C.trendingMovies.value,...C.trendingTvShows.value,...M.dailyMovies.value,...M.dailyTvShows.value].find(a=>a.tmdbData.id===e.id);if(!l)return void console.error("[HomePage] Could not find merged item for TMDB item");const s={};S.currentLibrary.value&&(s.sourceLibraryId=S.currentLibrary.value.Id,s.sourceLibraryName=S.currentLibrary.value.Name||"",S.currentLibrary.value.CollectionType&&(s.sourceLibraryType=S.currentLibrary.value.CollectionType)),I.pushToHistory("Details",s,{itemId:l.embyId}),u.push({name:"Details",params:{itemId:l.embyId},query:s})},Pe=async e=>{if(await S.loadFeaturedItems(e,C.trendingMovies.value,C.trendingTvShows.value),S.featuredItems.value.length>0){const e=S.featuredItems.value[0];le.value=await Ne(e.Id),D.preloadImage(le.value)}},Le=async()=>{I.pushToHistory("Home");const e=await S.loadLibraries();V.value=e,w.isDemoMode.value||await Pe(e)},De=async e=>{console.log("[HomePage] loadLibraryItems called with:",e);const a={view:e.CollectionType||e.Type||"",libraryId:e.Id,libraryName:e.Name||""};I.pushToHistory("Home",a),u.push({name:"Home",query:a});const l=await S.loadLibraryItems(e);V.value=l},Se=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)De(e);else if("BoxSet"===e.Type)Ce(e);else{const a={};S.currentLibrary.value&&(a.sourceLibraryId=S.currentLibrary.value.Id,a.sourceLibraryName=S.currentLibrary.value.Name||"",S.currentLibrary.value.CollectionType&&(a.sourceLibraryType=S.currentLibrary.value.CollectionType)),I.pushToHistory("Details",a,{itemId:e.Id}),u.push({name:"Details",params:{itemId:e.Id},query:a})}},Ce=async e=>{S.currentLibrary.value=e,S.currentView.value="items";const a={view:"collection",libraryId:e.Id,libraryName:e.Name||""};if(I.pushToHistory("Home",a),u.push({name:"Home",query:a}),w.isDemoMode.value)V.value=k.getCollectionItems(e.Id);else try{V.value=await b.getCollectionItems(e.Id)}catch(l){console.error("Failed to load collection items:",l)}},Me=e=>D.getImageUrl(e,"Primary",U.MEDIA_CARD_DEFAULT),Ne=async e=>await D.getHeroImageUrl(e,S.featuredItems.value),He=m(()=>"libraries"===S.currentView.value?"Libraries":S.currentLibrary.value?S.currentLibrary.value.Name:""),Ee=async e=>{console.log("[HomePage] Hero item clicked:",e.Name),"Series"===e.Type?Ae(e):u.push({name:"Player",params:{itemId:e.Id}})},Ae=e=>{console.log("[HomePage] Hero navigate clicked:",e.Name);const a={};S.currentLibrary.value&&(a.sourceLibraryId=S.currentLibrary.value.Id,a.sourceLibraryName=S.currentLibrary.value.Name||"",S.currentLibrary.value.CollectionType&&(a.sourceLibraryType=S.currentLibrary.value.CollectionType)),I.pushToHistory("Details",a,{itemId:e.Id}),u.push({name:"Details",params:{itemId:e.Id},query:a})},Fe=e=>{console.log("Added to favorites:",e.Name)},Ue=()=>{!C.isLoadingMoreMovies.value&&C.hasMoreMovies.value&&(console.log("[HomePage] Near end of trending movies - preloading next page"),C.loadMoreMovies())},Re=()=>{!C.isLoadingMoreTv.value&&C.hasMoreTv.value&&(console.log("[HomePage] Near end of trending TV shows - preloading next page"),C.loadMoreTvShows())},qe=()=>{!M.isLoadingMoreMovies.value&&M.hasMoreMovies.value&&(console.log("[HomePage] Near end of daily movies - preloading next page"),M.loadMoreMovies(b,w.isDemoMode.value))},_e=()=>{!M.isLoadingMoreTv.value&&M.hasMoreTv.value&&(console.log("[HomePage] Near end of daily TV shows - preloading next page"),M.loadMoreTvShows(b,w.isDemoMode.value))},xe=async e=>{const a=e.detail;switch(console.log("[HomePage] Sidebar navigation:",a),a){case"home":u.push({name:"Home"}),await Le();break;case"movies":if(w.isDemoMode.value){const e={Id:"demo-movies",Name:"Movies",Type:"CollectionFolder",CollectionType:"movies"};u.push({name:"Home",query:{view:"movies",libraryId:e.Id,libraryName:e.Name}}),De(e)}else{console.log("[HomePage] Searching for movies library in:",S.allLibraries.value);const e=S.allLibraries.value.find(e=>"movies"===e.CollectionType||e.Name?.toLowerCase().includes("movie"));e?(console.log("[HomePage] Found and loading movies library:",e),u.push({name:"Home",query:{view:e.CollectionType||"movies",libraryId:e.Id,libraryName:e.Name||"Movies"}}),De(e)):console.warn("[HomePage] Movies library not found. Available libraries:",S.allLibraries.value.map(e=>({name:e.Name,collectionType:e.CollectionType,id:e.Id})))}break;case"tvshows":if(w.isDemoMode.value){const e={Id:"demo-tvshows",Name:"TV Shows",Type:"CollectionFolder",CollectionType:"tvshows"};u.push({name:"Home",query:{view:"tvshows",libraryId:e.Id,libraryName:e.Name}}),De(e)}else{console.log("[HomePage] Searching for TV shows library in:",S.allLibraries.value);const e=S.allLibraries.value.find(e=>"tvshows"===e.CollectionType||e.Name?.toLowerCase().includes("tv")||e.Name?.toLowerCase().includes("show"));e?(console.log("[HomePage] Found and loading TV shows library:",e),u.push({name:"Home",query:{view:e.CollectionType||"tvshows",libraryId:e.Id,libraryName:e.Name||"TV Shows"}}),De(e)):console.warn("[HomePage] TV shows library not found. Available libraries:",S.allLibraries.value.map(e=>({name:e.Name,collectionType:e.CollectionType,id:e.Id})))}break;case"collections":if(w.isDemoMode.value){const e={Id:"demo-collections",Name:"Collections",Type:"CollectionFolder",CollectionType:"collections"};u.push({name:"Home",query:{view:"collections",libraryId:e.Id,libraryName:e.Name}}),De(e)}else{console.log("[HomePage] Searching for collections library in:",S.allLibraries.value);const e=S.allLibraries.value.find(e=>"collections"===e.CollectionType||"boxsets"===e.CollectionType||e.Name?.toLowerCase().includes("collection"));e?(console.log("[HomePage] Found and loading collections library:",e),u.push({name:"Home",query:{view:e.CollectionType||"collections",libraryId:e.Id,libraryName:e.Name||"Collections"}}),De(e)):console.warn("[HomePage] Collections library not found. Available libraries:",S.allLibraries.value.map(e=>({name:e.Name,collectionType:e.CollectionType,id:e.Id})))}break;case"search":u.push({name:"Search"})}},Be=async()=>{const e=f.query.view,a=f.query.libraryId,l=f.query.libraryName;if(e&&a){if(console.log("[HomePage] Restoring view from query:",{view:e,libraryId:a,libraryName:l}),"collection"===e)try{const e=await b.getItemDetails(a);return S.currentLibrary.value=e,S.currentView.value="items",void(w.isDemoMode.value?V.value=k.getCollectionItems(e.Id):V.value=await b.getCollectionItems(e.Id))}catch(s){return console.error("[HomePage] Failed to restore collection view:",s),void Le()}const i=S.allLibraries.value.find(e=>e.Id===a);if(i)if(S.currentLibrary.value=i,S.currentView.value="items",w.isDemoMode.value)V.value=k.getLibraryItems(i.Id);else try{let e=null;"movies"===i.CollectionType?e="Movie":"tvshows"===i.CollectionType?e="Series":"collections"===i.CollectionType&&(e="BoxSet");const a=await b.getItems(i.Id,e);V.value=a}catch(s){console.error("[HomePage] Failed to restore library view:",s),V.value=[]}else if(w.isDemoMode.value){const s={Id:a,Name:l||e,Type:"CollectionFolder",CollectionType:e};S.currentLibrary.value=s,S.currentView.value="items",V.value=k.getLibraryItems(s.Id)}else console.warn("[HomePage] Could not find library with ID:",a),Le()}else Le()},Ve=()=>{console.log("[HomePage] Back navigation triggered. Current view:",S.currentView.value),console.log("[HomePage] Navigation stack size:",I.getStackSize());I.goBack()||console.log("[HomePage] Navigation stack empty, staying on current page")};g(()=>f.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(console.log("[HomePage] Route query changed, restoring view:",e),e.view&&e.libraryId?await Be():0===Object.keys(e).length&&(S.currentView.value="libraries",S.currentLibrary.value=null,V.value=S.allLibraries.value,await Pe(S.allLibraries.value)))}),g(()=>f.name,async(e,a)=>{"Home"===e&&a&&"Home"!==a&&(console.log("[HomePage] Returned to Home from",a),0!==Object.keys(f.query).length&&(f.query.view||f.query.libraryId)||("libraries"!==S.currentView.value&&(S.currentView.value="libraries",S.currentLibrary.value=null,V.value=S.allLibraries.value),S.allLibraries.value.length>0&&(console.log("[HomePage] Reloading featured items after returning from",a),await Pe(S.allLibraries.value))))}),g(()=>C.isLoadingTrending.value,async(e,a)=>{a&&!e&&0===S.featuredItems.value.length&&(C.trendingMovies.value.length>0||C.trendingTvShows.value.length>0)&&(console.log("[HomePage] Trending loaded, updating featured items for hero slider"),await Pe(S.allLibraries.value))});const Ge=async e=>{console.log("Api Key Set"),T.setApiKey(e),ae.value=!1,window.location.reload()},$e=()=>{ae.value=!1};return l(async()=>{T.isConfigured||(ae.value=!0),await Le(),await Promise.all([se(),oe()]),setTimeout(async()=>{await Promise.all([fe(),we()])},100),await Be(),window.addEventListener("sidebar-navigate",xe),window.addEventListener("app-back-navigation",Ve),console.log("Mounted!")}),s(()=>{window.removeEventListener("sidebar-navigate",xe),window.removeEventListener("app-back-navigation",Ve)}),(e,a)=>(v(),i("div",re,[ae.value?(v(),y(F,{key:0,onSubmit:Ge,onClose:$e})):t("",!0),"libraries"===p(S).currentView.value&&p(S).isLoadingFeatured.value?(v(),i("div",ne,[...a[3]||(a[3]=[r('<div class="hero-skeleton-content" data-v-24a50ea6><div class="skeleton-title" data-v-24a50ea6></div><div class="skeleton-meta" data-v-24a50ea6></div><div class="skeleton-description" data-v-24a50ea6></div><div class="skeleton-buttons" data-v-24a50ea6><div class="skeleton-button" data-v-24a50ea6></div><div class="skeleton-button" data-v-24a50ea6></div></div></div>',1)])])):t("",!0),"libraries"===p(S).currentView.value&&!p(S).isLoadingFeatured.value&&p(S).featuredItems.value.length>0?(v(),y(N,{key:2,items:p(S).featuredItems.value,"get-image-url":Ne,"slider-id":"Hero",onPlay:Ee,onFavorite:Fe,onNavigate:Ae},null,8,["items"])):t("",!0),"libraries"===p(S).currentView.value&&p(T).isConfigured?(v(),i("div",ue,[o("div",ce,[a[4]||(a[4]=o("h3",{class:"ml-0 mb-3.75 text-7"},"Trending Movies",-1)),p(ie).length>0?(v(),y(H,{key:0,genres:p(ie),"selected-genres":p(x).selectedGenres.value,"onUpdate:selectedGenres":a[0]||(a[0]=e=>p(x).selectedGenres.value=e)},null,8,["genres","selected-genres"])):t("",!0),p(C).trendingMovies.value.length>0||p(C).isLoadingTrending.value?(v(),y(E,{key:1,items:be.value,loading:p(C).isLoadingTrending.value,"get-image-url":Ie,onItemClick:Te,onNearEnd:Ue},null,8,["items","loading"])):t("",!0)]),o("div",de,[a[5]||(a[5]=o("h3",{class:"ml-0 mb-3.75 text-7"},"Trending TV Shows",-1)),p(te).length>0?(v(),y(H,{key:0,genres:p(te),"selected-genres":p(B).selectedGenres.value,"onUpdate:selectedGenres":a[1]||(a[1]=e=>p(B).selectedGenres.value=e)},null,8,["genres","selected-genres"])):t("",!0),p(C).trendingTvShows.value.length>0||p(C).isLoadingTrending.value?(v(),y(E,{key:1,items:ke.value,loading:p(C).isLoadingTrending.value,"get-image-url":Ie,onItemClick:Te,onNearEnd:Re},null,8,["items","loading"])):t("",!0)]),p(R).hasRecommendations.value?(v(),i("div",ve,[o("h3",me," Because you watched: "+h(p(R).becauseYouWatchedItem.value?.referenceItem.name),1),n(E,{items:p(R).becauseYouWatchedItem.value?.recommendations||[],"get-image-url":e=>Me(e.Id),onItemClick:a[2]||(a[2]=e=>Se(e))},null,8,["items","get-image-url"])])):t("",!0),p(M).dailyMovies.value.length>0?(v(),i("div",ge,[o("h3",ye,h(p(M).movieThemeTitle),1),n(E,{items:p(M).dailyMovies.value,loading:p(M).isLoading.value,"get-image-url":Ie,onItemClick:Te,onNearEnd:qe},null,8,["items","loading"])])):t("",!0),p(M).dailyTvShows.value.length>0?(v(),i("div",pe,[o("h3",he,h(p(M).tvThemeTitle),1),n(E,{items:p(M).dailyTvShows.value,loading:p(M).isLoading.value,"get-image-url":Ie,onItemClick:Te,onNearEnd:_e},null,8,["items","loading"])])):t("",!0)])):t("",!0),n(A,{items:V.value,title:He.value,"get-image-url":Me,onItemClick:Se},null,8,["items","title"])]))}}),[["__scopeId","data-v-24a50ea6"]]),we={key:0,id:"content-container"},be={key:0,class:"tv-show-content"},ke={class:"season-selector"},Ie={class:"season-buttons"},Te=["onClick","onKeydown"],Pe={key:0,class:"episode-list"},Le={class:"episodes-container"},De={class:"episodes-slider"},Se=["onKeydown","onClick"],Ce={class:"episode-image"},Me=["src","alt"],Ne={key:0,class:"episode-runtime"},He={key:1,class:"episode-watched",title:"Watched"},Ee={class:"episode-info"},Ae={key:0,class:"episode-overview"},Fe={key:0,class:"episode-progress"},Ue={key:1,class:"similar-titles"},Re={key:1,id:"content-container"},qe=R(e({__name:"DetailsPage",setup(e){const r=d(),y=c(),T=W(),P=$(),L=G(),D=ee(),S=j(L,P,T.isDemoMode),C=ae(T.isDemoMode),{formatRuntime:M}=le(),N=a(null),H=a([]),A=a(null),F=a([]),R=a([]),_=a(0),x=a(0),B=a([]),V=a([]),K=(e,a="Primary",l)=>{const s="Primary"===a?U.DETAILS_POSTER:void 0;return S.getImageUrl(e,a,l??s)},Q=m(()=>N.value?K(N.value.Id):""),O=a(""),z=a(""),Y=async e=>{try{const a=await S.getHeroImageUrl(e.Id);O.value=a,window.dispatchEvent(new CustomEvent("update-backdrop",{detail:a}))}catch(a){console.error("[DetailsPage] Failed to load backdrop image:",a),O.value="",window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""}))}},Z=e=>{if(T.isDemoMode.value)z.value="";else try{const a=L.getImageUrl(e.Id,"Logo",500);z.value=a}catch(a){console.error("[DetailsPage] Failed to load logo image:",a),z.value=""}},J=m(()=>"Series"===N.value?.Type),X=async e=>{if(T.isDemoMode.value)return R.value=P.getSimilarItems(e.Id,15),void console.log("[DetailsPage] Loaded",R.value.length,"demo similar items");try{const a=await L.getSimilarItems(e.Id,15);R.value=a,console.log("[DetailsPage] Loaded",a.length,"similar items")}catch(a){console.error("[DetailsPage] Failed to load similar items:",a),R.value=[]}},se=async()=>{const e=y.params.itemId;if(T.isDemoMode.value)N.value=P.getItemDetails(e)||null,N.value&&(Y(N.value),Z(N.value),"Series"===N.value.Type&&await te(N.value.Id),X(N.value));else try{const a=await L.getItemDetails(e);N.value=a,Y(a),Z(a),"Series"===a.Type&&await te(a.Id),X(a),C.startBrowseTracking(a)}catch(a){console.error("[DetailsPage] Failed to load item details:",a),N.value=null}},ie=()=>{C.trackCurrentBrowseEvent()},te=async e=>{if(T.isDemoMode.value){const a=P.getSeasons(e);return H.value=a,void(a.length>0&&await ne(a[0]))}try{const a=await L.getSeasons(e);H.value=a,a.length>0&&await ne(a[0])}catch(a){console.error("[DetailsPage] Failed to load seasons:",a)}},oe=e=>{let a=-1;for(let l=e.length-1;l>=0;l--)if(e[l].UserData?.Played){a=l;break}return a>=0?Math.min(a+1,e.length-1):0},re=()=>{w(()=>{setTimeout(()=>{const e=V.value[x.value],a=document.querySelector(".episodes-slider");if(e&&a){const l=e.offsetLeft-20;a.scrollLeft=l}},150)})},ne=async e=>{if(A.value=e,N.value){if(T.isDemoMode.value){const a=P.getEpisodes(N.value.Id,e.Id);return F.value=a,x.value=oe(a),void re()}try{const a=await L.getEpisodes(N.value.Id,e.Id);F.value=a,x.value=oe(a),re()}catch(a){console.error("[DetailsPage] Failed to load episodes:",a)}}},ue=()=>{N.value&&("Series"===N.value.Type&&F.value.length>0?(D.pushToHistory("Player",void 0,{itemId:F.value[0].Id}),r.push({name:"Player",params:{itemId:F.value[0].Id}})):(D.pushToHistory("Player",void 0,{itemId:N.value.Id}),r.push({name:"Player",params:{itemId:N.value.Id}})))},ce=e=>{D.pushToHistory("Player",void 0,{itemId:e.Id}),r.push({name:"Player",params:{itemId:e.Id}})},de=()=>{console.log("[DetailsPage] Back triggered. Stack size:",D.getStackSize());D.goBack()||(console.log("[DetailsPage] Navigation stack empty, falling back to Home"),r.push({name:"Home"}))},ve=e=>{console.log("Browse collection:",e)},me=async e=>{if(T.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot remove from continue watching");else try{console.log("[DetailsPage] Marking item as watched:",e.Id),await L.markAsPlayed(e.Id),console.log("[DetailsPage] Successfully marked as watched"),N.value&&N.value.UserData&&(N.value.UserData.Played=!0),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as watched:",a)}},ge=async e=>{if(T.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot mark as unwatched");else try{console.log("[DetailsPage] Marking item as unwatched:",e.Id),await L.markAsUnplayed(e.Id),console.log("[DetailsPage] Successfully marked as unwatched"),N.value&&N.value.UserData&&(N.value.UserData.Played=!1),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as unwatched:",a)}},ye=e=>{const a=e;D.pushToHistory("Details",void 0,{itemId:a.Id}),r.push({name:"Details",params:{itemId:a.Id}})},pe=a(!1),he=()=>{r.push({name:"Home"})},fe=()=>{de()};g(()=>y.params.itemId,(e,a)=>{e&&e!==a&&(ie(),N.value=null,O.value="",z.value="",H.value=[],A.value=null,F.value=[],R.value=[],se())});const qe=a(!1),_e=e=>{const a=document.activeElement;a&&a.closest(".sidebar")&&"ArrowRight"===e.key&&qe.value&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),H.value.length>0&&_.value>=0?(pe.value=!0,w(()=>{const e=B.value[_.value];e&&e.focus(),pe.value=!1})):F.value.length>0&&x.value>=0&&(pe.value=!0,w(()=>{const e=V.value[x.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a&&e){const l=e.offsetLeft-20;a.scrollTo({left:l,behavior:"smooth"})}}pe.value=!1})),qe.value=!1)};return l(()=>{se(),window.addEventListener("sidebar-navigate",he),window.addEventListener("app-back-navigation",fe),window.addEventListener("keydown",_e,!0)}),s(()=>{ie(),window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""})),window.removeEventListener("sidebar-navigate",he),window.removeEventListener("app-back-navigation",fe),window.removeEventListener("keydown",_e,!0)}),(e,a)=>N.value?(v(),i("div",we,[n(q,{item:N.value,"image-url":Q.value,"backdrop-url":O.value,"logo-url":z.value,onPlay:ue,onBack:de,onBrowse:ve,onRemoveFromContinueWatching:me,onMarkAsUnwatched:ge},null,8,["item","image-url","backdrop-url","logo-url"]),J.value&&H.value.length>0?(v(),i("div",be,[o("div",ke,[a[0]||(a[0]=o("h3",null,"Seasons",-1)),o("div",Ie,[(v(!0),i(u,null,f(H.value,(e,a)=>(v(),i("button",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(B.value[a]=e)})(e,a),type:"button",class:k({active:A.value?.Id===e.Id}),onClick:a=>ne(e),onKeydown:[b(a=>ne(e),["enter"]),e=>((e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if(0===a){_.value=a,qe.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else _.value=a-1,w(()=>{B.value[a-1]?.focus()});break;case"ArrowRight":a<H.value.length-1?(_.value=a+1,w(()=>{B.value[a+1]?.focus()})):(x.value=0,w(()=>{V.value[0]?.focus()}));break;case"ArrowDown":w(()=>{const e=V.value[x.value];e&&e.focus()});break;case"ArrowUp":const e=document.querySelector(".btn-hero-play");e?.focus()}})(e,a)],tabindex:"0"},h(e.Name||`Season ${e.IndexNumber}`),43,Te))),128))])]),F.value.length>0?(v(),i("div",Pe,[a[2]||(a[2]=o("h3",null,"Episodes",-1)),o("div",Le,[o("div",De,[(v(!0),i(u,null,f(F.value,(e,l)=>(v(),i("div",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(V.value[a]=e)})(e,l),class:"episode-card",onKeydown:[b(a=>ce(e),["enter"]),e=>((e,a)=>{if(!e.key.startsWith("Arrow"))return;e.preventDefault(),e.stopPropagation();const l=document.querySelector(".episodes-slider");switch(e.key){case"ArrowLeft":if(0===a){x.value=a,qe.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else x.value=a-1,w(()=>{const e=V.value[a-1];if(e?.focus(),l&&e){const a=e.offsetLeft-20;l.scrollTo({left:a,behavior:"smooth"})}});break;case"ArrowRight":a<F.value.length-1&&(x.value=a+1,w(()=>{const e=V.value[a+1];if(e?.focus(),l&&e){const a=e.offsetLeft-20;l.scrollTo({left:a,behavior:"smooth"})}}));break;case"ArrowUp":_.value=0,w(()=>{B.value[0]?.focus()});break;case"ArrowDown":const e=document.querySelector(".similar-titles .media-card");e?.focus()}})(e,l)],onClick:a=>ce(e),tabindex:"0"},[o("div",Ce,[o("img",{src:e.ImageUrl||K(e.Id,"Primary",p(U).EPISODE_CARD),alt:e.Name},null,8,Me),e.RunTimeTicks?(v(),i("span",Ne,h(p(M)(e.RunTimeTicks)),1)):t("",!0),e.UserData?.Played?(v(),i("div",He,[...a[1]||(a[1]=[o("span",null,"Watched",-1)])])):t("",!0)]),o("div",Ee,[o("h4",null,h(e.IndexNumber)+". "+h(e.Name),1),e.Overview?(v(),i("p",Ae,h(e.Overview),1)):t("",!0)]),e.UserData&&e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>0&&!e.UserData.Played?(v(),i("div",Fe,[o("div",{class:"episode-progress-bar",style:I({width:`${e.UserData.PlayedPercentage}%`})},null,4)])):t("",!0)],40,Se))),128))])])])):t("",!0)])):t("",!0),R.value.length>0?(v(),i("div",Ue,[a[3]||(a[3]=o("h3",null,"Similar Titles",-1)),n(E,{items:R.value,"get-image-url":e=>K(e.Id,"Primary",p(U).MEDIA_CARD_DEFAULT),onItemClick:ye},null,8,["items","get-image-url"])])):t("",!0)])):(v(),i("div",Re,[...a[4]||(a[4]=[o("p",null,"Loading...",-1)])]))}}),[["__scopeId","data-v-c41bf232"]]),_e={key:0,id:"player-screen"},xe={key:1,id:"player-screen"},Be=R(e({__name:"PlayerPage",setup(e){const s=d(),t=c(),r=W(),u=$(),m=G(),g=ee(),y=a(null),p=a(""),h=a(""),f=async()=>{const e=t.params.itemId;if(p.value=m.generatePlaySessionId(),r.isDemoMode.value)y.value=u.getItemDetails(e)||null,h.value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";else try{const a=await m.getItemDetails(e);y.value=a;const l=await m.getPlaybackInfo(e);if(!l.MediaSources||0===l.MediaSources.length)return console.error("[PlayerPage] No media sources available"),void(h.value="");const s=l.MediaSources[0],i=l.PlaySessionId||p.value;if(s.SupportsDirectPlay&&s.DirectStreamUrl)h.value=`${m.serverUrl.value}${s.DirectStreamUrl}`;else if(s.SupportsTranscoding)if(s.TranscodingUrl&&"hls"===s.TranscodingSubProtocol){let e=s.TranscodingUrl;e.startsWith("/emby/")||(e="/emby"+e),h.value=`${m.serverUrl.value}${e}`}else h.value=`${m.serverUrl.value}/emby/Videos/${e}/master.m3u8?MediaSourceId=${s.Id}&DeviceId=embyflix-tizen&api_key=${m.accessToken.value}&PlaySessionId=${i}&AudioStreamIndex=${s.DefaultAudioStreamIndex||1}&AudioCodec=aac&VideoCodec=h264`;else console.error("[PlayerPage] No streaming options available"),h.value=""}catch(a){console.error("[PlayerPage] Failed to load item for player:",a),y.value=null,h.value=""}},w=()=>{console.log("[PlayerPage] Close triggered. Stack size:",g.getStackSize());g.goBack()||(console.log("[PlayerPage] Navigation stack empty, falling back to Home"),s.push({name:"Home"}))},b=()=>{y.value&&p.value&&m.reportPlaybackStart(y.value.Id,p.value)};return l(()=>{f()}),(e,a)=>y.value?(v(),i("div",_e,[n(_,{item:y.value,"stream-url":h.value,onClose:w,onProgress:a[0]||(a[0]=(e,a)=>((e,a)=>{y.value&&p.value&&m.reportPlaybackProgress(y.value.Id,e,a,p.value)})(e,a)),onPlaybackStart:b,onPlaybackStop:a[1]||(a[1]=e=>(e=>{y.value&&p.value&&m.reportPlaybackStopped(y.value.Id,e,p.value)})(e)),onSwitchEpisode:a[2]||(a[2]=e=>(async e=>{if(y.value&&p.value){const e=0;m.reportPlaybackStopped(y.value.Id,e,p.value)}await s.replace({name:"Player",params:{itemId:e}}),await f()})(e))},null,8,["item","stream-url"])])):(v(),i("div",xe,[...a[3]||(a[3]=[o("p",null,"Loading player...",-1)])]))}}),[["__scopeId","data-v-7de50a5a"]]),Ve={class:"search-page"},Ge={class:"search-layout"},$e={key:0,class:"filters-sidebar"},Ke={class:"sidebar-header"},Qe={key:0,class:"sort-section"},Oe={for:"sort-select",class:"sort-label"},je={class:"filter-section"},We={class:"filter-chips-vertical"},ze=["onClick","onKeydown"],Ye={key:0,class:"fas fa-check"},Ze={class:"filter-section"},Je={class:"filter-chips-vertical"},Xe={key:0,class:"fas fa-check"},ea={key:0,class:"fas fa-check"},aa={key:0,class:"fas fa-check"},la={key:1,class:"filter-section"},sa={class:"filter-chips-vertical scrollable"},ia=["onClick","onKeydown"],ta={key:0,class:"fas fa-check"},oa={key:2,class:"filter-section"},ra={class:"filter-chips-vertical scrollable"},na=["onClick","onKeydown"],ua={key:0,class:"fas fa-check"},ca={class:"results-main"},da={key:0,class:"results-summary"},va={key:1,class:"loading-state"},ma={key:2,class:"error-state"},ga={key:3,class:"empty-state"},ya={key:4,class:"no-results-state"},pa={key:5,class:"results-container"},ha={class:"group-header"},fa={class:"group-count"},wa={class:"results-grid"},ba=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:B},{path:"/home",name:"Home",component:fe,meta:{requiresAuth:!0,layout:"base"}},{path:"/search",name:"Search",component:R(e({__name:"SearchPage",setup(e){const a=c(),n=d(),w=se(),I=G(),D=W(),S=$(),C=j(I,S,D.isDemoMode),M=ae(D.isDemoMode),N=()=>{n.back()};l(()=>{w.setFilter(["Movie","Series"]),window.addEventListener("app-back-navigation",N)}),s(()=>{window.removeEventListener("app-back-navigation",N)}),g(()=>a.query.q,e=>{const a=e||"";a!==w.searchQuery.value&&(w.searchQuery.value=a)},{immediate:!0}),g(()=>w.searchResults.value,(e,a)=>{!w.isSearching.value&&e.length>0&&e!==a&&w.searchQuery.value&&M.trackSearchEvent(w.searchQuery.value,{genres:w.filters.value.genres,studios:w.filters.value.studios,itemTypes:w.filters.value.itemTypes})});const H=e=>({Movie:"Movies",Series:"TV Shows",Episode:"Episodes",Season:"Seasons",MusicAlbum:"Albums",Audio:"Music",Person:"People",BoxSet:"Collections"}[e]||e),E=e=>({Movie:"fas fa-film",Series:"fas fa-tv",Episode:"fas fa-video",Season:"fas fa-layer-group",MusicAlbum:"fas fa-compact-disc",Audio:"fas fa-music",Person:"fas fa-user",BoxSet:"fas fa-box"}[e]||"fas fa-file"),A=e=>C.getImageUrl(e.Id,"Primary",U.MEDIA_CARD_DEFAULT),F=m(()=>{if(w.isSearching.value)return"Searching...";if(!w.searchQuery.value)return"Enter a search term to find movies, TV shows, and more";if(0===w.searchResults.value.length)return`No results found for "${w.searchQuery.value}"`;const e=w.filteredResults.value.length,a=w.searchResults.value.length;return e!==a?`Showing ${e} of ${a} results for "${w.searchQuery.value}"`:`${e} result${1!==e?"s":""} for "${w.searchQuery.value}"`});return(e,a)=>{return v(),i("div",Ve,[o("div",Ge,[p(w).searchQuery.value?(v(),i("aside",$e,[o("div",Ke,[o("h3",null,"Filters ("+h(p(w).filters.value.itemTypes.length+p(w).filters.value.genres.length+p(w).filters.value.studios.length+p(w).filters.value.tags.length+("any"!==p(w).filters.value.runtime?1:0)+("any"!==p(w).filters.value.criticRating?1:0))+")",1),p(w).filters.value.itemTypes.length>0||p(w).filters.value.genres.length>0||p(w).filters.value.studios.length>0||p(w).filters.value.tags.length>0||"any"!==p(w).filters.value.runtime||"any"!==p(w).filters.value.criticRating?(v(),i("button",{key:0,class:"clear-filters-btn",tabindex:"0",onClick:a[0]||(a[0]=e=>p(w).clearFilters()),onKeydown:a[1]||(a[1]=b(e=>p(w).clearFilters(),["enter"]))}," Clear All ",32)):t("",!0)]),p(w).searchQuery.value?(v(),i("div",Qe,[o("label",Oe,[a[10]||(a[10]=P(" Sort by: ",-1)),o("strong",null,h((l=p(w).filters.value.sortBy,{relevance:"Best Match","name-asc":"Name (A-Z)","name-desc":"Name (Z-A)","date-newest":"Newest First","date-oldest":"Oldest First","critic-high":"Critics (High)","critic-low":"Critics (Low)"}[l]||"Best Match")),1)]),T(o("select",{id:"sort-select","onUpdate:modelValue":a[2]||(a[2]=e=>p(w).filters.value.sortBy=e),class:"sort-select",tabindex:"2",onChange:a[3]||(a[3]=e=>p(w).setSortBy(p(w).filters.value.sortBy))},[...a[11]||(a[11]=[r('<option value="relevance" data-v-e853ee67>Best Match</option><option value="name-asc" data-v-e853ee67>Name (A-Z)</option><option value="name-desc" data-v-e853ee67>Name (Z-A)</option><option value="date-newest" data-v-e853ee67>Newest First</option><option value="date-oldest" data-v-e853ee67>Oldest First</option><option value="critic-high" data-v-e853ee67>Critics (High)</option><option value="critic-low" data-v-e853ee67>Critics (Low)</option>',7)])],544),[[L,p(w).filters.value.sortBy]])])):t("",!0),o("div",je,[a[12]||(a[12]=o("h4",{class:"filter-section-title"},"Content Format",-1)),o("div",We,[(v(!0),i(u,null,f(p(w).availableTypes.value,e=>(v(),i("button",{key:e,class:k(["filter-chip",{active:p(w).isTypeFiltered(e)}]),tabindex:"0",onClick:a=>p(w).toggleFilter(e),onKeydown:b(a=>p(w).toggleFilter(e),["enter"])},[o("span",null,h(H(e)),1),p(w).isTypeFiltered(e)?(v(),i("i",Ye)):t("",!0)],42,ze))),128))])]),o("div",Ze,[a[16]||(a[16]=o("h4",{class:"filter-section-title"},"Quick Watch",-1)),o("div",Je,[o("button",{class:k(["filter-chip",{active:"short"===p(w).filters.value.runtime}]),tabindex:"0",onClick:a[4]||(a[4]=e=>p(w).setRuntime("short")),onKeydown:a[5]||(a[5]=b(e=>p(w).setRuntime("short"),["enter"]))},[a[13]||(a[13]=o("span",null,"Under 30 Min",-1)),"short"===p(w).filters.value.runtime?(v(),i("i",Xe)):t("",!0)],34),o("button",{class:k(["filter-chip",{active:"medium"===p(w).filters.value.runtime}]),tabindex:"0",onClick:a[6]||(a[6]=e=>p(w).setRuntime("medium")),onKeydown:a[7]||(a[7]=b(e=>p(w).setRuntime("medium"),["enter"]))},[a[14]||(a[14]=o("span",null,"1-2 Hours",-1)),"medium"===p(w).filters.value.runtime?(v(),i("i",ea)):t("",!0)],34),o("button",{class:k(["filter-chip",{active:"long"===p(w).filters.value.runtime||"verylong"===p(w).filters.value.runtime}]),tabindex:"0",onClick:a[8]||(a[8]=e=>p(w).setRuntime("long"===p(w).filters.value.runtime||"verylong"===p(w).filters.value.runtime?"any":"long")),onKeydown:a[9]||(a[9]=b(e=>p(w).setRuntime("long"===p(w).filters.value.runtime||"verylong"===p(w).filters.value.runtime?"any":"long"),["enter"]))},[a[15]||(a[15]=o("span",null,"Full Feature (2hr+)",-1)),"long"===p(w).filters.value.runtime||"verylong"===p(w).filters.value.runtime?(v(),i("i",aa)):t("",!0)],34)])]),p(w).availableGenres.value.length>0?(v(),i("div",la,[a[17]||(a[17]=o("h4",{class:"filter-section-title"},"Genres",-1)),o("div",sa,[(v(!0),i(u,null,f(p(w).availableGenres.value,e=>(v(),i("button",{key:e,class:k(["filter-chip",{active:p(w).isGenreFiltered(e)}]),tabindex:"0",onClick:a=>p(w).toggleGenre(e),onKeydown:b(a=>p(w).toggleGenre(e),["enter"])},[o("span",null,h(e),1),p(w).isGenreFiltered(e)?(v(),i("i",ta)):t("",!0)],42,ia))),128))])])):t("",!0),p(w).availableTags.value.length>0?(v(),i("div",oa,[a[18]||(a[18]=o("h4",{class:"filter-section-title"},"Tags",-1)),o("div",ra,[(v(!0),i(u,null,f(p(w).availableTags.value,e=>(v(),i("button",{key:e,class:k(["filter-chip",{active:p(w).isTagFiltered(e)}]),tabindex:"0",onClick:a=>p(w).toggleTag(e),onKeydown:b(a=>p(w).toggleTag(e),["enter"])},[o("span",null,h(e),1),p(w).isTagFiltered(e)?(v(),i("i",ua)):t("",!0)],42,na))),128))])])):t("",!0)])):t("",!0),o("main",ca,[p(w).searchQuery.value?(v(),i("div",da,[o("p",null,h(F.value),1)])):t("",!0),p(w).isSearching.value?(v(),i("div",va,[...a[19]||(a[19]=[o("i",{class:"fas fa-spinner fa-spin"},null,-1),o("p",null,"Searching...",-1)])])):p(w).searchError.value?(v(),i("div",ma,[a[20]||(a[20]=o("i",{class:"fas fa-exclamation-circle"},null,-1)),o("p",null,h(p(w).searchError.value),1)])):p(w).searchQuery.value?0===p(w).filteredResults.value.length&&p(w).searchQuery.value?(v(),i("div",ya,[...a[22]||(a[22]=[o("i",{class:"fas fa-film-slash"},null,-1),o("h2",null,"No Results Found",-1),o("p",null,"Try adjusting your search or filters",-1)])])):(v(),i("div",pa,[(v(!0),i(u,null,f(p(w).groupedResults.value,(e,a)=>(v(),i("div",{key:a,class:"results-group"},[o("div",ha,[o("i",{class:k(E(a))},null,2),o("h2",null,h(H(a)),1),o("span",fa,h(e.length),1)]),o("div",wa,[(v(!0),i(u,null,f(e,e=>(v(),y(x,{key:e.Id,item:e,"image-url":A(e),onClick:a=>(e=>{w.searchQuery.value&&M.trackSearchEvent(w.searchQuery.value,{genres:w.filters.value.genres,studios:w.filters.value.studios,itemTypes:w.filters.value.itemTypes},e.Id),n.push({name:"Details",params:{itemId:e.Id}})})(e)},null,8,["item","image-url","onClick"]))),128))])]))),128))])):(v(),i("div",ga,[...a[21]||(a[21]=[o("i",{class:"fas fa-search"},null,-1),o("h2",null,"Search Your Library",-1),o("p",null,"Find movies, TV shows, episodes, and more",-1)])]))])])]);var l}}}),[["__scopeId","data-v-e853ee67"]]),meta:{requiresAuth:!0,layout:"base"}},{path:"/details/:itemId",name:"Details",component:qe,meta:{requiresAuth:!0,layout:"base"}},{path:"/player/:itemId",name:"Player",component:Be,meta:{requiresAuth:!0,layout:"none"}}],ka=D({history:S(),routes:ba});ka.beforeEach((e,a,l)=>{const s=W(),i=e.matched.some(e=>e.meta.requiresAuth);console.log(`[Router] Navigating to: ${e.path}, Auth: ${s.isAuthenticated.value}, Demo: ${s.isDemoMode.value}`),i&&!s.isAuthenticated.value?(console.warn("[Router] Access denied. Redirecting to login..."),l({name:"Login"})):"Login"===e.name&&s.isAuthenticated.value?(console.log("[Router] Already authenticated. Redirecting to home..."),l({name:"Home"})):l()});const Ia=C(oe);Ia.use(ka),Ia.mount("#app");

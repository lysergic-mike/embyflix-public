import{d as e,r as a,o as t,a as l,c as i,n as s,b as o,F as n,e as r,f as u,w as c,u as d,g as v,t as m,h as p,i as g,j as f,k as y,l as b,m as h,p as k,q as w,s as I,v as E,x as C,y as S,T as _,z as x,A as P,B as D}from"./vue-vendor.B0WUDMXT.js";import{u as L,a as T,b as A,d as N,i as M,T as U,c as R,e as O,f as F,g as V,h as $}from"./composables.CNmb4RHD.js";const B=""+new URL("EmbyFlix-logo.CCoAMb74.png",import.meta.url).href,W=440,q={MEDIA_CARD_SMALL:220,MEDIA_CARD_DEFAULT:300,MEDIA_CARD_LARGE:W,EPISODE_CARD:500,HERO_SLIDER:1920,BACKDROP_DEFAULT:1280,SIDEBAR_THUMB:154,DETAILS_POSTER:W},G={class:"sidebar w-[300px] transition-[width] duration-800"},H={class:"sidebar-nav","data-nav-container":"sidebar"},z=["onClick"],K={class:"nav-text"},Y={class:"opacity-0 transition-opacity duration-300 group-focus-within:opacity-50 group-hover:opacity-50 focus-within:!opacity-100 hover:!opacity-100"},j={key:0,class:"continue-watching-container mt-8 mb-25"},X={class:"continue-watching-list",style:{"list-style":"none"}},Q=["onClick"],Z={class:"absolute inset-0 overflow-hidden z-0 rounded-xl"},J=["src","alt"],ee={class:"flex flex-col justify-between z-1 relative h-40 w-full self-end px-4 pb-1 bg-gradient-to-t from-black/30 to-transparent group-focus/item:from-black/0"},ae={class:"item-title-wrapper"},te={class:"item-title font-bold text-white text-shadow"},le={key:0,class:"bg-black bg-opacity-30"},ie={class:"bottom-row w-full"},se={class:"progress-details flex justify-between w-full items-center"},oe={class:"flex bg-gray-600 bg-opacity-50 backdrop-blur-sm text-white px-2 rounded h-8 items-center justify-between gap-2"},ne={key:0},re=(e,a)=>{const t=e.__vccOpts||e;for(const[l,i]of a)t[l]=i;return t},ue=re(e({__name:"Sidebar",props:{activeNavItem:{},userName:{}},emits:["navigate","logout"],setup(e,{emit:g}){const f=g,y=d(),b=T(),h=L(),k=A(),w=a([]),I=[{id:"home",icon:"fas fa-home",text:"Home"},{id:"movies",icon:"fas fa-film",text:"Movies"},{id:"tvshows",icon:"fas fa-tv",text:"TV Shows"},{id:"collections",icon:"fas fa-folder",text:"Collections"},{id:"search",icon:"fas fa-search",text:"Search"},{id:"settings",icon:"fas fa-cog",text:"Settings"}],E=()=>{f("logout")},C=async()=>{if(b.isDemoMode.value)w.value=h.getContinueWatching();else try{const e=await k.getContinueWatching(),a=e.reduce((e,a)=>{const t=a.SeriesName||a.Name,l=a.ProductionYear;return e.some(e=>{const a=e.SeriesName||e.Name,i=e.ProductionYear;return a===t&&i===l})||e.push(a),e},[]);w.value=a,console.log("[Sidebar] Loaded continue watching items:",a.length,"unique items from",e.length,"total items")}catch(e){console.error("[Sidebar] Failed to load continue watching:",e)}},S=e=>b.isDemoMode.value?e.ImageUrl||"":k.getImageUrl(e.Id,"Primary",q.MEDIA_CARD_DEFAULT),_=e=>e.UserData?.PlaybackPositionTicks&&e.RunTimeTicks?Math.round(e.UserData.PlaybackPositionTicks/e.RunTimeTicks*100):0,x=e=>"Episode"===e.Type&&e.ParentIndexNumber&&e.IndexNumber?`S${e.ParentIndexNumber} E${e.IndexNumber}`:"",P=()=>{console.log("[Sidebar] Refreshing continue watching list"),C()},D=e=>{console.log(N(e));const a=document.activeElement;if(a?.closest(".sidebar")){if(M(e,U.MENU)){e.preventDefault();const a=document.querySelector(".sidebar .nav-item");return void(a&&a.focus())}if(e.keyCode>=49&&e.keyCode<=54){e.preventDefault();const a=e.keyCode-49;if(a<I.length){const e=I[a];y.push({name:e.text})}return}return M(e,U.SEARCH)||M(e,U.COLOR_YELLOW)?(e.preventDefault(),void y.push({name:"Search"})):M(e,U.COLOR_BLUE)||M(e,U.TOOLS)||M(e,U.INFO)?(e.preventDefault(),void y.push({name:"Settings"})):void 0}},R=a(!1);return t(()=>{C(),window.addEventListener("refresh-continue-watching",P),document.addEventListener("keydown",D),setTimeout(()=>{R.value=!0},50)}),l(()=>{window.removeEventListener("refresh-continue-watching",P),document.removeEventListener("keydown",D)}),(a,t)=>(v(),i("div",{class:s(["group sidebar-wrapper",{"enable-transition":R.value}]),"data-nav-zone":"sidebar"},[o("div",G,[o("nav",H,[(v(),i(n,null,r(I,a=>o("a",{key:a.id,href:"#",class:s(["nav-item",{active:e.activeNavItem===a.id}]),onClick:c(e=>f("navigate",a.id),["prevent"])},[o("i",{class:s(a.icon+" nav-icon")},null,2),o("span",K,m(a.text),1)],10,z)),64)),o("div",Y,[w.value.length>0?(v(),i("div",j,[t[1]||(t[1]=o("h3",{class:"pl-2 mb-3 text-white font-semibold"},"Continue Watching",-1)),o("ul",X,[(v(!0),i(n,null,r(w.value,e=>(v(),i("li",{key:e.Id,class:"continue-watching-item relative overflow-hidden mb-3"},[o("div",{class:"item-wrapper bg-black min-h-45 rounded-xl relative flex cursor-pointer group/item",onClick:a=>(e=>{y.push({name:"Player",params:{itemId:e.Id}})})(e),tabindex:"0"},[o("div",Z,[o("img",{class:"w-full h-full object-cover",src:S(e),alt:e.SeriesName||e.Name,loading:"lazy",decoding:"async"},null,8,J)]),o("div",ee,[o("div",ae,[o("span",te,m(e.SeriesName||e.Name),1),_(e)?(v(),i("div",le,[o("div",{class:"progress-bar bg-[#13ff00] h-1 mt-2 shadow-sm rounded-sm",style:p({width:_(e)+"%"})},null,4)])):u("",!0)]),o("div",ie,[o("div",se,[t[0]||(t[0]=o("span",{class:"btn-overlay bg-gray-600 bg-opacity-50 backdrop-blur-sm rounded-full w-8 h-8 flex justify-center items-center text-white"},[o("i",{class:"fas fa-play"})],-1)),o("div",oe,[x(e)?(v(),i("span",ne,m(x(e)),1)):u("",!0),o("span",null,m(_(e))+"%",1)])])])])],8,Q)]))),128))])])):u("",!0)]),o("a",{href:"#",class:"nav-item logout-item",onClick:c(E,["prevent"])},[...t[2]||(t[2]=[o("i",{class:"fas fa-sign-out-alt nav-icon"},null,-1),o("span",{class:"nav-text"},"Logout",-1)])])])])],2))}}),[["__scopeId","data-v-fa581bfb"]]),ce={class:"header-placeholder"},de=re(e({__name:"Header",setup:e=>(e,a)=>(v(),i("div",ce))}),[["__scopeId","data-v-4e570622"]]),ve={class:"layout"},me={key:0,class:"global-backdrop"},pe=["src"],ge={class:"header"},fe={class:"content"},ye={class:"main-content px-7.5"},be=re(e({__name:"BaseLayout",props:{activeNavItem:{},userName:{}},emits:["navigate","logout","search"],setup(e,{emit:s}){const n=s,r=a(""),c=e=>{n("search",e)},d=e=>{const a=e;r.value=a.detail||""};return t(()=>{const e=document.querySelector(".sidebar .nav-item");e&&e.focus(),window.addEventListener("update-backdrop",d)}),l(()=>{window.removeEventListener("update-backdrop",d)}),(a,t)=>(v(),i("div",ve,[r.value?(v(),i("div",me,[o("img",{src:r.value,alt:"Backdrop",class:"backdrop-image"},null,8,pe),t[2]||(t[2]=o("div",{class:"backdrop-gradient"},null,-1))])):u("",!0),o("div",ge,[t[3]||(t[3]=o("div",{class:"logo-container w-75 h-full flex items-center b-bottom-1 border-primary-color border-1 pl-5"},[o("img",{src:B,alt:"EmbyFlix",class:"header-logo"})],-1)),g(de,{onSearch:c})]),o("div",fe,[g(ue,{"active-nav-item":e.activeNavItem,"user-name":e.userName,onNavigate:t[0]||(t[0]=e=>n("navigate",e)),onLogout:t[1]||(t[1]=e=>n("logout"))},null,8,["active-nav-item","user-name"]),o("div",ye,[f(a.$slots,"default",{},void 0)])])]))}}),[["__scopeId","data-v-be10e9ab"]]),he={key:0,class:"layout-wrapper"},ke={key:1,class:"no-layout-wrapper"},we=re(e({__name:"LayoutWrapper",setup(e){const t=b(),l=d(),s=T(),o=a("home"),n=y(()=>t.meta.layout||"none"),r=y(()=>"base"===n.value);h(()=>t.name,e=>{switch(e){case"Home":default:o.value="home";break;case"Search":o.value="search";break;case"Settings":o.value="settings";break;case"Category":const e=t.params.category;o.value=e||"home";break;case"Details":o.value="details"}},{immediate:!0});const u=e=>{switch(o.value=e,e){case"home":l.push({name:"Home"});break;case"search":l.push({name:"Search"});break;case"settings":l.push({name:"Settings"});break;case"movies":l.push({name:"Category",params:{category:"movies"}});break;case"tvshows":l.push({name:"Category",params:{category:"tvshows"}});break;case"collections":l.push({name:"Category",params:{category:"collections"}});break;default:const a=new CustomEvent("sidebar-navigate",{detail:e});window.dispatchEvent(a)}},c=()=>{s.logout(),l.push({name:"Login"})},m=e=>{const a=new CustomEvent("app-search",{detail:e});window.dispatchEvent(a)};return(e,a)=>{const t=I("RouterView");return r.value?(v(),i("div",he,[g(be,{"active-nav-item":o.value,"user-name":k(s).currentUser.value?.Name||"User",onNavigate:u,onLogout:c,onSearch:m},{default:w(()=>[g(t)]),_:1},8,["active-nav-item","user-name"])])):(v(),i("div",ke,[g(t)]))}}}),[["__scopeId","data-v-b2924f01"]]),Ie={class:"login-container"},Ee={key:0,class:"error-message"},Ce={class:"form-group"},Se=["disabled"],_e={class:"form-group"},xe=["disabled"],Pe={class:"form-group"},De=["disabled"],Le=["disabled"],Te=["disabled"],Ae=e({__name:"LoginForm",props:{isLoading:{type:Boolean},error:{}},setup(e){const t=d(),l=T(),n=A(),r=a("http://localhost:8096"),c=a(""),p=a(""),g=a(""),f=async e=>{if(e&&e.preventDefault(),r.value&&c.value)try{const e=await n.authenticateByName(r.value,c.value,p.value);l.login(e.User),t.push({name:"Home"})}catch(a){g.value=a,console.error("Login failed:",a)}},y=()=>{l.enableDemoMode(),t.push({name:"Home"})};return(a,t)=>(v(),i("div",Ie,[o("div",{class:s(["login-box",{"bg-red":g.value}])},[t[6]||(t[6]=o("div",{class:"logo-wrapper"},[o("img",{src:B,alt:"EmbyFlix",class:"login-logo"})],-1)),t[7]||(t[7]=o("p",null,"Connect to your Emby Server",-1)),g.value?(v(),i("div",Ee,m(g.value),1)):u("",!0),o("form",{onSubmit:f},[o("div",Ce,[t[3]||(t[3]=o("label",{for:"server-url"},"Server URL",-1)),E(o("input",{id:"server-url","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"text",placeholder:"https://your-server:8096",disabled:e.isLoading},null,8,Se),[[C,r.value]])]),o("div",_e,[t[4]||(t[4]=o("label",{for:"username"},"Username",-1)),E(o("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),type:"text",placeholder:"Enter username",disabled:e.isLoading},null,8,xe),[[C,c.value]])]),o("div",Pe,[t[5]||(t[5]=o("label",{for:"password"},"Password",-1)),E(o("input",{id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),type:"password",placeholder:"Enter password",disabled:e.isLoading},null,8,De),[[C,p.value]])]),o("button",{type:"submit",class:"btn-primary",disabled:e.isLoading||!r.value||!c.value||!p.value||p.value.length<8},m(e.isLoading?"Connecting...":"Connect to Server"),9,Le),o("button",{type:"button",class:"btn-secondary",disabled:e.isLoading,onClick:y}," Demo Mode (Test UI) ",8,Te)],32)],2)]))}}),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"})),Me={class:"hero-slider-container"},Ue={key:0,class:"slider-section-title"},Re=["data-slider-id"],Oe={class:"hero-slider"},Fe=["src","alt"],Ve=["src","alt"],$e={class:"slide-meta"},Be={key:0,class:"meta-item"},We={key:1,class:"meta-item rating"},qe={key:2,class:"meta-item"},Ge={key:3,class:"meta-item"},He={key:2,class:"slide-genres"},ze={key:3,class:"slide-description"},Ke={class:"slide-actions"},Ye={class:"slider-indicators"},je=["onClick","aria-label"],Xe=re(e({__name:"HeroSlider",props:{items:{},getImageUrl:{},title:{},showFavoriteButton:{type:Boolean,default:!0},height:{default:"600px"},titleSize:{default:"3rem"},sliderId:{default:"hero"}},emits:["play","favorite","navigate"],setup(e,{emit:c}){const d=e,f=A(),b=L(),I=T(),E=R(f,b,I.isDemoMode),C=c,x=a(),P=a(0),D=a("slider"),F=a("slider"),V=a(new Map),$=a(new Map),B=a(new Set),W=()=>{P.value=(P.value+1)%d.items.length},q=()=>{P.value=(P.value-1+d.items.length)%d.items.length},G=e=>{e>=0&&e<d.items.length&&(P.value=e,D.value="slider")},H=e=>{if(x.value===document.activeElement){if(console.log(N(e)),M(e,U.CHANNEL_UP))return e.preventDefault(),e.stopPropagation(),void W();if(M(e,U.CHANNEL_DOWN))return e.preventDefault(),e.stopPropagation(),void q();if(M(e,U.MEDIA_PLAY)||M(e,U.MEDIA_PLAY_PAUSE))return e.preventDefault(),e.stopPropagation(),void X(d.items[P.value]);if(M(e,U.MEDIA_RECORD))return e.preventDefault(),e.stopPropagation(),void Q(d.items[P.value]);if(M(e,U.INFO))return e.preventDefault(),e.stopPropagation(),void Z(d.items[P.value]);if(M(e,U.COLOR_RED))return e.preventDefault(),e.stopPropagation(),void X(d.items[P.value]);if(M(e,U.COLOR_GREEN))return e.preventDefault(),e.stopPropagation(),void Q(d.items[P.value]);if(e.keyCode>=48&&e.keyCode<=57){const a=48===e.keyCode?9:e.keyCode-49;return void(a<d.items.length&&(e.preventDefault(),e.stopPropagation(),G(a)))}}},z=e=>{if(x.value===document.activeElement)switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),"slider"===D.value?Z(d.items[P.value]):"play"===D.value?X(d.items[P.value]):"favorite"===D.value&&Q(d.items[P.value]);break;case"ArrowLeft":if(e.preventDefault(),e.stopPropagation(),"slider"===D.value)if(0===P.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"left"});window.dispatchEvent(e)}else q();else"play"===D.value?D.value="slider":"favorite"===D.value&&(D.value="play");break;case"ArrowRight":e.preventDefault(),e.stopPropagation(),"slider"===D.value?W():"play"===D.value?d.showFavoriteButton?D.value="favorite":(W(),D.value="slider"):"favorite"===D.value&&(W(),D.value="slider");break;case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),"slider"===D.value)D.value="play";else if("play"===D.value||"favorite"===D.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"down"});window.dispatchEvent(e)}break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),"slider"===D.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"up"});window.dispatchEvent(e)}else("play"===D.value||"favorite"===D.value)&&(D.value="slider")}},K=e=>{const a=e.relatedTarget;(!a||!x.value?.contains(a))&&(D.value=F.value)},Y=()=>{F.value=D.value},j=e=>{const a=e.relatedTarget;(!a||!x.value?.contains(a))&&(D.value=F.value)};t(()=>{D.value="slider",x.value&&(x.value.addEventListener("keydown",z),x.value.addEventListener("keydown",H),x.value.addEventListener("focus",j,!0),x.value.addEventListener("focusin",K),x.value.addEventListener("focusout",Y))}),l(()=>{x.value&&(x.value.removeEventListener("keydown",z),x.value.removeEventListener("keydown",H),x.value.removeEventListener("focus",j,!0),x.value.removeEventListener("focusin",K),x.value.removeEventListener("focusout",Y))});const X=e=>{C("play",e)},Q=e=>{C("favorite",e)},Z=e=>{C("navigate",e)},{formatRuntime:J}=O(),ee=y(()=>d.items[P.value]),ae=y(()=>"Series"===ee.value?.Type),te=y(()=>ae.value?"Go to Show":"Play"),le=y(()=>ae.value?"fa-arrow-right":"fa-play"),ie=async e=>await E.loadImageUrl(e,d.getImageUrl,d.items),se=e=>B.value.has(e)?"":$.value.get(e)||"",oe=e=>{E.preloadImage(e)},ne=async()=>{const e=d.items[P.value];if(e){if(!V.value.has(e.Id)){const a=await ie(e.Id);a&&V.value.set(e.Id,a)}if(!$.value.has(e.Id)){const a=(e=>{if(I.isDemoMode.value)return"";try{return f.getImageUrl(e,"Logo",500)}catch(a){return""}})(e.Id);a&&$.value.set(e.Id,a)}}(async()=>{const e=(P.value+1)%d.items.length,a=(P.value-1+d.items.length)%d.items.length,t=await ie(d.items[e].Id);t&&(V.value.set(d.items[e].Id,t),oe(t));const l=await ie(d.items[a].Id);l&&(V.value.set(d.items[a].Id,l),oe(l))})()};return h(()=>P.value,()=>{ne()},{immediate:!0}),h(()=>d.items,()=>{d.items.length>0&&ne()},{immediate:!0}),(a,t)=>(v(),i("div",Me,[d.title?(v(),i("h2",Ue,m(d.title),1)):u("",!0),o("div",{ref_key:"sliderWrapper",ref:x,class:"hero-slider-wrapper",tabindex:"0",style:p({height:d.height}),"data-slider-id":d.sliderId},[o("div",Oe,[g(_,{name:"slide-fade"},{default:w(()=>{return[d.items[P.value]?(v(),i("div",{key:d.items[P.value].Id,class:"hero-slide"},[o("div",{class:"slide-background",onClick:t[0]||(t[0]=e=>Z(d.items[P.value]))},[o("img",{src:(a=d.items[P.value].Id,V.value.get(a)||""||d.items[P.value].ImageUrl),alt:d.items[P.value].Name,loading:"lazy",decoding:"async"},null,8,Fe)]),o("div",{class:s(["slide-content",{slim:"600px"!==e.height}])},[se(d.items[P.value].Id)?(v(),i("img",{key:0,src:se(d.items[P.value].Id),alt:d.items[P.value].Name,class:"slide-logo",onError:t[1]||(t[1]=e=>(e=>{console.log(`[HeroSlider] Logo failed to load for item: ${e}`),B.value.add(e),$.value.delete(e)})(d.items[P.value].Id))},null,40,Ve)):(v(),i("h1",{key:1,class:"slide-title",style:p({fontSize:d.titleSize})},m(d.items[P.value].Name),5)),o("div",$e,[d.items[P.value]?.ProductionYear?(v(),i("span",Be,m(d.items[P.value]?.ProductionYear),1)):u("",!0),d.items[P.value]?.CommunityRating?(v(),i("span",We," ⭐ "+m(d.items[P.value]?.CommunityRating?.toFixed(1)),1)):u("",!0),d.items[P.value]?.OfficialRating?(v(),i("span",qe,m(d.items[P.value]?.OfficialRating),1)):u("",!0),d.items[P.value]?.RunTimeTicks?(v(),i("span",Ge,m(k(J)(d.items[P.value]?.RunTimeTicks)),1)):u("",!0)]),d.items[P.value]?.Genres?(v(),i("div",He,[(v(!0),i(n,null,r(d.items[P.value]?.Genres?.slice(0,3),e=>(v(),i("span",{key:e,class:"genre-tag"},m(e),1))),128))])):u("",!0),d.items[P.value]?.Overview?(v(),i("p",ze,m(d.items[P.value]?.Overview?.substring(0,150))+"... ",1)):u("",!0),o("div",Ke,[o("button",{tabindex:"-1",class:s(["btn-play",{focused:"play"===D.value}]),onClick:t[2]||(t[2]=e=>X(d.items[P.value]))},[o("i",{class:s(["fas",le.value])},null,2),S(" "+m(te.value),1)],2),d.showFavoriteButton?(v(),i("button",{key:0,tabindex:"-1",class:s(["btn-favorite",{focused:"favorite"===D.value}]),onClick:t[3]||(t[3]=e=>Q(d.items[P.value]))},[...t[4]||(t[4]=[o("i",{class:"fas fa-heart"},null,-1),S(" Add to Favorites ",-1)])],2)):u("",!0)])],2)])):u("",!0)];var a}),_:1})]),o("div",Ye,[(v(!0),i(n,null,r(d.items,(e,a)=>(v(),i("button",{key:e.Id,tabindex:"-1",class:s(["indicator",{active:P.value===a}]),onClick:e=>G(a),"aria-label":`Go to slide ${a+1}`},null,10,je))),128))])],12,Re)]))}}),[["__scopeId","data-v-2740ae22"]]),Qe={class:"card-image"},Ze=["src","alt"],Je={key:1,class:"placeholder-image"},ea={key:2,class:"placeholder-image"},aa={key:3,class:"watched-badge",title:"Watched"},ta={key:4,class:"rating-badges"},la=["title"],ia=["title"],sa={key:5,class:"streaming-providers"},oa=["src","alt","title"],na=["title"],ra={class:"card-info min-h-16"},ua={class:"card-title"},ca={key:0,class:"card-year"},da=re(e({__name:"MediaCard",props:{item:{},imageUrl:{},streamingProviders:{}},emits:["click"],setup(e,{emit:t}){const l=e,c=t,d=a(),p=a(!1);F(d,{threshold:.01,rootMargin:"200px",onEnter:()=>{p.value=!0}});const g=e=>"Id"in e&&"Name"in e,f=e=>"title"in e&&!("name"in e),b=e=>"name"in e&&"first_air_date"in e,h=y(()=>g(l.item)?l.item.Name:f(l.item)?l.item.title:b(l.item)?l.item.name:""),k=y(()=>(console.log("item::",l.item),g(l.item)?l.item.ProductionYear?.toString()||null:f(l.item)?l.item.release_date?new Date(l.item.release_date).getFullYear().toString():null:b(l.item)&&l.item.first_air_date?new Date(l.item.first_air_date).getFullYear().toString():null)),w=y(()=>l.imageUrl?l.imageUrl:g(l.item)?l.item.ImageUrl:null),I=y(()=>g(l.item)&&l.item.CommunityRating?{value:l.item.CommunityRating,display:`${(10*l.item.CommunityRating).toFixed(0)}%`}:!g(l.item)&&l.item.vote_average?{value:l.item.vote_average,display:`${(10*l.item.vote_average).toFixed(0)}%`}:null),E=y(()=>g(l.item)&&l.item.CriticRating?{value:l.item.CriticRating,display:`${l.item.CriticRating}%`}:null),C=y(()=>null!==I.value||null!==E.value),S=y(()=>!!g(l.item)&&!0===l.item.UserData?.Played),_=y(()=>{if(g(l.item)){if("Movie"===l.item.Type)return"movie";if("Series"===l.item.Type)return"tv"}else{if(f(l.item))return"movie";if(b(l.item))return"tv"}return null}),P=y(()=>l.streamingProviders?.slice(0,3)||[]);return(a,t)=>(v(),i("div",{ref_key:"cardRef",ref:d,class:"media-card",tabindex:"0",onClick:t[0]||(t[0]=a=>c("click",e.item)),onKeydown:t[1]||(t[1]=x(a=>c("click",e.item),["enter"]))},[o("div",Qe,[p.value&&w.value?(v(),i("img",{key:0,src:w.value,alt:h.value,loading:"lazy",decoding:"async"},null,8,Ze)):p.value?(v(),i("div",ea,m(h.value),1)):(v(),i("div",Je," Loading... ")),S.value?(v(),i("div",aa,[...t[2]||(t[2]=[o("span",null,"Watched",-1)])])):u("",!0),C.value?(v(),i("div",ta,[I.value?(v(),i("div",{key:0,class:"rating-badge community",title:`Audience Score: ${I.value.display}`},[t[3]||(t[3]=o("i",{class:"fas fa-users"},null,-1)),o("span",null,m(I.value.display),1)],8,la)):u("",!0),E.value?(v(),i("div",{key:1,class:"rating-badge critic",title:`Critics Score: ${E.value.display}`},[t[4]||(t[4]=o("i",{class:"fas fa-star"},null,-1)),o("span",null,m(E.value.display),1)],8,ia)):u("",!0)])):u("",!0),P.value.length>0?(v(),i("div",sa,[(v(!0),i(n,null,r(P.value,e=>{return v(),i("img",{key:e.provider_id,src:(a=e.logo_path,`https://image.tmdb.org/t/p/w92${a}`),alt:e.provider_name,title:`Available on ${e.provider_name}`,class:"provider-logo"},null,8,oa);var a}),128))])):u("",!0),_.value?(v(),i("div",{key:6,class:"media-type-icon",title:"movie"===_.value?"Movie":"TV Show"},[o("i",{class:s("movie"===_.value?"fas fa-film":"fas fa-tv")},null,2)],8,na)):u("",!0)]),o("div",ra,[o("h3",ua,m(h.value),1),k.value?(v(),i("div",ca,m(k.value),1)):u("",!0)])],544))}}),[["__scopeId","data-v-facdac43"]]),va={class:"media-row","data-nav-zone":"media-row"},ma={class:"row-container","data-nav-container":"media-row"},pa={key:0,class:"loading-state"},ga=re(e({__name:"MediaRow",props:{items:{},loading:{type:Boolean},getImageUrl:{type:Function},loop:{type:Boolean}},emits:["itemClick","nearEnd"],setup(e,{emit:s}){const c=e,d=s,m=e=>"embyItem"in e&&"tmdbData"in e,p=e=>"Id"in e&&"Name"in e&&!("title"in e)&&!("name"in e),g=y(()=>c.loop&&0!==c.items.length?[...c.items,...c.items,...c.items]:c.items),f=a();let b=!1,k=null;const w=e=>{if(!f.value)return;const a=.8*f.value.clientWidth,t=f.value.scrollLeft+("right"===e?a:-a);f.value.scrollTo({left:t,behavior:"smooth"})},I=()=>{if(k)return;if(k=window.setTimeout(()=>{k=null},100),!f.value||b)return;const{scrollLeft:e,scrollWidth:a,clientWidth:t}=f.value;if(c.loop&&c.items.length>0){const t=a/3;e>=2*t?(b=!0,f.value.scrollLeft=e-t,setTimeout(()=>{b=!1},50)):e<=.1*t&&(b=!0,f.value.scrollLeft=e+t,setTimeout(()=>{b=!1},50))}else{(e+t)/a>=.7&&d("nearEnd")}},E=()=>{if(!f.value||c.loop)return;const{scrollWidth:e,clientWidth:a}=f.value;e<=a&&d("nearEnd")},C=()=>{if(f.value&&c.loop&&c.items.length>0){const e=f.value.scrollWidth/3;f.value.scrollLeft=e}};return h(()=>c.items,async()=>{await D(),setTimeout(E,100)},{immediate:!1}),t(()=>{f.value&&(f.value.addEventListener("scroll",I,{passive:!0}),setTimeout(C,100),setTimeout(E,150))}),l(()=>{f.value&&f.value.removeEventListener("scroll",I)}),(a,t)=>(v(),i("div",va,[o("div",ma,[o("button",{class:"scroll-btn scroll-btn-left",tabindex:"-1",onClick:t[0]||(t[0]=e=>w("left")),"aria-label":"Scroll left"},[...t[2]||(t[2]=[o("i",{class:"fas fa-chevron-left"},null,-1)])]),o("div",{ref_key:"scrollContainer",ref:f,class:"row-content","data-nav-scrollable":"true"},[e.loading?(v(),i("div",pa,[(v(),i(n,null,r(6,e=>o("div",{key:e,class:"media-card-skeleton"})),64))])):u("",!0),(v(!0),i(n,null,r(g.value,(a,t)=>(v(),i(n,{key:`${m(a)?a.embyId:p(a)?a.Id:a.id}-${t}`},[m(a)?(v(),P(da,{key:0,item:a.embyItem,"image-url":e.getImageUrl(a.tmdbData)||void 0,"streaming-providers":a.streamingProviders,onClick:e=>d("itemClick",a.tmdbData)},null,8,["item","image-url","streaming-providers","onClick"])):p(a)?(v(),P(da,{key:1,item:a,"image-url":e.getImageUrl(a)||void 0,onClick:e=>d("itemClick",a)},null,8,["item","image-url","onClick"])):(v(),P(da,{key:2,item:a,"image-url":e.getImageUrl(a)||void 0,onClick:e=>d("itemClick",a)},null,8,["item","image-url","onClick"]))],64))),128))],512),o("button",{class:"scroll-btn scroll-btn-right",tabindex:"-1",onClick:t[1]||(t[1]=e=>w("right")),"aria-label":"Scroll right"},[...t[3]||(t[3]=[o("i",{class:"fas fa-chevron-right"},null,-1)])])])]))}}),[["__scopeId","data-v-90648296"]]),fa={class:"genre-filter","data-nav-zone":"genre-filter"},ya={class:"filter-container"},ba=["onClick","onKeydown","onFocus"],ha=re(e({__name:"GenreFilter",props:{genres:{},selectedGenres:{default:()=>[]},maxVisible:{default:8}},emits:["update:selectedGenres"],setup(e,{emit:t}){const l=e,u=t,c=a(),d=a([]),p=a(-1),g=e=>{const a=[...l.selectedGenres],t=a.indexOf(e);t>-1?a.splice(t,1):a.push(e),u("update:selectedGenres",a)},f=()=>{u("update:selectedGenres",[])},b=y(()=>l.selectedGenres.length>0),h=e=>{if(!c.value||!d.value[e])return;const a=d.value[e],t=c.value,l=a.offsetLeft,i=l+a.offsetWidth,s=t.scrollLeft,o=t.clientWidth;l<s?t.scrollTo({left:l-20,behavior:"smooth"}):i>s+o&&t.scrollTo({left:i-o+20,behavior:"smooth"})},k=(e,a,t)=>{const i=l.genres.length+1;switch(e.key){case"ArrowLeft":0===a||(e.preventDefault(),e.stopPropagation(),p.value=a-1,D(()=>{d.value[p.value]?.focus(),h(p.value)}));break;case"ArrowRight":e.preventDefault(),e.stopPropagation(),a<i-1&&(p.value=a+1,D(()=>{d.value[p.value]?.focus(),h(p.value)}));break;case"ArrowUp":case"ArrowDown":break;case"Enter":case" ":e.preventDefault(),e.stopPropagation(),0===a?f():void 0!==t&&g(t)}},w=e=>{p.value=e},I=(e,a)=>{e&&(d.value[a]=e)};return(a,t)=>(v(),i("div",fa,[o("div",ya,[o("div",{ref_key:"scrollContainer",ref:c,class:"genres-list"},[o("button",{ref:e=>I(e,0),class:s(["genre-pill",{active:!b.value}]),tabindex:"0",onClick:f,onKeydown:t[0]||(t[0]=e=>k(e,0)),onFocus:t[1]||(t[1]=e=>w(0))}," All ",34),(v(!0),i(n,null,r(e.genres,(e,a)=>{return v(),i("button",{key:e.id,ref_for:!0,ref:e=>I(e,a+1),class:s(["genre-pill",{active:(t=e.id,l.selectedGenres.includes(t))}]),tabindex:"0",onClick:a=>g(e.id),onKeydown:t=>k(t,a+1,e.id),onFocus:e=>w(a+1)},m(e.name),43,ba);var t}),128))],512)])]))}}),[["__scopeId","data-v-4ea3843b"]]),ka={class:"modal-container"},wa={class:"modal-body"},Ia={key:0,class:"error-message"},Ea={class:"form-group"},Ca=re(e({__name:"TmdbApiKeyModal",emits:["close","submit"],setup(e,{emit:t}){const l=t,s=a(""),n=a(""),r=()=>{console.log("[TmdbApiKeyModal] handleSubmit called with:",s.value),s.value.trim()?s.value.trim().length<32?n.value="API key appears to be invalid (too short)":(console.log("[TmdbApiKeyModal] Emitting submit event"),l("submit",s.value.trim())):n.value="Please enter a valid API key"},d=()=>{l("close")};return(e,a)=>(v(),i("div",{class:"modal-overlay",onClick:c(d,["self"])},[o("div",ka,[o("div",{class:"modal-header"},[a[2]||(a[2]=o("h2",null,"TMDB API Key Required",-1)),o("button",{class:"close-button",onClick:d},[...a[1]||(a[1]=[o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M18 6L6 18M6 6l12 12","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),o("div",wa,[a[6]||(a[6]=o("p",{class:"description"}," To display trending movies and TV shows, we need a TMDB (The Movie Database) API key. This service is free and provides rich media information. ",-1)),n.value?(v(),i("div",Ia,m(n.value),1)):u("",!0),o("form",{onSubmit:c(r,["prevent"])},[o("div",Ea,[a[3]||(a[3]=o("label",{for:"tmdb-api-key"},"API Key",-1)),E(o("input",{id:"tmdb-api-key","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),type:"text",placeholder:"Enter your TMDB API key",autocomplete:"off",spellcheck:"false"},null,512),[[C,s.value]])]),a[5]||(a[5]=o("div",{class:"info-section"},[o("p",{class:"info-text"},[S(" Don't have an API key? "),o("a",{href:"https://www.themoviedb.org/settings/api",target:"_blank",rel:"noopener noreferrer",class:"register-link"}," Register for free on TMDB ")]),o("p",{class:"info-text small"}," After registering, you can find your API key in your account settings under the API section. ")],-1)),o("div",{class:"button-group"},[o("button",{type:"button",class:"btn-secondary",onClick:d}," Skip for Now "),a[4]||(a[4]=o("button",{type:"submit",class:"btn-primary"}," Save API Key ",-1))])],32)])])]))}}),[["__scopeId","data-v-5a9c93db"]]),Sa={key:0,class:"movie-grid-container"},_a={key:0,class:"grid-title"},xa={class:"grid",style:{position:"relative"},"data-nav-zone":"movie-grid"},Pa=e({__name:"MovieGrid",props:{items:{},title:{},getImageUrl:{type:Function}},emits:["itemClick"],setup(e,{emit:l}){const s=e,c=l,d=a(),g=a(0),f=a(600),b=y(()=>{if(!d.value)return 4;const e=d.value.clientWidth;return Math.max(1,Math.floor(e/196))}),h=y(()=>Math.ceil(f.value/336)+2),k=y(()=>Math.max(0,Math.floor(g.value/336)-1)),w=y(()=>{const e=k.value+h.value;return Math.min(Math.ceil(s.items.length/b.value),e)}),I=y(()=>{const e=k.value*b.value,a=w.value*b.value;return s.items.slice(e,a)}),E=y(()=>336*k.value),C=e=>{console.log("HandleScroll",e);const a=e.target;g.value=a.scrollTop,f.value=a.clientHeight};return t(()=>{d.value&&(f.value=d.value.clientHeight)}),(a,t)=>I.value?(v(),i("div",Sa,[e.title?(v(),i("h2",_a,m(e.title),1)):u("",!0),o("div",{ref_key:"gridContainer",ref:d,class:"grid-wrapper",onScroll:C},[o("div",xa,[o("div",{style:p({transform:`translateY(${E.value}px)`})},[(v(!0),i(n,null,r(e.items,a=>(v(),P(da,{key:a.Id,item:a,"image-url":e.getImageUrl?e.getImageUrl(a.Id):a.ImageUrl,onClick:e=>c("itemClick",a)},null,8,["item","image-url","onClick"]))),128))],4)])],544)])):u("",!0)}}),Da={class:"details-hero"},La={class:"hero-content"},Ta=["src","alt"],Aa={key:1,class:"hero-title"},Na={class:"hero-actions"},Ma={class:"hero-meta"},Ua={key:0,class:"meta-item"},Ra={key:1,class:"meta-item meta-rating-badge"},Oa={key:2,class:"meta-item"},Fa={key:3,class:"meta-item meta-star-rating"},Va={key:2,class:"hero-genres"},$a={key:0},Ba={key:3,class:"hero-overview"},Wa={class:"hero-extra-actions"},qa=["title"],Ga=re(e({__name:"MovieDetails",props:{item:{},imageUrl:{},backdropUrl:{},logoUrl:{}},emits:["play","back","browse","removeFromContinueWatching","markAsUnwatched"],setup(e,{emit:l}){const c=e,d=l,p=a(!1);t(()=>{const e=document.querySelector(".btn-hero-play");e&&e.focus()});const{formatRuntime:g,formatRating:f}=O(),b=y(()=>"BoxSet"===c.item.Type),w=y(()=>!0===c.item.UserData?.Played),I=()=>{console.log(`[MovieDetails] Logo failed to load for item: ${c.item.Name}`),p.value=!0};h(()=>[c.item.Id,c.logoUrl],()=>{p.value=!1});const E=()=>{const e=document.querySelector(".main-content");e&&e.scrollTo({top:0,behavior:"smooth"})},C=(e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if("play"===a){const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else if("back"===a){const e=document.querySelector(".btn-hero-play");e?.focus()}else if("mark"===a){const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}break;case"ArrowRight":if("play"===a){const e=document.querySelector(".btn-hero-secondary");e?.focus()}else if("back"===a){const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");e?.focus()}break;case"ArrowDown":if("play"===a||"back"===a){const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");if(e)e.focus();else{const e=document.querySelector(".season-buttons button"),a=document.querySelector(".similar-titles .media-card");e?e.focus():a&&a.focus()}}else if("mark"===a){const e=document.querySelector(".season-buttons button"),a=document.querySelector(".similar-titles .media-card");e?e.focus():a&&a.focus()}break;case"ArrowUp":if("mark"===a){const e=document.querySelector(".btn-hero-play");e?.focus()}}};return(a,t)=>(v(),i("div",Da,[o("div",La,[e.logoUrl&&!p.value?(v(),i("img",{key:0,src:e.logoUrl,alt:e.item.Name,class:"hero-logo",onError:I},null,40,Ta)):(v(),i("h1",Aa,m(e.item.Name),1)),o("div",Na,[b.value?(v(),i("button",{key:1,class:"btn-hero-play",onClick:t[2]||(t[2]=a=>d("browse",e.item)),onKeydown:t[3]||(t[3]=e=>C(e,"play")),onFocus:E},[...t[9]||(t[9]=[o("i",{class:"fas fa-folder-open"},null,-1),S(" Browse Collection ",-1)])],32)):(v(),i("button",{key:0,class:"btn-hero-play",tabindex:"0",onClick:t[0]||(t[0]=a=>d("play",e.item)),onKeydown:t[1]||(t[1]=e=>C(e,"play")),onFocus:E},[...t[8]||(t[8]=[o("i",{class:"fas fa-play"},null,-1),S(" Play Now ",-1)])],32)),o("button",{class:"btn-hero-secondary",tabindex:"0",onClick:t[4]||(t[4]=e=>d("back")),onKeydown:t[5]||(t[5]=e=>C(e,"back")),onFocus:E},[...t[10]||(t[10]=[o("i",{class:"fas fa-info-circle"},null,-1),S(" More Information ",-1)])],32)]),o("div",Ma,[e.item.ProductionYear?(v(),i("span",Ua,m(e.item.ProductionYear),1)):u("",!0),e.item.OfficialRating?(v(),i("span",Ra,m(e.item.OfficialRating),1)):u("",!0),e.item.RunTimeTicks?(v(),i("span",Oa,m(k(g)(e.item.RunTimeTicks)),1)):u("",!0),e.item.CommunityRating?(v(),i("span",Fa,[t[11]||(t[11]=o("i",{class:"fas fa-star"},null,-1)),S(" "+m(k(f)(e.item.CommunityRating)),1)])):u("",!0)]),e.item.Genres&&e.item.Genres.length?(v(),i("div",Va,[(v(!0),i(n,null,r(e.item.Genres.slice(0,3),(a,t)=>(v(),i("span",{key:a},[S(m(a),1),t<Math.min(e.item.Genres.length,3)-1?(v(),i("span",$a," • ")):u("",!0)]))),128))])):u("",!0),e.item.Overview?(v(),i("p",Ba,m(e.item.Overview),1)):u("",!0),o("div",Wa,[b.value?u("",!0):(v(),i("button",{key:0,class:"btn-hero-secondary",tabindex:"0",onClick:t[6]||(t[6]=a=>w.value?d("markAsUnwatched",e.item):d("removeFromContinueWatching",e.item)),onKeydown:t[7]||(t[7]=e=>C(e,"mark")),onFocus:E,title:w.value?"Mark as Unwatched":"Mark as Watched"},[S(m(w.value?"Mark as Unwatched":"Mark as Watched")+" ",1),o("i",{class:s(w.value?"fas fa-times":"fas fa-check")},null,2)],40,qa))])])]))}}),[["__scopeId","data-v-d2ca501c"]]),Ha={class:"player-container"},za={key:0,class:"player-overlay"},Ka={class:"error-message"},Ya={key:1,class:"skip-intro-container","data-nav-zone":"skip-controls"},ja=["aria-label"],Xa={key:2,class:"media-sidebar","data-nav-zone":"media-sidebar"},Qa={class:"media-card-player"},Za={class:"media-poster"},Ja=["src","alt"],et={class:"media-info"},at={key:0,class:"show-logo-container"},tt=["src","alt"],lt={key:1,class:"show-title"},it={class:"show-genres"},st={key:0},ot={class:"show-description"},nt={class:"up-next-section"},rt={class:"up-next-list"},ut=["aria-label"],ct={class:"up-next-thumbnail"},dt=["src","alt"],vt={class:"up-next-details"},mt={class:"up-next-episode"},pt={class:"top-bar"},gt={class:"top-bar-info"},ft={class:"episode-label"},yt={class:"episode-title"},bt={class:"top-bar-actions"},ht={class:"volume-menu-container"},kt={key:0,class:"context-menu volume-menu"},wt={class:"volume-slider-container"},It=["value"],Et={class:"volume-percentage"},Ct={class:"bottom-controls"},St={class:"control-buttons-row"},_t={class:"subtitle-menu-container"},xt={key:0,class:"context-menu subtitle-menu"},Pt={key:0,class:"fas fa-check"},Dt=["onClick"],Lt={key:0,class:"fas fa-check"},Tt={class:"quality-menu-container"},At={key:0,class:"context-menu quality-menu"},Nt=["onClick"],Mt={key:0,class:"fas fa-check"},Ut=["aria-label"],Rt={class:"progress-bar-track"},Ot={class:"time-display"},Ft={class:"time-current"},Vt={class:"time-remaining"},$t={class:"timezone-time"},Bt={class:"playback-buttons","data-nav-zone":"player-controls"},Wt=["aria-label","title"],qt=["aria-label"],Gt=["aria-label","title"],Ht=re(e({__name:"VideoPlayer",props:{item:{},streamUrl:{}},emits:["close","progress","playbackStart","playbackStop","switchEpisode"],setup(e,{emit:c}){const d=e,g=A(),f=V(),b=c,h=a(null),w=y(()=>d.streamUrl),I=a(0),E=a(0),C=y(()=>0===E.value?0:I.value/E.value*100),_=a(!0);let x=null;const P=a(!1),D=a(1),L=a(!1),T=a(!1),R=a(!1),O=a([]),F=a([]),B=a(null),W=a("Auto"),q=a(null),G=a(!1),H=a(null),z=a(!1),K=a("Skip Intro");let Y=null;const j=a(null),X=a(null),Q=y(()=>"Episode"===d.item.Type&&d.item.SeriesId),Z=e=>e/1e7,J=e=>Math.floor(1e7*e),{isPlaying:ee,errorMessage:ae,handlePlayPause:te,handleStop:le,handleSeek:ie}=$(h,w,{onProgress:(e,a)=>{b("progress",e,a)},onPlaybackStart:()=>{b("playbackStart")},onPlaybackStop:e=>{b("playbackStop",e)}}),se=()=>{h.value&&(I.value=h.value.currentTime,E.value=h.value.duration||0,oe())},oe=()=>{if(!h.value)return G.value=!1,void(z.value=!1);const e=J(I.value);if(q.value){const{IntroStart:a,IntroEnd:t}=q.value;if(e>=a&&e<=t)return G.value=!0,z.value=!1,void(K.value="Skip Intro")}if(H.value){const{CreditsStart:a,CreditsEnd:t}=H.value;if(e>=a&&e<=t)return G.value=!1,z.value=!0,void(K.value="Skip Credits")}G.value=!1,z.value=!1},ne=()=>{if(h.value){if(G.value&&q.value){const e=Z(q.value.IntroEnd);h.value.currentTime=e,G.value=!1,console.log("[VideoPlayer] Skipped intro to",e)}else if(z.value&&H.value){if(Q.value&&j.value)return console.log("[VideoPlayer] Skipping credits and going to next episode:",j.value.Name),void ue();const e=Z(H.value.CreditsEnd);h.value.currentTime=e,z.value=!1,console.log("[VideoPlayer] Skipped credits to",e)}ye()}},re=()=>{X.value&&(console.log("[VideoPlayer] Navigating to previous episode:",X.value.Name),b("switchEpisode",X.value.Id))},ue=()=>{j.value&&(console.log("[VideoPlayer] Navigating to next episode:",j.value.Name),b("switchEpisode",j.value.Id))},ce=e=>{if(!isFinite(e))return"0:00";const a=Math.floor(e/3600),t=Math.floor(e%3600/60),l=Math.floor(e%60);return a>0?`${a}:${t.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${t}:${l.toString().padStart(2,"0")}`},de=e=>{if(!e)return"";const a=e.ImageTags?.Primary||e.SeriesPrimaryImageTag,t=e.ImageTags?.Primary?e.Id:e.SeriesId||e.Id;return a&&g.serverUrl.value?`${g.serverUrl.value}/emby/Items/${t}/Images/Primary?tag=${a}&maxWidth=400`:""},ve=a(!1),me=e=>e&&g.serverUrl.value?ve.value?"":e.SeriesId?g.getImageUrl(e.SeriesId,"Logo",500):g.getImageUrl(e.Id,"Logo",500):"",pe=()=>{console.log("[VideoPlayer] Logo not available, showing title instead"),ve.value=!0},ge=()=>{if(!h.value)return"";const e=new Date,a=new Date(e),t=new Date(e.getTime()+1e3*(E.value-I.value)),l=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;return`${l(a)} - ${l(t)}`},fe=e=>{if(!h.value)return;const a=e.currentTarget.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*E.value;h.value.currentTime=t,ye()},ye=()=>{_.value=!0,null!==x&&clearTimeout(x),x=window.setTimeout(()=>{_.value=!1},3e3)},be=()=>{ye()},he=e=>{const a=e.target;a.closest(".subtitle-menu-container")||a.closest(".quality-menu-container")||a.closest(".volume-menu-container")||(T.value=!1,R.value=!1,L.value=!1)},ke=()=>{le(),b("close")},we=async()=>{const e=document.querySelector(".player-container");if(e){try{document.fullscreenElement?(await document.exitFullscreen(),P.value=!1):(await e.requestFullscreen(),P.value=!0)}catch(a){console.error("[VideoPlayer] Fullscreen error:",a)}ye()}},Ie=()=>{P.value=!!document.fullscreenElement},Ee=e=>{const a=e.target,t=parseFloat(a.value);D.value=t,h.value&&(h.value.volume=t),ye()},Ce=()=>{L.value=!L.value,L.value&&(T.value=!1,R.value=!1),ye()},Se=()=>{T.value=!T.value,T.value&&(R.value=!1,L.value=!1),ye()},_e=()=>{R.value=!R.value,R.value&&(T.value=!1,L.value=!1),ye()},xe=e=>{if(B.value=e,!h.value)return;const a=h.value.textTracks;for(let t=0;t<a.length;t++)a[t].mode="disabled";null!==e&&a[e]&&(a[e].mode="showing"),T.value=!1,ye(),console.log("[VideoPlayer] Subtitle selected:",null===e?"Off":O.value[e]?.DisplayTitle)},Pe=()=>{se(),setTimeout(()=>{console.log("[VideoPlayer] Starting credits detection after delay"),(async()=>{try{if(!h.value||!h.value.duration)return void console.log("[VideoPlayer] Video not ready for credits detection");const e=h.value.duration;if(d.streamUrl.includes("BigBuckBunny")||d.streamUrl.includes("commondatastorage")){const a=Math.max(0,e-30),t=e;return H.value={CreditsStart:J(a),CreditsEnd:J(t),confidence:1,detectionMethod:"manual"},void console.log("[VideoPlayer] Demo mode: Using simulated credits markers:",{start:a,end:t,duration:e})}const a=await f.getCreditsMarker(d.item.Id,d.item.SeriesId,null);if(a)return H.value=a,void console.log("[VideoPlayer] Credits markers loaded from cache:",{start:Z(a.CreditsStart),end:Z(a.CreditsEnd),confidence:a.confidence,method:a.detectionMethod});console.log("[VideoPlayer] Starting passive credits detection"),Y=f.detectCreditsPassively(h.value,e=>{H.value=e,console.log("[VideoPlayer] Credits detected and saved:",{start:Z(e.CreditsStart),end:Z(e.CreditsEnd),confidence:e.confidence}),d.item.SeriesId&&f.saveCreditsToStorage(d.item.SeriesId,d.item.Id,e),Y&&(Y(),Y=null)})}catch(e){console.error("[VideoPlayer] Failed to fetch credits markers:",e)}})()},5e3)},De=e=>(console.log(N(e)),M(e,U.MEDIA_PLAY_PAUSE)||M(e,U.MEDIA_PLAY)||M(e,U.MEDIA_PAUSE)?(e.preventDefault(),te(),void ye()):M(e,U.MEDIA_STOP)?(e.preventDefault(),void ke()):M(e,U.MEDIA_REWIND)?(e.preventDefault(),ie(-10),void ye()):M(e,U.MEDIA_FAST_FORWARD)?(e.preventDefault(),ie(10),void ye()):M(e,U.MEDIA_TRACK_PREVIOUS)||M(e,U.CHANNEL_DOWN)?(e.preventDefault(),void(X.value&&re())):M(e,U.MEDIA_TRACK_NEXT)||M(e,U.CHANNEL_UP)?(e.preventDefault(),void(j.value&&ue())):M(e,U.CAPTION)?(e.preventDefault(),Se(),void ye()):M(e,U.PICTURE_SIZE)?(e.preventDefault(),void we()):M(e,U.INFO)||M(e,U.MENU)||M(e,U.TOOLS)?(e.preventDefault(),void ye()):M(e,U.EXIT)?(e.preventDefault(),void ke()):M(e,U.MEDIA_RECORD)?(e.preventDefault(),console.log("[VideoPlayer] Add to watchlist feature - to be implemented"),void ye()):M(e,U.COLOR_RED)?(e.preventDefault(),void((G.value||z.value)&&ne())):M(e,U.COLOR_GREEN)?(e.preventDefault(),Se(),void ye()):M(e,U.COLOR_YELLOW)?(e.preventDefault(),_e(),void ye()):M(e,U.COLOR_BLUE)?(e.preventDefault(),void ye()):void 0);return t(()=>{h.value&&(h.value.addEventListener("timeupdate",se),h.value.addEventListener("loadedmetadata",Pe),h.value.volume=D.value),document.addEventListener("mousemove",be),document.addEventListener("focusin",be),document.addEventListener("click",he),document.addEventListener("fullscreenchange",Ie),document.addEventListener("keydown",De),ye(),(async()=>{try{const e=await g.getIntroSkipMarkers(d.item.Id);q.value=e,e&&console.log("[VideoPlayer] Intro markers loaded:",{start:Z(e.IntroStart),end:Z(e.IntroEnd)})}catch(e){console.error("[VideoPlayer] Failed to fetch intro markers:",e)}})(),(async()=>{if(Q.value)try{const[e,a]=await Promise.all([g.getNextEpisode(d.item),g.getPreviousEpisode(d.item)]);j.value=e,X.value=a,console.log("[VideoPlayer] Adjacent episodes loaded:",{previous:a?.Name||"None",next:e?.Name||"None"})}catch(e){console.error("[VideoPlayer] Failed to fetch adjacent episodes:",e)}})(),(async()=>{try{const e=await g.getMediaSources(d.item.Id);if(e.length>0){const a=e[0];if(a.MediaStreams){O.value=a.MediaStreams.filter(e=>"Subtitle"===e.Type);const e=O.value.findIndex(e=>e.IsDefault);-1!==e&&(B.value=e),console.log("[VideoPlayer] Available subtitles:",O.value);const t=a.MediaStreams.filter(e=>"Video"===e.Type);if(t.length>0){const e=t[0],a=[{label:"Auto",bitrate:14e7}];e.Height&&(e.Height>=2160?(a.push({label:"4K",bitrate:12e7,height:2160}),a.push({label:"1080p",bitrate:4e7,height:1080}),a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):e.Height>=1080?(a.push({label:"1080p",bitrate:4e7,height:1080}),a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):e.Height>=720?(a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):a.push({label:"480p",bitrate:3e6,height:480})),F.value=a,console.log("[VideoPlayer] Available qualities:",F.value)}}}}catch(e){console.error("[VideoPlayer] Failed to fetch media info:",e)}})(),setTimeout(()=>{const e=document.querySelector(".control-btn-large");e&&e.focus()},100)}),l(()=>{h.value&&(h.value.removeEventListener("timeupdate",se),h.value.removeEventListener("loadedmetadata",Pe)),document.removeEventListener("mousemove",be),document.removeEventListener("focusin",be),document.removeEventListener("click",he),document.removeEventListener("fullscreenchange",Ie),document.removeEventListener("keydown",De),null!==x&&clearTimeout(x),Y&&(Y(),Y=null)}),(a,t)=>(v(),i("div",Ha,[o("video",{ref_key:"videoElement",ref:h,class:"video-player",crossorigin:"anonymous"}," Your browser does not support the video tag. ",512),o("div",{class:s(["controls-gradient-backdrop",{"controls-hidden":!_.value}])},null,2),k(ae)?(v(),i("div",za,[o("div",Ka," ⚠️ "+m(k(ae)),1)])):u("",!0),G.value||z.value?(v(),i("div",Ya,[o("button",{type:"button",onClick:ne,tabindex:"0",class:"skip-intro-btn player-control-btn","aria-label":K.value},[t[4]||(t[4]=o("i",{class:"fas fa-forward"},null,-1)),S(" "+m(K.value),1)],8,ja)])):u("",!0),k(ee)?u("",!0):(v(),i("div",Xa,[o("div",Qa,[o("div",Za,[o("img",{src:de(e.item),alt:e.item.Name},null,8,Ja)]),o("div",et,[me(e.item)&&!ve.value?(v(),i("div",at,[o("img",{src:me(e.item),alt:e.item.SeriesName||e.item.Name,class:"show-logo",onError:pe},null,40,tt)])):(v(),i("h2",lt,m(e.item.SeriesName||e.item.Name),1)),o("div",it,[e.item.Genres&&e.item.Genres.length?(v(),i("span",st,m(e.item.Genres.join(" • ")),1)):u("",!0)]),o("p",ot,m(e.item.Overview||"No description available."),1)]),o("div",nt,[t[8]||(t[8]=o("h3",{class:"up-next-title"},"UP NEXT",-1)),o("div",rt,[(v(),i(n,null,r(2,a=>o("div",{key:a,class:"up-next-item",tabindex:"0",role:"button","aria-label":`Episode ${a+6}`},[o("div",ct,[o("img",{src:de(e.item),alt:`Episode ${a+6}`},null,8,dt)]),o("div",vt,[t[5]||(t[5]=o("span",{class:"up-next-duration"},"20:18 - 20:48",-1)),o("span",mt,"Episode "+m(a+6),1),t[6]||(t[6]=o("h4",{class:"up-next-episode-title"},"Episode Title Goes Here",-1)),t[7]||(t[7]=o("button",{class:"add-watchlist-btn","aria-label":"Add to watchlist"},[o("i",{class:"fas fa-plus"}),S(" Add to watchlist ")],-1))])],8,ut)),64))])])])])),o("div",{class:s(["player-controls",{"controls-hidden":!_.value}])},[o("div",pt,[o("button",{type:"button",onClick:ke,class:"back-btn player-control-btn","aria-label":"Back"},[...t[9]||(t[9]=[o("i",{class:"fas fa-arrow-left"},null,-1)])]),o("div",gt,[o("span",ft,m(e.item.SeriesName)+" Season "+m(e.item.ParentIndexNumber)+" Episode "+m(e.item.IndexNumber),1),o("h2",yt,m(e.item.Name),1)]),o("div",bt,[o("div",ht,[o("button",{type:"button",onClick:Ce,tabindex:"0",class:"icon-btn player-control-btn","aria-label":"Volume"},[o("i",{class:s(0===D.value?"fas fa-volume-mute":D.value<.5?"fas fa-volume-down":"fas fa-volume-up")},null,2)]),L.value?(v(),i("div",kt,[t[12]||(t[12]=o("div",{class:"menu-header"},"Volume",-1)),o("div",wt,[t[10]||(t[10]=o("i",{class:"fas fa-volume-up volume-icon-small"},null,-1)),o("input",{type:"range",min:"0",max:"1",step:"0.01",value:D.value,onInput:Ee,class:"volume-slider-vertical","aria-label":"Volume slider"},null,40,It),t[11]||(t[11]=o("i",{class:"fas fa-volume-down volume-icon-small"},null,-1))]),o("div",Et,m(Math.round(100*D.value))+"%",1)])):u("",!0)]),t[13]||(t[13]=o("button",{type:"button",class:"icon-btn player-control-btn","aria-label":"Cast"},[o("i",{class:"fas fa-cast"})],-1))])]),o("div",Ct,[o("div",St,[o("div",_t,[o("button",{type:"button",onClick:Se,tabindex:"0",class:s(["icon-btn player-control-btn",{active:null!==B.value}]),"aria-label":"Subtitles"},[...t[14]||(t[14]=[o("i",{class:"fas fa-closed-captioning"},null,-1)])],2),T.value?(v(),i("div",xt,[t[16]||(t[16]=o("div",{class:"menu-header"},"Subtitles",-1)),o("button",{type:"button",onClick:t[0]||(t[0]=e=>xe(null)),class:s(["menu-item",{active:null===B.value}])},[null===B.value?(v(),i("i",Pt)):u("",!0),t[15]||(t[15]=o("span",null,"Off",-1))],2),(v(!0),i(n,null,r(O.value,(e,a)=>(v(),i("button",{key:a,type:"button",onClick:e=>xe(a),class:s(["menu-item",{active:B.value===a}])},[B.value===a?(v(),i("i",Lt)):u("",!0),o("span",null,m(e.DisplayTitle||e.Language||`Track ${a+1}`),1)],10,Dt))),128))])):u("",!0)]),o("div",Tt,[o("button",{type:"button",onClick:_e,tabindex:"0",class:"icon-btn player-control-btn","aria-label":"Quality"},[...t[17]||(t[17]=[o("i",{class:"fas fa-cog"},null,-1)])]),R.value?(v(),i("div",At,[t[18]||(t[18]=o("div",{class:"menu-header"},"Quality",-1)),(v(!0),i(n,null,r(F.value,e=>(v(),i("button",{key:e.label,type:"button",onClick:a=>(e=>{W.value=e,R.value=!1,ye(),console.log("[VideoPlayer] Quality selected:",e)})(e.label),class:s(["menu-item",{active:W.value===e.label}])},[W.value===e.label?(v(),i("i",Mt)):u("",!0),o("span",null,m(e.label),1)],10,Nt))),128))])):u("",!0)]),o("button",{type:"button",onClick:we,tabindex:"0",class:"icon-btn player-control-btn","aria-label":P.value?"Exit fullscreen":"Enter fullscreen"},[o("i",{class:s(P.value?"fas fa-compress":"fas fa-expand")},null,2)],8,Ut)]),o("div",{class:"progress-bar-container",onClick:fe},[o("div",Rt,[o("div",{class:"progress-bar-fill",style:p({width:C.value+"%"})},null,4)])]),o("div",Ot,[o("span",Ft,m(ce(I.value)),1),o("span",Vt,m(ce(E.value)),1)]),o("div",$t,m(ge()),1),o("div",Bt,[Q.value&&X.value?(v(),i("button",{key:0,type:"button",onClick:re,tabindex:"0",class:"control-btn player-control-btn","aria-label":`Previous episode: ${X.value.Name}`,title:`Previous: ${X.value.Name}`},[...t[19]||(t[19]=[o("i",{class:"fas fa-step-backward"},null,-1)])],8,Wt)):u("",!0),o("button",{type:"button",onClick:t[1]||(t[1]=e=>k(ie)(-10)),tabindex:"0",class:"control-btn player-control-btn","aria-label":"Rewind 10 seconds"},[...t[20]||(t[20]=[o("i",{class:"fas fa-backward"},null,-1)])]),o("button",{type:"button",onClick:t[2]||(t[2]=(...e)=>k(te)&&k(te)(...e)),tabindex:"0",class:"control-btn control-btn-large player-control-btn","aria-label":k(ee)?"Pause":"Play"},[o("i",{class:s(k(ee)?"fas fa-pause":"fas fa-play")},null,2)],8,qt),o("button",{type:"button",onClick:t[3]||(t[3]=e=>k(ie)(10)),tabindex:"0",class:"control-btn player-control-btn","aria-label":"Forward 10 seconds"},[...t[21]||(t[21]=[o("i",{class:"fas fa-forward"},null,-1)])]),Q.value&&j.value?(v(),i("button",{key:1,type:"button",onClick:ue,tabindex:"0",class:"control-btn player-control-btn","aria-label":`Next episode: ${j.value.Name}`,title:`Next: ${j.value.Name}`},[...t[22]||(t[22]=[o("i",{class:"fas fa-step-forward"},null,-1)])],8,Gt)):u("",!0)])])],2)]))}}),[["__scopeId","data-v-a2778546"]]);export{q as C,ha as G,Xe as H,we as L,ga as M,Ca as T,Ht as V,re as _,Pa as a,da as b,Ga as c,Ne as d};

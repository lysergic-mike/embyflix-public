import{d as e,p as a,r as i,k as l,i as s,o as r,c as t,A as o,f as n,q as u,C as d,b as v,l as c,t as m,u as y,g}from"./vue-vendor.C6XCEWs1.js";import{H as b,G as I,M as h,T as w,C as p,_ as T}from"./components.DC4RnbFf.js";import{u as L,k as M,l as f,m as C,c as D,a as k,n as N,o as H,p as S,q,r as G,s as _,t as P,b as E,v as F}from"./composables.C_I0WkG_.js";const V={id:"content-container"},x={key:1,class:"hero-skeleton"},A={key:3,class:"trending-section"},U={class:"trending-movies-section"},B={class:"trending-tv-section"},j={key:0,class:"because-you-watched-section"},O={class:"ml-0 mb-3.75 text-7"},R={key:1,class:"daily-movies-section"},W={class:"ml-0 mb-3.75 text-7"},Y={key:2,class:"daily-tv-section"},J={class:"ml-0 mb-3.75 text-7"},K=T(e({__name:"HomePage",setup(e){const T=y(),K=l(),z=k(),Q=E(),X=L(),Z=F(),$=M(),ee=f(),ae=C(),ie=D(Q,X,z.isDemoMode),le=N(Q,X,$,ee,z.isDemoMode,true),se=H($,Q,ae,z.isDemoMode),re=S(),te=q(),oe=P();G("Home");const ne=a(()=>se.trendingMovies.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),ue=a(()=>se.trendingTvShows.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),de=_($,ne),ve=_($,ue),ce=i([]),me=i(!1),ye=i(""),ge=async()=>{$.isConfigured&&await Promise.all([de.loadGenres("movie"),ve.loadGenres("tv")])},be=de.availableGenres,Ie=ve.availableGenres,he=async()=>{await se.loadTrendingContent({onShow:()=>window.dispatchEvent(new Event("show-splash")),onHide:()=>window.dispatchEvent(new Event("hide-splash"))})},we=async()=>{await re.loadDailyContent(Q,z.isDemoMode.value)},pe=async()=>{z.isDemoMode.value||await te.loadBecauseYouWatched(Q)},Te=a(()=>se.filterMoviesByGenres(de.selectedGenres.value)),Le=a(()=>se.filterTvShowsByGenres(ve.selectedGenres.value)),Me=e=>{if("Id"in e&&"Name"in e&&!("tmdbData"in e))return ie.getImageUrl(e.Id,"Primary",p.MEDIA_CARD_DEFAULT);const a="tmdbData"in e?e.tmdbData:e;return $.getPosterUrl(a.poster_path,"w500")},fe=async e=>{if("Id"in e&&"Name"in e)return void ke(e);"title"in e?e.title:e.name;const a=[...se.trendingMovies.value,...se.trendingTvShows.value,...re.dailyMovies.value,...re.dailyTvShows.value].find(a=>a.tmdbData.id===e.id);if(!a)return void console.error("[HomePage] Could not find merged item for TMDB item");const i={};le.currentLibrary.value&&(i.sourceLibraryId=le.currentLibrary.value.Id,i.sourceLibraryName=le.currentLibrary.value.Name||"",le.currentLibrary.value.CollectionType&&(i.sourceLibraryType=le.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",i,{itemId:a.embyId}),T.push({name:"Details",params:{itemId:a.embyId},query:i})},Ce=async e=>{if(await le.loadFeaturedItems(e,se.trendingMovies.value,se.trendingTvShows.value),le.featuredItems.value.length>0){const e=le.featuredItems.value[0];ye.value=await He(e.Id),ie.preloadImage(ye.value)}},De=async()=>{Z.pushToHistory("Home");const e=await le.loadLibraries();ce.value=e,z.isDemoMode.value||await Ce(e)},ke=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)(async e=>{const a={view:e.CollectionType||e.Type||"",libraryId:e.Id,libraryName:e.Name||""};Z.pushToHistory("Home",a),T.push({name:"Home",query:a});const i=await le.loadLibraryItems(e);ce.value=i})(e);else if("BoxSet"===e.Type)Ne(e);else{const a={};le.currentLibrary.value&&(a.sourceLibraryId=le.currentLibrary.value.Id,a.sourceLibraryName=le.currentLibrary.value.Name||"",le.currentLibrary.value.CollectionType&&(a.sourceLibraryType=le.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",a,{itemId:e.Id}),T.push({name:"Details",params:{itemId:e.Id},query:a})}},Ne=async e=>{le.currentLibrary.value=e,le.currentView.value="items";const a={view:"collection",libraryId:e.Id,libraryName:e.Name||""};if(Z.pushToHistory("Home",a),T.push({name:"Home",query:a}),z.isDemoMode.value)ce.value=X.getCollectionItems(e.Id);else try{ce.value=await Q.getCollectionItems(e.Id)}catch(i){console.error("Failed to load collection items:",i)}},He=async e=>await ie.getHeroImageUrl(e,le.featuredItems.value),Se=a(()=>"libraries"===le.currentView.value&&!K.query.view),qe=async e=>{e.Name,"Series"===e.Type?Ge(e):T.push({name:"Player",params:{itemId:e.Id}})},Ge=e=>{e.Name;const a={};le.currentLibrary.value&&(a.sourceLibraryId=le.currentLibrary.value.Id,a.sourceLibraryName=le.currentLibrary.value.Name||"",le.currentLibrary.value.CollectionType&&(a.sourceLibraryType=le.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",a,{itemId:e.Id}),T.push({name:"Details",params:{itemId:e.Id},query:a})},_e=e=>{e.Name},Pe=()=>{!se.isLoadingMoreMovies.value&&se.hasMoreMovies.value&&se.loadMoreMovies()},Ee=()=>{!se.isLoadingMoreTv.value&&se.hasMoreTv.value&&se.loadMoreTvShows()},Fe=()=>{!re.isLoadingMoreMovies.value&&re.hasMoreMovies.value&&re.loadMoreMovies(Q,z.isDemoMode.value)},Ve=()=>{!re.isLoadingMoreTv.value&&re.hasMoreTv.value&&re.loadMoreTvShows(Q,z.isDemoMode.value)};oe.registerSidebarNavigation(async e=>"Home"===K.name&&("home"===e&&await De(),!0));const xe=async()=>{const e=K.query.view,a=K.query.libraryId,i=K.query.libraryName;if(e&&a){if("collection"===e)try{const e=await Q.getItemDetails(a);return le.currentLibrary.value=e,le.currentView.value="items",void(z.isDemoMode.value?ce.value=X.getCollectionItems(e.Id):ce.value=await Q.getCollectionItems(e.Id))}catch(l){return console.error("[HomePage] Failed to restore collection view:",l),void De()}const s=le.allLibraries.value.find(e=>e.Id===a);if(s)if(le.currentLibrary.value=s,le.currentView.value="items",z.isDemoMode.value)ce.value=X.getLibraryItems(s.Id);else try{let e=null;"movies"===s.CollectionType?e="Movie":"tvshows"===s.CollectionType?e="Series":"collections"===s.CollectionType&&(e="BoxSet");const a=await Q.getItems(s.Id,e);ce.value=a}catch(l){console.error("[HomePage] Failed to restore library view:",l),ce.value=[]}else if(z.isDemoMode.value){const l={Id:a,Name:i||e,Type:"CollectionFolder",CollectionType:e};le.currentLibrary.value=l,le.currentView.value="items",ce.value=X.getLibraryItems(l.Id)}else console.warn("[HomePage] Could not find library with ID:",a),De()}else De()};s(()=>K.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(e.view&&e.libraryId?await xe():0===Object.keys(e).length&&(le.currentView.value="libraries",le.currentLibrary.value=null,ce.value=le.allLibraries.value,await Ce(le.allLibraries.value)))}),s(()=>K.name,async(e,a)=>{"Home"===e&&a&&"Home"!==a&&(0!==Object.keys(K.query).length&&(K.query.view||K.query.libraryId)||("libraries"!==le.currentView.value&&(le.currentView.value="libraries",le.currentLibrary.value=null,ce.value=le.allLibraries.value),le.allLibraries.value.length>0&&await Ce(le.allLibraries.value)))}),s(()=>se.isLoadingTrending.value,async(e,a)=>{a&&!e&&0===le.featuredItems.value.length&&(se.trendingMovies.value.length>0||se.trendingTvShows.value.length>0)&&await Ce(le.allLibraries.value)});const Ae=async e=>{$.setApiKey(e),me.value=!1,window.location.reload()},Ue=()=>{me.value=!1};return r(async()=>{$.isConfigured||(me.value=!0),await De(),await Promise.all([ge(),he()]),setTimeout(async()=>{await Promise.all([we(),pe()])},100),await xe()}),(e,a)=>(g(),t("div",V,[me.value?(g(),o(w,{key:0,onSubmit:Ae,onClose:Ue})):n("",!0),Se.value&&u(le).isLoadingFeatured.value?(g(),t("div",x,[...a[3]||(a[3]=[d('<div class="hero-skeleton-content" data-v-9a53a2f0><div class="skeleton-title" data-v-9a53a2f0></div><div class="skeleton-meta" data-v-9a53a2f0></div><div class="skeleton-description" data-v-9a53a2f0></div><div class="skeleton-buttons" data-v-9a53a2f0><div class="skeleton-button" data-v-9a53a2f0></div><div class="skeleton-button" data-v-9a53a2f0></div></div></div>',1)])])):n("",!0),Se.value&&!u(le).isLoadingFeatured.value&&u(le).featuredItems.value.length>0?(g(),o(b,{key:2,items:u(le).featuredItems.value,"get-image-url":He,"slider-id":"Hero",onPlay:qe,onFavorite:_e,onNavigate:Ge},null,8,["items"])):n("",!0),Se.value&&u($).isConfigured?(g(),t("div",A,[v("div",U,[a[4]||(a[4]=v("h3",{class:"ml-0 mb-3.75 text-7"},"Trending Movies",-1)),u(be).length>0?(g(),o(I,{key:0,genres:u(be),"selected-genres":u(de).selectedGenres.value,"onUpdate:selectedGenres":a[0]||(a[0]=e=>u(de).selectedGenres.value=e)},null,8,["genres","selected-genres"])):n("",!0),u(se).trendingMovies.value.length>0||u(se).isLoadingTrending.value?(g(),o(h,{key:1,items:Te.value,loading:u(se).isLoadingTrending.value,"get-image-url":Me,onItemClick:fe,onNearEnd:Pe},null,8,["items","loading"])):n("",!0)]),v("div",B,[a[5]||(a[5]=v("h3",{class:"ml-0 mb-3.75 text-7"},"Trending TV Shows",-1)),u(Ie).length>0?(g(),o(I,{key:0,genres:u(Ie),"selected-genres":u(ve).selectedGenres.value,"onUpdate:selectedGenres":a[1]||(a[1]=e=>u(ve).selectedGenres.value=e)},null,8,["genres","selected-genres"])):n("",!0),u(se).trendingTvShows.value.length>0||u(se).isLoadingTrending.value?(g(),o(h,{key:1,items:Le.value,loading:u(se).isLoadingTrending.value,"get-image-url":Me,onItemClick:fe,onNearEnd:Ee},null,8,["items","loading"])):n("",!0)]),u(te).hasRecommendations.value?(g(),t("div",j,[v("h3",O," Because you watched: "+m(u(te).becauseYouWatchedItem.value?.referenceItem.name),1),c(h,{items:u(te).becauseYouWatchedItem.value?.recommendations||[],"get-image-url":e=>{return a=e.Id,ie.getImageUrl(a,"Primary",p.MEDIA_CARD_DEFAULT);var a},onItemClick:a[2]||(a[2]=e=>ke(e))},null,8,["items","get-image-url"])])):n("",!0),u(re).dailyMovies.value.length>0?(g(),t("div",R,[v("h3",W,m(u(re).movieThemeTitle),1),c(h,{items:u(re).dailyMovies.value,loading:u(re).isLoading.value,"get-image-url":Me,onItemClick:fe,onNearEnd:Fe},null,8,["items","loading"])])):n("",!0),u(re).dailyTvShows.value.length>0?(g(),t("div",Y,[v("h3",J,m(u(re).tvThemeTitle),1),c(h,{items:u(re).dailyTvShows.value,loading:u(re).isLoading.value,"get-image-url":Me,onItemClick:fe,onNearEnd:Ve},null,8,["items","loading"])])):n("",!0)])):n("",!0)]))}}),[["__scopeId","data-v-9a53a2f0"]]);export{K as default};

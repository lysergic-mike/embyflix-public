import{d as e,r as a,o as l,a as t,c as s,f as o,b as i,C as r,l as n,F as u,k as c,u as d,g as v,p as m,i as y,A as g,q as h,t as p,e as f,B as w,z as b,n as I,h as k,j as T,y as L,D,E as C,G as P,H as S}from"./vue-vendor.C_Pyh8sQ.js";import{L as M,H,G as N,M as A,T as E,C as F,_ as q,a as _,b as U,V as R,c as x,d as B}from"./components.7o9iPyN2.js";import{h as G,u as $,i as V,j as K,k as O,c as Q,a as j,l as W,m as z,n as J,o as Y,p as Z,q as X,r as ee,b as ae,s as le,t as te,d as se,v as oe,w as ie}from"./composables.DFfBaK2Q.js";/* empty css               */import"./hls-vendor.swFHWmXm.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)}).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const re={key:0,class:"splash-screen"},ne={id:"app"},ue=e({__name:"App",setup(e){const m=c(),y=d();G();const g=a(!1),h=()=>{g.value=!0},p=()=>{g.value=!1},f=()=>{console.log("[App.vue] Custom Back Navigation Event Received."),"Login"!==m.name?y.back():console.log("[App.vue] On Login page, preventing back.")},w=a("home");return l(()=>{console.log("[App] Mounting - adding keydown listener"),(()=>{switch(m.name){case"Home":default:w.value="home";break;case"Details":w.value="details";break;case"Player":w.value="player"}})(),window.addEventListener("app-back-navigation",f),window.addEventListener("show-splash",h),window.addEventListener("hide-splash",p)}),t(()=>{console.log("[App] Unmounting - removing keydown listener"),window.removeEventListener("app-back-navigation",f),window.removeEventListener("show-splash",h),window.removeEventListener("hide-splash",p)}),(e,a)=>(v(),s(u,null,[g.value?(v(),s("div",re,[...a[0]||(a[0]=[r('<div class="splash-content"><div class="splash-logo"><i class="fas fa-film"></i></div><h1 class="splash-title">EmbyFlix</h1><div class="splash-spinner"><div class="spinner"></div></div><p class="splash-text">Building your personalized content library...</p><p class="splash-subtext">This may take a moment on first load</p></div>',1)])])):o("",!0),i("div",ne,[n(M)])],64))}}),ce={id:"content-container"},de={key:1,class:"hero-skeleton"},ve={key:3,class:"trending-section"},me={class:"trending-movies-section"},ye={class:"trending-tv-section"},ge={key:0,class:"because-you-watched-section"},he={class:"ml-0 mb-3.75 text-7"},pe={key:1,class:"daily-movies-section"},fe={class:"ml-0 mb-3.75 text-7"},we={key:2,class:"daily-tv-section"},be={class:"ml-0 mb-3.75 text-7"},Ie=q(e({__name:"HomePage",setup(e){const t=d(),u=c(),f=j(),w=ae(),b=$(),I=le(),k=V(),T=K(),L=O(),D=Q(w,b,f.isDemoMode),C=W(w,b,k,T,f.isDemoMode,true),P=z(k,w,L,f.isDemoMode),S=J(),M=Y(),q=ee();Z("Home");const _=m(()=>P.trendingMovies.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),U=m(()=>P.trendingTvShows.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),R=X(k,_),x=X(k,U),B=a([]),G=a(!1),te=a(""),se=async()=>{k.isConfigured&&await Promise.all([R.loadGenres("movie"),x.loadGenres("tv")])},oe=R.availableGenres,ie=x.availableGenres,re=async()=>{await P.loadTrendingContent({onShow:()=>window.dispatchEvent(new Event("show-splash")),onHide:()=>window.dispatchEvent(new Event("hide-splash"))})},ne=async()=>{await S.loadDailyContent(w,f.isDemoMode.value)},ue=async()=>{f.isDemoMode.value||await M.loadBecauseYouWatched(w)},Ie=m(()=>P.filterMoviesByGenres(R.selectedGenres.value)),ke=m(()=>P.filterTvShowsByGenres(x.selectedGenres.value)),Te=e=>{if("Id"in e&&"Name"in e&&!("tmdbData"in e))return D.getImageUrl(e.Id,"Primary",F.MEDIA_CARD_DEFAULT);const a="tmdbData"in e?e.tmdbData:e;return k.getPosterUrl(a.poster_path,"w500")},Le=async e=>{if("Id"in e&&"Name"in e)return void Pe(e);const a="title"in e?e.title:e.name;console.log("[HomePage] TMDB item clicked:",a);const l=[...P.trendingMovies.value,...P.trendingTvShows.value,...S.dailyMovies.value,...S.dailyTvShows.value].find(a=>a.tmdbData.id===e.id);if(!l)return void console.error("[HomePage] Could not find merged item for TMDB item");const s={};C.currentLibrary.value&&(s.sourceLibraryId=C.currentLibrary.value.Id,s.sourceLibraryName=C.currentLibrary.value.Name||"",C.currentLibrary.value.CollectionType&&(s.sourceLibraryType=C.currentLibrary.value.CollectionType)),I.pushToHistory("Details",s,{itemId:l.embyId}),t.push({name:"Details",params:{itemId:l.embyId},query:s})},De=async e=>{if(await C.loadFeaturedItems(e,P.trendingMovies.value,P.trendingTvShows.value),C.featuredItems.value.length>0){const e=C.featuredItems.value[0];te.value=await Me(e.Id),D.preloadImage(te.value)}},Ce=async()=>{I.pushToHistory("Home");const e=await C.loadLibraries();B.value=e,f.isDemoMode.value||await De(e)},Pe=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)(async e=>{console.log("[HomePage] loadLibraryItems called with:",e);const a={view:e.CollectionType||e.Type||"",libraryId:e.Id,libraryName:e.Name||""};I.pushToHistory("Home",a),t.push({name:"Home",query:a});const l=await C.loadLibraryItems(e);B.value=l})(e);else if("BoxSet"===e.Type)Se(e);else{const a={};C.currentLibrary.value&&(a.sourceLibraryId=C.currentLibrary.value.Id,a.sourceLibraryName=C.currentLibrary.value.Name||"",C.currentLibrary.value.CollectionType&&(a.sourceLibraryType=C.currentLibrary.value.CollectionType)),I.pushToHistory("Details",a,{itemId:e.Id}),t.push({name:"Details",params:{itemId:e.Id},query:a})}},Se=async e=>{C.currentLibrary.value=e,C.currentView.value="items";const a={view:"collection",libraryId:e.Id,libraryName:e.Name||""};if(I.pushToHistory("Home",a),t.push({name:"Home",query:a}),f.isDemoMode.value)B.value=b.getCollectionItems(e.Id);else try{B.value=await w.getCollectionItems(e.Id)}catch(l){console.error("Failed to load collection items:",l)}},Me=async e=>await D.getHeroImageUrl(e,C.featuredItems.value),He=m(()=>"libraries"===C.currentView.value&&!u.query.view),Ne=async e=>{console.log("[HomePage] Hero item clicked:",e.Name),"Series"===e.Type?Ae(e):t.push({name:"Player",params:{itemId:e.Id}})},Ae=e=>{console.log("[HomePage] Hero navigate clicked:",e.Name);const a={};C.currentLibrary.value&&(a.sourceLibraryId=C.currentLibrary.value.Id,a.sourceLibraryName=C.currentLibrary.value.Name||"",C.currentLibrary.value.CollectionType&&(a.sourceLibraryType=C.currentLibrary.value.CollectionType)),I.pushToHistory("Details",a,{itemId:e.Id}),t.push({name:"Details",params:{itemId:e.Id},query:a})},Ee=e=>{console.log("Added to favorites:",e.Name)},Fe=()=>{!P.isLoadingMoreMovies.value&&P.hasMoreMovies.value&&(console.log("[HomePage] Near end of trending movies - preloading next page"),P.loadMoreMovies())},qe=()=>{!P.isLoadingMoreTv.value&&P.hasMoreTv.value&&(console.log("[HomePage] Near end of trending TV shows - preloading next page"),P.loadMoreTvShows())},_e=()=>{!S.isLoadingMoreMovies.value&&S.hasMoreMovies.value&&(console.log("[HomePage] Near end of daily movies - preloading next page"),S.loadMoreMovies(w,f.isDemoMode.value))},Ue=()=>{!S.isLoadingMoreTv.value&&S.hasMoreTv.value&&(console.log("[HomePage] Near end of daily TV shows - preloading next page"),S.loadMoreTvShows(w,f.isDemoMode.value))};q.registerSidebarNavigation(async e=>"Home"!==u.name?(console.log("[HomePage] Not on Home route, ignoring sidebar navigation"),!1):("home"===e&&await Ce(),!0));const Re=async()=>{const e=u.query.view,a=u.query.libraryId,l=u.query.libraryName;if(e&&a){if(console.log("[HomePage] Restoring view from query:",{view:e,libraryId:a,libraryName:l}),"collection"===e)try{const e=await w.getItemDetails(a);return C.currentLibrary.value=e,C.currentView.value="items",void(f.isDemoMode.value?B.value=b.getCollectionItems(e.Id):B.value=await w.getCollectionItems(e.Id))}catch(t){return console.error("[HomePage] Failed to restore collection view:",t),void Ce()}const s=C.allLibraries.value.find(e=>e.Id===a);if(s)if(C.currentLibrary.value=s,C.currentView.value="items",f.isDemoMode.value)B.value=b.getLibraryItems(s.Id);else try{let e=null;"movies"===s.CollectionType?e="Movie":"tvshows"===s.CollectionType?e="Series":"collections"===s.CollectionType&&(e="BoxSet");const a=await w.getItems(s.Id,e);B.value=a}catch(t){console.error("[HomePage] Failed to restore library view:",t),B.value=[]}else if(f.isDemoMode.value){const t={Id:a,Name:l||e,Type:"CollectionFolder",CollectionType:e};C.currentLibrary.value=t,C.currentView.value="items",B.value=b.getLibraryItems(t.Id)}else console.warn("[HomePage] Could not find library with ID:",a),Ce()}else Ce()};y(()=>u.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(console.log("[HomePage] Route query changed, restoring view:",e),e.view&&e.libraryId?await Re():0===Object.keys(e).length&&(C.currentView.value="libraries",C.currentLibrary.value=null,B.value=C.allLibraries.value,await De(C.allLibraries.value)))}),y(()=>u.name,async(e,a)=>{"Home"===e&&a&&"Home"!==a&&(console.log("[HomePage] Returned to Home from",a),0!==Object.keys(u.query).length&&(u.query.view||u.query.libraryId)||("libraries"!==C.currentView.value&&(C.currentView.value="libraries",C.currentLibrary.value=null,B.value=C.allLibraries.value),C.allLibraries.value.length>0&&(console.log("[HomePage] Reloading featured items after returning from",a),await De(C.allLibraries.value))))}),y(()=>P.isLoadingTrending.value,async(e,a)=>{a&&!e&&0===C.featuredItems.value.length&&(P.trendingMovies.value.length>0||P.trendingTvShows.value.length>0)&&(console.log("[HomePage] Trending loaded, updating featured items for hero slider"),await De(C.allLibraries.value))});const xe=async e=>{console.log("Api Key Set"),k.setApiKey(e),G.value=!1,window.location.reload()},Be=()=>{G.value=!1};return l(async()=>{k.isConfigured||(G.value=!0),await Ce(),await Promise.all([se(),re()]),setTimeout(async()=>{await Promise.all([ne(),ue()])},100),await Re(),console.log("Mounted!")}),(e,a)=>(v(),s("div",ce,[G.value?(v(),g(E,{key:0,onSubmit:xe,onClose:Be})):o("",!0),He.value&&h(C).isLoadingFeatured.value?(v(),s("div",de,[...a[3]||(a[3]=[r('<div class="hero-skeleton-content" data-v-9a53a2f0><div class="skeleton-title" data-v-9a53a2f0></div><div class="skeleton-meta" data-v-9a53a2f0></div><div class="skeleton-description" data-v-9a53a2f0></div><div class="skeleton-buttons" data-v-9a53a2f0><div class="skeleton-button" data-v-9a53a2f0></div><div class="skeleton-button" data-v-9a53a2f0></div></div></div>',1)])])):o("",!0),He.value&&!h(C).isLoadingFeatured.value&&h(C).featuredItems.value.length>0?(v(),g(H,{key:2,items:h(C).featuredItems.value,"get-image-url":Me,"slider-id":"Hero",onPlay:Ne,onFavorite:Ee,onNavigate:Ae},null,8,["items"])):o("",!0),He.value&&h(k).isConfigured?(v(),s("div",ve,[i("div",me,[a[4]||(a[4]=i("h3",{class:"ml-0 mb-3.75 text-7"},"Trending Movies",-1)),h(oe).length>0?(v(),g(N,{key:0,genres:h(oe),"selected-genres":h(R).selectedGenres.value,"onUpdate:selectedGenres":a[0]||(a[0]=e=>h(R).selectedGenres.value=e)},null,8,["genres","selected-genres"])):o("",!0),h(P).trendingMovies.value.length>0||h(P).isLoadingTrending.value?(v(),g(A,{key:1,items:Ie.value,loading:h(P).isLoadingTrending.value,"get-image-url":Te,onItemClick:Le,onNearEnd:Fe},null,8,["items","loading"])):o("",!0)]),i("div",ye,[a[5]||(a[5]=i("h3",{class:"ml-0 mb-3.75 text-7"},"Trending TV Shows",-1)),h(ie).length>0?(v(),g(N,{key:0,genres:h(ie),"selected-genres":h(x).selectedGenres.value,"onUpdate:selectedGenres":a[1]||(a[1]=e=>h(x).selectedGenres.value=e)},null,8,["genres","selected-genres"])):o("",!0),h(P).trendingTvShows.value.length>0||h(P).isLoadingTrending.value?(v(),g(A,{key:1,items:ke.value,loading:h(P).isLoadingTrending.value,"get-image-url":Te,onItemClick:Le,onNearEnd:qe},null,8,["items","loading"])):o("",!0)]),h(M).hasRecommendations.value?(v(),s("div",ge,[i("h3",he," Because you watched: "+p(h(M).becauseYouWatchedItem.value?.referenceItem.name),1),n(A,{items:h(M).becauseYouWatchedItem.value?.recommendations||[],"get-image-url":e=>{return a=e.Id,D.getImageUrl(a,"Primary",F.MEDIA_CARD_DEFAULT);var a},onItemClick:a[2]||(a[2]=e=>Pe(e))},null,8,["items","get-image-url"])])):o("",!0),h(S).dailyMovies.value.length>0?(v(),s("div",pe,[i("h3",fe,p(h(S).movieThemeTitle),1),n(A,{items:h(S).dailyMovies.value,loading:h(S).isLoading.value,"get-image-url":Te,onItemClick:Le,onNearEnd:_e},null,8,["items","loading"])])):o("",!0),h(S).dailyTvShows.value.length>0?(v(),s("div",we,[i("h3",be,p(h(S).tvThemeTitle),1),n(A,{items:h(S).dailyTvShows.value,loading:h(S).isLoading.value,"get-image-url":Te,onItemClick:Le,onNearEnd:Ue},null,8,["items","loading"])])):o("",!0)])):o("",!0)]))}}),[["__scopeId","data-v-9a53a2f0"]]),ke={id:"content-container"},Te=q(e({__name:"CategoryPage",setup(e){const t=d(),o=c(),i=j(),r=ae(),u=$(),g=le(),h=V(),p=K(),f=Q(r,u,i.isDemoMode),w=ee();Z("Home");const b=W(r,u,h,p,i.isDemoMode,true),I=a([]),k=a("movies"),T=m(()=>b.currentLibrary.value&&"BoxSet"===b.currentLibrary.value.Type?b.currentLibrary.value.Name||"Collection":"movies"===k.value?"Movies":"tvshows"===k.value?"TV Shows":"collections"===k.value?"Collections":""),L=async()=>{const e=o.params.category;if(!["movies","tvshows","collections"].includes(e))return console.error("[CategoryPage] Invalid category:",e),void t.push({name:"Home"});k.value=e,0===b.allLibraries.value.length&&await b.loadLibraries();let a=[];if("movies"===e)a=b.allLibraries.value.filter(e=>"movies"===e.CollectionType),I.value=a;else if("tvshows"===e)a=b.allLibraries.value.filter(e=>"tvshows"===e.CollectionType),I.value=a;else if("collections"===e){const e=b.allLibraries.value.find(e=>"collections"===e.CollectionType||"boxsets"===e.CollectionType);if(e)if(i.isDemoMode.value)I.value=u.getLibraryItems(e.Id);else try{const a=await r.getItems(e.Id,"BoxSet");I.value=a}catch(l){console.error("[CategoryPage] Failed to load collections:",l),I.value=[]}else console.warn("[CategoryPage] No collections library found"),I.value=[]}g.pushToHistory("Category",{category:e})},D=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)(async e=>{if(b.currentLibrary.value=e,i.isDemoMode.value)I.value=u.getLibraryItems(e.Id);else try{let a=null;"movies"===e.CollectionType?a="Movie":"tvshows"===e.CollectionType?a="Series":"collections"!==e.CollectionType&&"boxsets"!==e.CollectionType||(a="BoxSet");const l=await r.getItems(e.Id,a);I.value=l}catch(l){console.error("[CategoryPage] Failed to load library items:",l),I.value=[]}const a={category:k.value,view:"library",libraryId:e.Id,libraryName:e.Name||""};g.pushToHistory("Category",{category:k.value,...a}),t.push({name:"Category",params:{category:k.value},query:a})})(e);else if("BoxSet"===e.Type)(async e=>{if(b.currentLibrary.value=e,i.isDemoMode.value)I.value=u.getCollectionItems(e.Id);else try{I.value=await r.getCollectionItems(e.Id)}catch(l){console.error("[CategoryPage] Failed to load collection items:",l),I.value=[]}const a={category:k.value,view:"collection",collectionId:e.Id,collectionName:e.Name||""};g.pushToHistory("Category",{category:k.value,...a}),t.push({name:"Category",params:{category:k.value},query:a})})(e);else{const a={};b.currentLibrary.value&&(a.sourceLibraryId=b.currentLibrary.value.Id,a.sourceLibraryName=b.currentLibrary.value.Name||"",b.currentLibrary.value.CollectionType&&(a.sourceLibraryType=b.currentLibrary.value.CollectionType)),g.pushToHistory("Details",a,{itemId:e.Id}),t.push({name:"Details",params:{itemId:e.Id},query:a})}},C=e=>f.getImageUrl(e,"Primary",F.MEDIA_CARD_DEFAULT);w.registerSidebarNavigation();const P=async()=>{const e=o.query.view,a=o.query.libraryId,l=o.query.collectionId;if("library"===e&&a){0===b.allLibraries.value.length&&await b.loadLibraries();const e=b.allLibraries.value.find(e=>e.Id===a);if(e)if(b.currentLibrary.value=e,i.isDemoMode.value)I.value=u.getLibraryItems(e.Id);else try{let a=null;"movies"===e.CollectionType?a="Movie":"tvshows"===e.CollectionType?a="Series":"collections"!==e.CollectionType&&"boxsets"!==e.CollectionType||(a="BoxSet");const l=await r.getItems(e.Id,a);I.value=l}catch(t){console.error("[CategoryPage] Failed to restore library items:",t),I.value=[]}}else if("collection"===e&&l)try{const e=await r.getItemDetails(l);b.currentLibrary.value=e,i.isDemoMode.value?I.value=u.getCollectionItems(e.Id):I.value=await r.getCollectionItems(e.Id)}catch(t){console.error("[CategoryPage] Failed to restore collection view:",t),await L()}else await L()};return y(()=>o.params.category,async(e,a)=>{e!==a&&await P()}),y(()=>o.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&await P()}),l(async()=>{await P()}),(e,a)=>(v(),s("div",ke,[n(_,{items:I.value,title:T.value,"get-image-url":C,onItemClick:D},null,8,["items","title"])]))}}),[["__scopeId","data-v-2f61eb82"]]),Le={key:0,id:"content-container"},De={key:0,class:"tv-show-content"},Ce={class:"season-selector"},Pe={class:"season-buttons"},Se=["onClick","onKeydown"],Me={key:0,class:"episode-list"},He={class:"episodes-container"},Ne={class:"episodes-slider"},Ae=["onKeydown","onClick"],Ee={class:"episode-image"},Fe=["src","alt"],qe={key:0,class:"episode-runtime"},_e={key:1,class:"episode-watched",title:"Watched"},Ue={class:"episode-info"},Re={key:0,class:"episode-overview"},xe={key:0,class:"episode-progress"},Be={key:1,class:"similar-titles"},Ge={key:1,id:"content-container"},$e=q(e({__name:"DetailsPage",setup(e){const r=d(),g=c(),T=j(),L=$(),D=ae(),C=le(),P=Q(D,L,T.isDemoMode),S=te(T.isDemoMode),{formatRuntime:M}=se(),{handleBack:H}=Z("Home"),N=a(null),E=a([]),q=a(null),_=a([]),R=a([]),x=a(0),B=a(0),G=a([]),V=a([]),K=(e,a="Primary",l)=>{const t="Primary"===a?F.DETAILS_POSTER:void 0;return P.getImageUrl(e,a,l??t)},O=m(()=>N.value?K(N.value.Id):""),W=a(""),z=a(""),J=async e=>{try{const a=await P.getHeroImageUrl(e.Id);W.value=a,window.dispatchEvent(new CustomEvent("update-backdrop",{detail:a}))}catch(a){console.error("[DetailsPage] Failed to load backdrop image:",a),W.value="",window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""}))}},Y=e=>{if(T.isDemoMode.value)z.value="";else try{const a=D.getImageUrl(e.Id,"Logo",500);z.value=a}catch(a){console.error("[DetailsPage] Failed to load logo image:",a),z.value=""}},X=m(()=>"Series"===N.value?.Type),ee=async e=>{if(T.isDemoMode.value)return R.value=L.getSimilarItems(e.Id,15),void console.log("[DetailsPage] Loaded",R.value.length,"demo similar items");try{const a=await D.getSimilarItems(e.Id,15);R.value=a,console.log("[DetailsPage] Loaded",a.length,"similar items")}catch(a){console.error("[DetailsPage] Failed to load similar items:",a),R.value=[]}},oe=async()=>{const e=g.params.itemId;if(T.isDemoMode.value)N.value=L.getItemDetails(e)||null,N.value&&(J(N.value),Y(N.value),"Series"===N.value.Type&&await re(N.value.Id),ee(N.value));else try{const a=await D.getItemDetails(e);N.value=a,J(a),Y(a),"Series"===a.Type&&await re(a.Id),ee(a),S.startBrowseTracking(a)}catch(a){console.error("[DetailsPage] Failed to load item details:",a),N.value=null}},ie=()=>{S.trackCurrentBrowseEvent()},re=async e=>{if(T.isDemoMode.value){const a=L.getSeasons(e);return E.value=a,void(a.length>0&&await ce(a[0]))}try{const a=await D.getSeasons(e);E.value=a,a.length>0&&await ce(a[0])}catch(a){console.error("[DetailsPage] Failed to load seasons:",a)}},ne=e=>{let a=-1;for(let l=e.length-1;l>=0;l--)if(e[l].UserData?.Played){a=l;break}return a>=0?Math.min(a+1,e.length-1):0},ue=()=>{w(()=>{setTimeout(()=>{const e=V.value[B.value],a=document.querySelector(".episodes-slider");if(e&&a){const l=e.offsetLeft-20;a.scrollLeft=l}},150)})},ce=async e=>{if(q.value=e,N.value){if(T.isDemoMode.value){const a=L.getEpisodes(N.value.Id,e.Id);return _.value=a,B.value=ne(a),void ue()}try{const a=await D.getEpisodes(N.value.Id,e.Id);_.value=a,B.value=ne(a),ue()}catch(a){console.error("[DetailsPage] Failed to load episodes:",a)}}},de=()=>{N.value&&("Series"===N.value.Type&&_.value.length>0?(C.pushToHistory("Player",void 0,{itemId:_.value[0].Id}),r.push({name:"Player",params:{itemId:_.value[0].Id}})):(C.pushToHistory("Player",void 0,{itemId:N.value.Id}),r.push({name:"Player",params:{itemId:N.value.Id}})))},ve=e=>{C.pushToHistory("Player",void 0,{itemId:e.Id}),r.push({name:"Player",params:{itemId:e.Id}})},me=e=>{console.log("Browse collection:",e)},ye=async e=>{if(T.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot remove from continue watching");else try{console.log("[DetailsPage] Marking item as watched:",e.Id),await D.markAsPlayed(e.Id),console.log("[DetailsPage] Successfully marked as watched"),N.value&&N.value.UserData&&(N.value.UserData.Played=!0),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as watched:",a)}},ge=async e=>{if(T.isDemoMode.value)console.log("[DetailsPage] Demo mode: Cannot mark as unwatched");else try{console.log("[DetailsPage] Marking item as unwatched:",e.Id),await D.markAsUnplayed(e.Id),console.log("[DetailsPage] Successfully marked as unwatched"),N.value&&N.value.UserData&&(N.value.UserData.Played=!1),window.dispatchEvent(new Event("refresh-continue-watching"))}catch(a){console.error("[DetailsPage] Failed to mark as unwatched:",a)}},he=e=>{const a=e;C.pushToHistory("Details",void 0,{itemId:a.Id}),r.push({name:"Details",params:{itemId:a.Id}})},pe=a(!1),fe=()=>{r.push({name:"Home"})};y(()=>g.params.itemId,(e,a)=>{e&&e!==a&&(ie(),N.value=null,W.value="",z.value="",E.value=[],q.value=null,_.value=[],R.value=[],oe())});const we=a(!1),be=e=>{const a=document.activeElement;a&&a.closest(".sidebar")&&"ArrowRight"===e.key&&we.value&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),E.value.length>0&&x.value>=0?(pe.value=!0,w(()=>{const e=G.value[x.value];e&&e.focus(),pe.value=!1})):_.value.length>0&&B.value>=0&&(pe.value=!0,w(()=>{const e=V.value[B.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a&&e){const l=e.offsetLeft-20;a.scrollTo({left:l,behavior:"smooth"})}}pe.value=!1})),we.value=!1)};return l(()=>{oe(),window.addEventListener("sidebar-navigate",fe),window.addEventListener("keydown",be,!0)}),t(()=>{ie(),window.dispatchEvent(new CustomEvent("update-backdrop",{detail:""})),window.removeEventListener("sidebar-navigate",fe),window.removeEventListener("keydown",be,!0)}),(e,a)=>N.value?(v(),s("div",Le,[n(U,{item:N.value,"image-url":O.value,"backdrop-url":W.value,"logo-url":z.value,onPlay:de,onBack:h(H),onBrowse:me,onRemoveFromContinueWatching:ye,onMarkAsUnwatched:ge},null,8,["item","image-url","backdrop-url","logo-url","onBack"]),X.value&&E.value.length>0?(v(),s("div",De,[i("div",Ce,[a[0]||(a[0]=i("h3",null,"Seasons",-1)),i("div",Pe,[(v(!0),s(u,null,f(E.value,(e,a)=>(v(),s("button",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(G.value[a]=e)})(e,a),type:"button",class:I({active:q.value?.Id===e.Id}),onClick:a=>ce(e),onKeydown:[b(a=>ce(e),["enter"]),e=>((e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if(0===a){x.value=a,we.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else x.value=a-1,w(()=>{G.value[a-1]?.focus()});break;case"ArrowRight":a<E.value.length-1?(x.value=a+1,w(()=>{G.value[a+1]?.focus()})):(B.value=0,w(()=>{V.value[0]?.focus()}));break;case"ArrowDown":w(()=>{const e=V.value[B.value];if(e){e.focus();const a=document.querySelector(".episodes-slider");if(a){const e=a.getBoundingClientRect(),l=window.innerHeight,t=e.top+e.height/2-l/2,s=document.querySelector(".main-content");s&&s.scrollBy({top:t,behavior:"smooth"})}}});break;case"ArrowUp":const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");if(e)e.focus();else{const e=document.querySelector(".btn-hero-play");e?.focus()}}})(e,a)],tabindex:"0"},p(e.Name||`Season ${e.IndexNumber}`),43,Se))),128))])]),_.value.length>0?(v(),s("div",Me,[a[2]||(a[2]=i("h3",null,"Episodes",-1)),i("div",He,[i("div",Ne,[(v(!0),s(u,null,f(_.value,(e,l)=>(v(),s("div",{key:e.Id,ref_for:!0,ref:e=>((e,a)=>{e&&(V.value[a]=e)})(e,l),class:"episode-card",onKeydown:[b(a=>ve(e),["enter"]),e=>((e,a)=>{if(!e.key.startsWith("Arrow"))return;e.preventDefault(),e.stopPropagation();const l=document.querySelector(".episodes-slider");switch(e.key){case"ArrowLeft":if(0===a){B.value=a,we.value=!0;const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else B.value=a-1,w(()=>{const e=V.value[a-1];if(e?.focus(),l&&e){const a=e.offsetLeft-20;l.scrollTo({left:a,behavior:"smooth"})}});break;case"ArrowRight":a<_.value.length-1&&(B.value=a+1,w(()=>{const e=V.value[a+1];if(e?.focus(),l&&e){const a=e.offsetLeft-20;l.scrollTo({left:a,behavior:"smooth"})}}));break;case"ArrowUp":x.value=0,w(()=>{G.value[0]?.focus()});break;case"ArrowDown":const e=document.querySelector(".similar-titles .media-card");e?.focus()}})(e,l)],onClick:a=>ve(e),tabindex:"0"},[i("div",Ee,[i("img",{src:e.ImageUrl||K(e.Id,"Primary",h(F).EPISODE_CARD),alt:e.Name},null,8,Fe),e.RunTimeTicks?(v(),s("span",qe,p(h(M)(e.RunTimeTicks)),1)):o("",!0),e.UserData?.Played?(v(),s("div",_e,[...a[1]||(a[1]=[i("span",null,"Watched",-1)])])):o("",!0)]),i("div",Ue,[i("h4",null,p(e.IndexNumber)+". "+p(e.Name),1),e.Overview?(v(),s("p",Re,p(e.Overview),1)):o("",!0)]),e.UserData&&e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>0&&!e.UserData.Played?(v(),s("div",xe,[i("div",{class:"episode-progress-bar",style:k({width:`${e.UserData.PlayedPercentage}%`})},null,4)])):o("",!0)],40,Ae))),128))])])])):o("",!0)])):o("",!0),R.value.length>0?(v(),s("div",Be,[a[3]||(a[3]=i("h3",null,"Similar Titles",-1)),n(A,{items:R.value,"get-image-url":e=>K(e.Id,"Primary",h(F).MEDIA_CARD_DEFAULT),onItemClick:he},null,8,["items","get-image-url"])])):o("",!0)])):(v(),s("div",Ge,[...a[4]||(a[4]=[i("p",null,"Loading...",-1)])]))}}),[["__scopeId","data-v-aaec0673"]]),Ve={key:0,id:"player-screen"},Ke={key:1,id:"player-screen"},Oe=q(e({__name:"PlayerPage",setup(e){const t=d(),o=c(),r=j(),u=$(),m=ae(),{handleBack:y}=Z("Home"),g=oe(m),p=a(null),f=a(""),w=async()=>{const e=o.params.itemId;if(g.initializeSession(e),r.isDemoMode.value)p.value=u.getItemDetails(e)||null,f.value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";else try{const a=await m.getItemDetails(e);p.value=a;const l=await m.getPlaybackInfo(e);if(!l.MediaSources||0===l.MediaSources.length)return console.error("[PlayerPage] No media sources available"),void(f.value="");const t=l.MediaSources[0],s=l.PlaySessionId||g.playSessionId.value;if(t.SupportsDirectPlay&&t.DirectStreamUrl)f.value=`${m.serverUrl.value}${t.DirectStreamUrl}`;else if(t.SupportsTranscoding)if(t.TranscodingUrl&&"hls"===t.TranscodingSubProtocol){let e=t.TranscodingUrl;e.startsWith("/emby/")||(e="/emby"+e),f.value=`${m.serverUrl.value}${e}`}else f.value=`${m.serverUrl.value}/emby/Videos/${e}/master.m3u8?MediaSourceId=${t.Id}&DeviceId=embyflix-tizen&api_key=${m.accessToken.value}&PlaySessionId=${s}&AudioStreamIndex=${t.DefaultAudioStreamIndex||1}&AudioCodec=aac&VideoCodec=h264`;else console.error("[PlayerPage] No streaming options available"),f.value=""}catch(a){console.error("[PlayerPage] Failed to load item for player:",a),p.value=null,f.value=""}},b=()=>{g.reportStart()};return l(()=>{w()}),(e,a)=>p.value?(v(),s("div",Ve,[n(R,{item:p.value,"stream-url":f.value,onClose:h(y),onProgress:a[0]||(a[0]=(e,a)=>((e,a)=>{g.reportProgress(e,a)})(e,a)),onPlaybackStart:b,onPlaybackStop:a[1]||(a[1]=e=>(e=>{g.reportStop(e)})(e)),onSwitchEpisode:a[2]||(a[2]=e=>(async e=>{g.switchItem(e),await t.replace({name:"Player",params:{itemId:e}}),await w()})(e))},null,8,["item","stream-url","onClose"])])):(v(),s("div",Ke,[...a[3]||(a[3]=[i("p",null,"Loading player...",-1)])]))}}),[["__scopeId","data-v-550fc5b9"]]),Qe={class:"search-page"},je={class:"search-layout"},We={key:0,class:"filters-sidebar"},ze={class:"sidebar-header"},Je={key:0,class:"sort-section"},Ye={for:"sort-select",class:"sort-label"},Ze={class:"filter-section"},Xe={class:"filter-chips-vertical"},ea=["onClick","onKeydown"],aa={key:0,class:"fas fa-check"},la={class:"filter-section"},ta={class:"filter-chips-vertical"},sa={key:0,class:"fas fa-check"},oa={key:0,class:"fas fa-check"},ia={key:0,class:"fas fa-check"},ra={key:1,class:"filter-section"},na={class:"filter-chips-vertical scrollable"},ua=["onClick","onKeydown"],ca={key:0,class:"fas fa-check"},da={key:2,class:"filter-section"},va={class:"filter-chips-vertical scrollable"},ma=["onClick","onKeydown"],ya={key:0,class:"fas fa-check"},ga={class:"results-main"},ha={key:0,class:"results-summary"},pa={key:1,class:"loading-state"},fa={key:2,class:"error-state"},wa={key:3,class:"empty-state"},ba={key:4,class:"no-results-state"},Ia={key:5,class:"results-container"},ka={class:"group-header"},Ta={class:"group-count"},La={class:"results-grid"},Da=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:B},{path:"/home",name:"Home",component:Ie,meta:{requiresAuth:!0,layout:"base"}},{path:"/category/:category",name:"Category",component:Te,meta:{requiresAuth:!0,layout:"base"}},{path:"/search",name:"Search",component:q(e({__name:"SearchPage",setup(e){const a=c(),t=d(),n=ie(),w=ae(),k=j(),C=$(),P=Q(w,C,k.isDemoMode),S=te(k.isDemoMode),M=se();Z("Home"),l(()=>{n.setFilter(["Movie","Series"])}),y(()=>a.query.q,e=>{const a=e||"";a!==n.searchQuery.value&&(n.searchQuery.value=a)},{immediate:!0}),y(()=>n.searchResults.value,(e,a)=>{!n.isSearching.value&&e.length>0&&e!==a&&n.searchQuery.value&&S.trackSearchEvent(n.searchQuery.value,{genres:n.filters.value.genres,studios:n.filters.value.studios,itemTypes:n.filters.value.itemTypes})});const H=e=>P.getImageUrl(e.Id,"Primary",F.MEDIA_CARD_DEFAULT),N=m(()=>{if(n.isSearching.value)return"Searching...";if(!n.searchQuery.value)return"Enter a search term to find movies, TV shows, and more";if(0===n.searchResults.value.length)return`No results found for "${n.searchQuery.value}"`;const e=n.filteredResults.value.length,a=n.searchResults.value.length;return e!==a?`Showing ${e} of ${a} results for "${n.searchQuery.value}"`:`${e} result${1!==e?"s":""} for "${n.searchQuery.value}"`});return(e,a)=>{return v(),s("div",Qe,[i("div",je,[h(n).searchQuery.value?(v(),s("aside",We,[i("div",ze,[i("h3",null,"Filters ("+p(h(n).filters.value.itemTypes.length+h(n).filters.value.genres.length+h(n).filters.value.studios.length+h(n).filters.value.tags.length+("any"!==h(n).filters.value.runtime?1:0)+("any"!==h(n).filters.value.criticRating?1:0))+")",1),h(n).filters.value.itemTypes.length>0||h(n).filters.value.genres.length>0||h(n).filters.value.studios.length>0||h(n).filters.value.tags.length>0||"any"!==h(n).filters.value.runtime||"any"!==h(n).filters.value.criticRating?(v(),s("button",{key:0,class:"clear-filters-btn",tabindex:"0",onClick:a[0]||(a[0]=e=>h(n).clearFilters()),onKeydown:a[1]||(a[1]=b(e=>h(n).clearFilters(),["enter"]))}," Clear All ",32)):o("",!0)]),h(n).searchQuery.value?(v(),s("div",Je,[i("label",Ye,[a[10]||(a[10]=L(" Sort by: ",-1)),i("strong",null,p((l=h(n).filters.value.sortBy,{relevance:"Best Match","name-asc":"Name (A-Z)","name-desc":"Name (Z-A)","date-newest":"Newest First","date-oldest":"Oldest First","critic-high":"Critics (High)","critic-low":"Critics (Low)"}[l]||"Best Match")),1)]),T(i("select",{id:"sort-select","onUpdate:modelValue":a[2]||(a[2]=e=>h(n).filters.value.sortBy=e),class:"sort-select",tabindex:"2",onChange:a[3]||(a[3]=e=>h(n).setSortBy(h(n).filters.value.sortBy))},[...a[11]||(a[11]=[r('<option value="relevance" data-v-de225202>Best Match</option><option value="name-asc" data-v-de225202>Name (A-Z)</option><option value="name-desc" data-v-de225202>Name (Z-A)</option><option value="date-newest" data-v-de225202>Newest First</option><option value="date-oldest" data-v-de225202>Oldest First</option><option value="critic-high" data-v-de225202>Critics (High)</option><option value="critic-low" data-v-de225202>Critics (Low)</option>',7)])],544),[[D,h(n).filters.value.sortBy]])])):o("",!0),i("div",Ze,[a[12]||(a[12]=i("h4",{class:"filter-section-title"},"Content Format",-1)),i("div",Xe,[(v(!0),s(u,null,f(h(n).availableTypes.value,e=>(v(),s("button",{key:e,class:I(["filter-chip",{active:h(n).isTypeFiltered(e)}]),tabindex:"0",onClick:a=>h(n).toggleFilter(e),onKeydown:b(a=>h(n).toggleFilter(e),["enter"])},[i("span",null,p(h(M).formatTypeName(e)),1),h(n).isTypeFiltered(e)?(v(),s("i",aa)):o("",!0)],42,ea))),128))])]),i("div",la,[a[16]||(a[16]=i("h4",{class:"filter-section-title"},"Quick Watch",-1)),i("div",ta,[i("button",{class:I(["filter-chip",{active:"short"===h(n).filters.value.runtime}]),tabindex:"0",onClick:a[4]||(a[4]=e=>h(n).setRuntime("short")),onKeydown:a[5]||(a[5]=b(e=>h(n).setRuntime("short"),["enter"]))},[a[13]||(a[13]=i("span",null,"Under 30 Min",-1)),"short"===h(n).filters.value.runtime?(v(),s("i",sa)):o("",!0)],34),i("button",{class:I(["filter-chip",{active:"medium"===h(n).filters.value.runtime}]),tabindex:"0",onClick:a[6]||(a[6]=e=>h(n).setRuntime("medium")),onKeydown:a[7]||(a[7]=b(e=>h(n).setRuntime("medium"),["enter"]))},[a[14]||(a[14]=i("span",null,"1-2 Hours",-1)),"medium"===h(n).filters.value.runtime?(v(),s("i",oa)):o("",!0)],34),i("button",{class:I(["filter-chip",{active:"long"===h(n).filters.value.runtime||"verylong"===h(n).filters.value.runtime}]),tabindex:"0",onClick:a[8]||(a[8]=e=>h(n).setRuntime("long"===h(n).filters.value.runtime||"verylong"===h(n).filters.value.runtime?"any":"long")),onKeydown:a[9]||(a[9]=b(e=>h(n).setRuntime("long"===h(n).filters.value.runtime||"verylong"===h(n).filters.value.runtime?"any":"long"),["enter"]))},[a[15]||(a[15]=i("span",null,"Full Feature (2hr+)",-1)),"long"===h(n).filters.value.runtime||"verylong"===h(n).filters.value.runtime?(v(),s("i",ia)):o("",!0)],34)])]),h(n).availableGenres.value.length>0?(v(),s("div",ra,[a[17]||(a[17]=i("h4",{class:"filter-section-title"},"Genres",-1)),i("div",na,[(v(!0),s(u,null,f(h(n).availableGenres.value,e=>(v(),s("button",{key:e,class:I(["filter-chip",{active:h(n).isGenreFiltered(e)}]),tabindex:"0",onClick:a=>h(n).toggleGenre(e),onKeydown:b(a=>h(n).toggleGenre(e),["enter"])},[i("span",null,p(e),1),h(n).isGenreFiltered(e)?(v(),s("i",ca)):o("",!0)],42,ua))),128))])])):o("",!0),h(n).availableTags.value.length>0?(v(),s("div",da,[a[18]||(a[18]=i("h4",{class:"filter-section-title"},"Tags",-1)),i("div",va,[(v(!0),s(u,null,f(h(n).availableTags.value,e=>(v(),s("button",{key:e,class:I(["filter-chip",{active:h(n).isTagFiltered(e)}]),tabindex:"0",onClick:a=>h(n).toggleTag(e),onKeydown:b(a=>h(n).toggleTag(e),["enter"])},[i("span",null,p(e),1),h(n).isTagFiltered(e)?(v(),s("i",ya)):o("",!0)],42,ma))),128))])])):o("",!0)])):o("",!0),i("main",ga,[h(n).searchQuery.value?(v(),s("div",ha,[i("p",null,p(N.value),1)])):o("",!0),h(n).isSearching.value?(v(),s("div",pa,[...a[19]||(a[19]=[i("i",{class:"fas fa-spinner fa-spin"},null,-1),i("p",null,"Searching...",-1)])])):h(n).searchError.value?(v(),s("div",fa,[a[20]||(a[20]=i("i",{class:"fas fa-exclamation-circle"},null,-1)),i("p",null,p(h(n).searchError.value),1)])):h(n).searchQuery.value?0===h(n).filteredResults.value.length&&h(n).searchQuery.value?(v(),s("div",ba,[...a[22]||(a[22]=[i("i",{class:"fas fa-film-slash"},null,-1),i("h2",null,"No Results Found",-1),i("p",null,"Try adjusting your search or filters",-1)])])):(v(),s("div",Ia,[(v(!0),s(u,null,f(h(n).groupedResults.value,(e,a)=>(v(),s("div",{key:a,class:"results-group"},[i("div",ka,[i("i",{class:I(h(M).getTypeIcon(a))},null,2),i("h2",null,p(h(M).formatTypeName(a)),1),i("span",Ta,p(e.length),1)]),i("div",La,[(v(!0),s(u,null,f(e,e=>(v(),g(x,{key:e.Id,item:e,"image-url":H(e),onClick:a=>(e=>{n.searchQuery.value&&S.trackSearchEvent(n.searchQuery.value,{genres:n.filters.value.genres,studios:n.filters.value.studios,itemTypes:n.filters.value.itemTypes},e.Id),t.push({name:"Details",params:{itemId:e.Id}})})(e)},null,8,["item","image-url","onClick"]))),128))])]))),128))])):(v(),s("div",wa,[...a[21]||(a[21]=[i("i",{class:"fas fa-search"},null,-1),i("h2",null,"Search Your Library",-1),i("p",null,"Find movies, TV shows, episodes, and more",-1)])]))])])]);var l}}}),[["__scopeId","data-v-de225202"]]),meta:{requiresAuth:!0,layout:"base"}},{path:"/details/:itemId",name:"Details",component:$e,meta:{requiresAuth:!0,layout:"base"}},{path:"/player/:itemId",name:"Player",component:Oe,meta:{requiresAuth:!0,layout:"none"}}],Ca=C({history:P(),routes:Da});Ca.beforeEach((e,a,l)=>{const t=j(),s=e.matched.some(e=>e.meta.requiresAuth);console.log(`[Router] Navigating to: ${e.path}, Auth: ${t.isAuthenticated.value}, Demo: ${t.isDemoMode.value}`),s&&!t.isAuthenticated.value?(console.warn("[Router] Access denied. Redirecting to login..."),l({name:"Login"})):"Login"===e.name&&t.isAuthenticated.value?(console.log("[Router] Already authenticated. Redirecting to home..."),l({name:"Home"})):l()});const Pa=S(ue);Pa.use(Ca),Pa.mount("#app");

import{d as e,r as a,k as o,m as l,o as t,c as r,i,l as s,u as c,g as n}from"./vue-vendor.B0WUDMXT.js";import{a as u,C as y,_ as v}from"./components.BQNxwHwS.js";import{u as m,l as d,m as g,c as b,a as p,s as I,o as C,v as L,b as f,w}from"./composables.CNmb4RHD.js";const T={id:"content-container"},h=v(e({__name:"CategoryPage",setup(e){const v=c(),h=s(),D=p(),M=f(),N=m(),S=w(),x=d(),P=g(),q=b(M,N,D.isDemoMode),F=L();I("Home");const _=C(M,N,x,P,D.isDemoMode,true),H=a([]),B=a("movies"),j=o(()=>_.currentLibrary.value&&"BoxSet"===_.currentLibrary.value.Type?_.currentLibrary.value.Name||"Collection":"movies"===B.value?"Movies":"tvshows"===B.value?"TV Shows":"collections"===B.value?"Collections":""),A=async()=>{const e=h.params.category;if(!["movies","tvshows","collections"].includes(e))return console.error("[CategoryPage] Invalid category:",e),void v.push({name:"Home"});B.value=e,0===_.allLibraries.value.length&&await _.loadLibraries();let a=[];if("movies"===e)a=_.allLibraries.value.filter(e=>"movies"===e.CollectionType),H.value=a;else if("tvshows"===e)a=_.allLibraries.value.filter(e=>"tvshows"===e.CollectionType),H.value=a;else if("collections"===e){const e=_.allLibraries.value.find(e=>"collections"===e.CollectionType||"boxsets"===e.CollectionType);if(e)if(D.isDemoMode.value)H.value=N.getLibraryItems(e.Id);else try{const a=await M.getItems(e.Id,"BoxSet");H.value=a}catch(o){console.error("[CategoryPage] Failed to load collections:",o),H.value=[]}else console.warn("[CategoryPage] No collections library found"),H.value=[]}S.pushToHistory("Category",{category:e})},k=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)(async e=>{if(_.currentLibrary.value=e,D.isDemoMode.value)H.value=N.getLibraryItems(e.Id);else try{let a=null;"movies"===e.CollectionType?a="Movie":"tvshows"===e.CollectionType?a="Series":"collections"!==e.CollectionType&&"boxsets"!==e.CollectionType||(a="BoxSet");const o=await M.getItems(e.Id,a);H.value=o}catch(o){console.error("[CategoryPage] Failed to load library items:",o),H.value=[]}const a={category:B.value,view:"library",libraryId:e.Id,libraryName:e.Name||""};S.pushToHistory("Category",{category:B.value,...a}),v.push({name:"Category",params:{category:B.value},query:a})})(e);else if("BoxSet"===e.Type)(async e=>{if(_.currentLibrary.value=e,D.isDemoMode.value)H.value=N.getCollectionItems(e.Id);else try{H.value=await M.getCollectionItems(e.Id)}catch(o){console.error("[CategoryPage] Failed to load collection items:",o),H.value=[]}const a={category:B.value,view:"collection",collectionId:e.Id,collectionName:e.Name||""};S.pushToHistory("Category",{category:B.value,...a}),v.push({name:"Category",params:{category:B.value},query:a})})(e);else{const a={};_.currentLibrary.value&&(a.sourceLibraryId=_.currentLibrary.value.Id,a.sourceLibraryName=_.currentLibrary.value.Name||"",_.currentLibrary.value.CollectionType&&(a.sourceLibraryType=_.currentLibrary.value.CollectionType)),S.pushToHistory("Details",a,{itemId:e.Id}),v.push({name:"Details",params:{itemId:e.Id},query:a})}},E=e=>q.getImageUrl(e,"Primary",y.MEDIA_CARD_DEFAULT);F.registerSidebarNavigation();const J=async()=>{const e=h.query.view,a=h.query.libraryId,o=h.query.collectionId;if("library"===e&&a){0===_.allLibraries.value.length&&await _.loadLibraries();const e=_.allLibraries.value.find(e=>e.Id===a);if(e)if(_.currentLibrary.value=e,D.isDemoMode.value)H.value=N.getLibraryItems(e.Id);else try{let a=null;"movies"===e.CollectionType?a="Movie":"tvshows"===e.CollectionType?a="Series":"collections"!==e.CollectionType&&"boxsets"!==e.CollectionType||(a="BoxSet");const o=await M.getItems(e.Id,a);H.value=o}catch(l){console.error("[CategoryPage] Failed to restore library items:",l),H.value=[]}}else if("collection"===e&&o)try{const e=await M.getItemDetails(o);_.currentLibrary.value=e,D.isDemoMode.value?H.value=N.getCollectionItems(e.Id):H.value=await M.getCollectionItems(e.Id)}catch(l){console.error("[CategoryPage] Failed to restore collection view:",l),await A()}else await A()};return l(()=>h.params.category,async(e,a)=>{e!==a&&await J()}),l(()=>h.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&await J()}),t(async()=>{await J()}),(e,a)=>(n(),r("div",T,[i(u,{items:H.value,title:j.value,"get-image-url":E,onItemClick:k},null,8,["items","title"])]))}}),[["__scopeId","data-v-2f61eb82"]]);export{h as default};

import{d as e,r as a,o as t,a as l,c as i,n as s,b as o,F as n,e as r,f as c,w as u,u as d,g as v,t as m,h as p,i as g,j as f,k as y,v as b,l as h,m as k,p as w,q as S,s as I,x,y as C,T as E,z as P,A as _,B as T}from"./vue-vendor.D_WZ5U5n.js";import{u as L,a as M,b as U,c as D,d as N,e as A,f as R,g as F}from"./composables.DRMrooBG.js";const V=""+new URL("EmbyFlix-logo.CCoAMb74.png",import.meta.url).href,$=440,K={MEDIA_CARD_SMALL:220,MEDIA_CARD_DEFAULT:300,MEDIA_CARD_LARGE:$,EPISODE_CARD:500,HERO_SLIDER:1920,BACKDROP_DEFAULT:1280,SIDEBAR_THUMB:154,DETAILS_POSTER:$},q={class:"sidebar w-[300px] transition-[width] duration-800"},B={class:"sidebar-nav","data-nav-container":"sidebar"},G=["onClick"],W={class:"nav-text"},H={class:"opacity-0 transition-opacity duration-300 group-focus-within:opacity-50 group-hover:opacity-50 focus-within:!opacity-100 hover:!opacity-100"},z={key:0,class:"continue-watching-container mt-8 mb-25"},O={class:"continue-watching-list",style:{"list-style":"none"}},j=["onKeydown"],Y={class:"absolute inset-0 overflow-hidden z-0 rounded-xl"},Q=["src","alt"],X={class:"flex flex-col justify-between z-1 relative h-40 w-full self-end px-4 pb-1 bg-gradient-to-t from-black/30 to-transparent group-focus/item:from-black/0"},J={class:"item-title-wrapper"},Z={class:"item-title font-bold text-white text-shadow"},ee={key:0,class:"bg-black bg-opacity-30"},ae={class:"bottom-row w-full"},te={class:"progress-details flex justify-between w-full items-center"},le={class:"flex bg-gray-600 bg-opacity-50 backdrop-blur-sm text-white px-2 rounded h-8 items-center justify-between gap-2"},ie={key:0},se=(e,a)=>{const t=e.__vccOpts||e;for(const[l,i]of a)t[l]=i;return t},oe=se(e({__name:"Sidebar",props:{activeNavItem:{},userName:{}},emits:["navigate","logout"],setup(e,{emit:f}){const y=f,b=d(),h=M(),k=L(),w=U(),S=a([]),I=[{id:"home",icon:"fas fa-home",text:"Home"},{id:"movies",icon:"fas fa-film",text:"Movies"},{id:"tvshows",icon:"fas fa-tv",text:"TV Shows"},{id:"collections",icon:"fas fa-folder",text:"Collections"},{id:"search",icon:"fas fa-search",text:"Search"},{id:"settings",icon:"fas fa-cog",text:"Settings"}],x=()=>{y("logout")},C=async()=>{if(h.isDemoMode.value)S.value=k.getContinueWatching();else try{const e=await w.getContinueWatching(),a=e.reduce((e,a)=>{const t=a.SeriesName||a.Name,l=a.ProductionYear;return e.some(e=>{const a=e.SeriesName||e.Name,i=e.ProductionYear;return a===t&&i===l})||e.push(a),e},[]);S.value=a,console.log("[Sidebar] Loaded continue watching items:",a.length,"unique items from",e.length,"total items")}catch(e){console.error("[Sidebar] Failed to load continue watching:",e)}},E=e=>h.isDemoMode.value?e.ImageUrl||"":w.getImageUrl(e.Id,"Primary",K.MEDIA_CARD_DEFAULT),P=e=>e.UserData?.PlaybackPositionTicks&&e.RunTimeTicks?Math.round(e.UserData.PlaybackPositionTicks/e.RunTimeTicks*100):0,_=e=>"Episode"===e.Type&&e.ParentIndexNumber&&e.IndexNumber?`S${e.ParentIndexNumber} E${e.IndexNumber}`:"",T=()=>{console.log("[Sidebar] Refreshing continue watching list"),C()},D=a(!1);return t(()=>{C(),window.addEventListener("refresh-continue-watching",T),setTimeout(()=>{D.value=!0},50)}),l(()=>{window.removeEventListener("refresh-continue-watching",T)}),(a,t)=>(v(),i("div",{class:s(["group sidebar-wrapper",{"enable-transition":D.value}]),"data-nav-zone":"sidebar"},[o("div",q,[o("nav",B,[(v(),i(n,null,r(I,a=>o("a",{key:a.id,href:"#",class:s(["nav-item",{active:e.activeNavItem===a.id}]),onClick:u(e=>y("navigate",a.id),["prevent"])},[o("i",{class:s(a.icon+" nav-icon")},null,2),o("span",W,m(a.text),1)],10,G)),64)),o("div",H,[S.value.length>0?(v(),i("div",z,[t[1]||(t[1]=o("h3",{class:"pl-2 mb-3 text-white font-semibold"},"Continue Watching",-1)),o("ul",O,[(v(!0),i(n,null,r(S.value,e=>(v(),i("li",{key:e.Id,class:"continue-watching-item relative overflow-hidden mb-3"},[o("div",{class:"item-wrapper bg-black min-h-45 rounded-xl relative flex cursor-pointer group/item",onKeydown:p(a=>(e=>{b.push({name:"Player",params:{itemId:e.Id}})})(e),["enter"]),tabindex:"0"},[o("div",Y,[o("img",{class:"w-full h-full object-cover",src:E(e),alt:e.SeriesName||e.Name,loading:"lazy",decoding:"async"},null,8,Q)]),o("div",X,[o("div",J,[o("span",Z,m(e.SeriesName||e.Name),1),P(e)?(v(),i("div",ee,[o("div",{class:"progress-bar bg-[#13ff00] h-1 mt-2 shadow-sm rounded-sm",style:g({width:P(e)+"%"})},null,4)])):c("",!0)]),o("div",ae,[o("div",te,[t[0]||(t[0]=o("span",{class:"btn-overlay bg-gray-600 bg-opacity-50 backdrop-blur-sm rounded-full w-8 h-8 flex justify-center items-center text-white"},[o("i",{class:"fas fa-play"})],-1)),o("div",le,[_(e)?(v(),i("span",ie,m(_(e)),1)):c("",!0),o("span",null,m(P(e))+"%",1)])])])])],40,j)]))),128))])])):c("",!0)]),o("a",{href:"#",class:"nav-item logout-item",onClick:u(x,["prevent"])},[...t[2]||(t[2]=[o("i",{class:"fas fa-sign-out-alt nav-icon"},null,-1),o("span",{class:"nav-text"},"Logout",-1)])])])])],2))}}),[["__scopeId","data-v-f49400db"]]),ne={class:"search-container flex-1 flex items-center justify-end px-8"},re={class:"search-wrapper relative w-full max-w-125"},ce=se(e({__name:"Header",setup(e){const t=d(),l=h(),n=a(""),r=a(!1);f(()=>l.query.q,e=>{"Search"===l.name&&(n.value=e||"")},{immediate:!0}),f(n,e=>{"Search"===l.name&&e.trim()&&t.replace({name:"Search",query:{q:e.trim()}})});const c=e=>{"Enter"===e.key&&n.value.trim()&&t.push({name:"Search",query:{q:n.value.trim()}})},u=()=>{t.push({name:"Search"})};return(e,a)=>(v(),i("div",ne,[o("div",re,[o("i",{class:"fas fa-search search-icon absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer",onClick:u}),y(o("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),type:"text",placeholder:"Movies, series, shows...",class:s(["search-input w-full h-12 pl-12 pr-12 rounded-lg bg-gray-800/80 text-white border-none transition-all",{"bg-gray-700/90":r.value}]),onFocus:a[1]||(a[1]=e=>r.value=!0),onBlur:a[2]||(a[2]=e=>r.value=!1),onKeydown:c,onClick:u,tabindex:"0"},null,34),[[b,n.value]])])]))}}),[["__scopeId","data-v-b282c8dc"]]),ue={class:"layout"},de={key:0,class:"global-backdrop"},ve=["src"],me={class:"header"},pe={class:"content"},ge={class:"main-content px-7.5"},fe=se(e({__name:"BaseLayout",props:{activeNavItem:{},userName:{}},emits:["navigate","logout","search"],setup(e,{emit:s}){const n=s,r=a(""),u=e=>{n("search",e)},d=e=>{const a=e;r.value=a.detail||""};return t(()=>{const e=document.querySelector(".sidebar .nav-item");e&&e.focus(),window.addEventListener("update-backdrop",d)}),l(()=>{window.removeEventListener("update-backdrop",d)}),(a,t)=>(v(),i("div",ue,[r.value?(v(),i("div",de,[o("img",{src:r.value,alt:"Backdrop",class:"backdrop-image"},null,8,ve),t[2]||(t[2]=o("div",{class:"backdrop-gradient"},null,-1))])):c("",!0),o("div",me,[t[3]||(t[3]=o("div",{class:"logo-container w-75 h-full flex items-center b-bottom-1 border-primary-color border-1 pl-5"},[o("img",{src:V,alt:"EmbyFlix",class:"header-logo"})],-1)),k(ce,{onSearch:u})]),o("div",pe,[k(oe,{"active-nav-item":e.activeNavItem,"user-name":e.userName,onNavigate:t[0]||(t[0]=e=>n("navigate",e)),onLogout:t[1]||(t[1]=e=>n("logout"))},null,8,["active-nav-item","user-name"]),o("div",ge,[w(a.$slots,"default",{},void 0)])])]))}}),[["__scopeId","data-v-54501bb7"]]),ye={key:0,class:"layout-wrapper"},be={key:1,class:"no-layout-wrapper"},he=se(e({__name:"LayoutWrapper",setup(e){const t=h(),l=d(),s=M(),o=a("home"),n=S(()=>t.meta.layout||"none"),r=S(()=>"base"===n.value);f(()=>t.name,e=>{switch(e){case"Home":default:o.value="home";break;case"Search":o.value="search";break;case"Details":o.value="details"}},{immediate:!0});const c=e=>{switch(o.value=e,e){case"home":l.push({name:"Home"});break;case"search":l.push({name:"Search"});break;case"movies":case"tvshows":case"collections":case"settings":l.push({name:"Home"});const a=new CustomEvent("sidebar-navigate",{detail:e});window.dispatchEvent(a);break;default:const t=new CustomEvent("sidebar-navigate",{detail:e});window.dispatchEvent(t)}},u=()=>{s.logout(),l.push({name:"Login"})},m=e=>{const a=new CustomEvent("app-search",{detail:e});window.dispatchEvent(a)};return(e,a)=>{const t=C("RouterView");return r.value?(v(),i("div",ye,[k(fe,{"active-nav-item":o.value,"user-name":I(s).currentUser.value?.Name||"User",onNavigate:c,onLogout:u,onSearch:m},{default:x(()=>[k(t)]),_:1},8,["active-nav-item","user-name"])])):(v(),i("div",be,[k(t)]))}}}),[["__scopeId","data-v-52626496"]]),ke={class:"login-container"},we={key:0,class:"error-message"},Se={class:"form-group"},Ie=["disabled"],xe={class:"form-group"},Ce=["disabled"],Ee={class:"form-group"},Pe=["disabled"],_e=["disabled"],Te=["disabled"],Le=e({__name:"LoginForm",props:{isLoading:{type:Boolean},error:{}},setup(e){const t=d(),l=M(),n=U(),r=a("http://localhost:8096"),u=a(""),p=a(""),g=a(""),f=async e=>{if(e&&e.preventDefault(),r.value&&u.value)try{const e=await n.authenticateByName(r.value,u.value,p.value);l.login(e.User),t.push({name:"Home"})}catch(a){g.value=a,console.error("Login failed:",a)}},h=()=>{l.enableDemoMode(),t.push({name:"Home"})};return(a,t)=>(v(),i("div",ke,[o("div",{class:s(["login-box",{"bg-red":g.value}])},[t[6]||(t[6]=o("div",{class:"logo-wrapper"},[o("img",{src:V,alt:"EmbyFlix",class:"login-logo"})],-1)),t[7]||(t[7]=o("p",null,"Connect to your Emby Server",-1)),g.value?(v(),i("div",we,m(g.value),1)):c("",!0),o("form",{onSubmit:f},[o("div",Se,[t[3]||(t[3]=o("label",{for:"server-url"},"Server URL",-1)),y(o("input",{id:"server-url","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"text",placeholder:"https://your-server:8096",disabled:e.isLoading},null,8,Ie),[[b,r.value]])]),o("div",xe,[t[4]||(t[4]=o("label",{for:"username"},"Username",-1)),y(o("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),type:"text",placeholder:"Enter username",disabled:e.isLoading},null,8,Ce),[[b,u.value]])]),o("div",Ee,[t[5]||(t[5]=o("label",{for:"password"},"Password",-1)),y(o("input",{id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),type:"password",placeholder:"Enter password",disabled:e.isLoading},null,8,Pe),[[b,p.value]])]),o("button",{type:"submit",class:"btn-primary",disabled:e.isLoading||!r.value||!u.value||!p.value||p.value.length<8},m(e.isLoading?"Connecting...":"Connect to Server"),9,_e),o("button",{type:"button",class:"btn-secondary",disabled:e.isLoading,onClick:h}," Demo Mode (Test UI) ",8,Te)],32)],2)]))}}),Me={class:"hero-slider-container"},Ue={key:0,class:"slider-section-title"},De=["data-slider-id"],Ne={class:"hero-slider"},Ae=["src","alt"],Re=["src","alt"],Fe={class:"slide-meta"},Ve={key:0,class:"meta-item"},$e={key:1,class:"meta-item rating"},Ke={key:2,class:"meta-item"},qe={key:3,class:"meta-item"},Be={key:2,class:"slide-genres"},Ge={key:3,class:"slide-description"},We={class:"slide-actions"},He={class:"slider-indicators"},ze=["onClick","aria-label"],Oe=se(e({__name:"HeroSlider",props:{items:{},getImageUrl:{},title:{},showFavoriteButton:{type:Boolean,default:!0},height:{default:"600px"},titleSize:{default:"3rem"},sliderId:{default:"hero"}},emits:["play","favorite","navigate"],setup(e,{emit:u}){const d=e,p=U(),y=L(),b=M(),h=D(p,y,b.isDemoMode),w=u,C=a(),_=a(0),T=a("slider"),A=a("slider"),R=a(new Map),F=a(new Map),V=a(new Set),$=()=>{_.value=(_.value+1)%d.items.length},K=e=>{if(C.value===document.activeElement)switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),"slider"===T.value?z(d.items[_.value]):"play"===T.value?W(d.items[_.value]):"favorite"===T.value&&H(d.items[_.value]);break;case"ArrowLeft":if(e.preventDefault(),e.stopPropagation(),"slider"===T.value)if(0===_.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"left"});window.dispatchEvent(e)}else _.value=(_.value-1+d.items.length)%d.items.length;else"play"===T.value?T.value="slider":"favorite"===T.value&&(T.value="play");break;case"ArrowRight":e.preventDefault(),e.stopPropagation(),"slider"===T.value?$():"play"===T.value?d.showFavoriteButton?T.value="favorite":($(),T.value="slider"):"favorite"===T.value&&($(),T.value="slider");break;case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),"slider"===T.value)T.value="play";else if("play"===T.value||"favorite"===T.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"down"});window.dispatchEvent(e)}break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),"slider"===T.value){const e=new CustomEvent(`exit${d.sliderId}Slider`,{detail:"up"});window.dispatchEvent(e)}else("play"===T.value||"favorite"===T.value)&&(T.value="slider")}},q=e=>{const a=e.relatedTarget;(!a||!C.value?.contains(a))&&(T.value=A.value)},B=()=>{A.value=T.value},G=e=>{const a=e.relatedTarget;(!a||!C.value?.contains(a))&&(T.value=A.value)};t(()=>{T.value="slider",C.value&&(C.value.addEventListener("keydown",K),C.value.addEventListener("focus",G,!0),C.value.addEventListener("focusin",q),C.value.addEventListener("focusout",B))}),l(()=>{C.value&&(C.value.removeEventListener("keydown",K),C.value.removeEventListener("focus",G,!0),C.value.removeEventListener("focusin",q),C.value.removeEventListener("focusout",B))});const W=e=>{w("play",e)},H=e=>{w("favorite",e)},z=e=>{w("navigate",e)},{formatRuntime:O}=N(),j=S(()=>d.items[_.value]),Y=S(()=>"Series"===j.value?.Type),Q=S(()=>Y.value?"Go to Show":"Play"),X=S(()=>Y.value?"fa-arrow-right":"fa-play"),J=async e=>await h.loadImageUrl(e,d.getImageUrl,d.items),Z=e=>V.value.has(e)?"":F.value.get(e)||"",ee=e=>{h.preloadImage(e)},ae=async()=>{const e=d.items[_.value];if(e){if(!R.value.has(e.Id)){const a=await J(e.Id);a&&R.value.set(e.Id,a)}if(!F.value.has(e.Id)){const a=(e=>{if(b.isDemoMode.value)return"";try{return p.getImageUrl(e,"Logo",500)}catch(a){return""}})(e.Id);a&&F.value.set(e.Id,a)}}(async()=>{const e=(_.value+1)%d.items.length,a=(_.value-1+d.items.length)%d.items.length,t=await J(d.items[e].Id);t&&(R.value.set(d.items[e].Id,t),ee(t));const l=await J(d.items[a].Id);l&&(R.value.set(d.items[a].Id,l),ee(l))})()};return f(()=>_.value,()=>{ae()},{immediate:!0}),f(()=>d.items,()=>{d.items.length>0&&ae()},{immediate:!0}),(a,t)=>(v(),i("div",Me,[d.title?(v(),i("h2",Ue,m(d.title),1)):c("",!0),o("div",{ref_key:"sliderWrapper",ref:C,class:"hero-slider-wrapper",tabindex:"0",style:g({height:d.height}),"data-slider-id":d.sliderId},[o("div",Ne,[k(E,{name:"slide-fade"},{default:x(()=>{return[d.items[_.value]?(v(),i("div",{key:d.items[_.value].Id,class:"hero-slide"},[o("div",{class:"slide-background",onClick:t[0]||(t[0]=e=>z(d.items[_.value]))},[o("img",{src:(a=d.items[_.value].Id,R.value.get(a)||""||d.items[_.value].ImageUrl),alt:d.items[_.value].Name,loading:"lazy",decoding:"async"},null,8,Ae)]),o("div",{class:s(["slide-content",{slim:"600px"!==e.height}])},[Z(d.items[_.value].Id)?(v(),i("img",{key:0,src:Z(d.items[_.value].Id),alt:d.items[_.value].Name,class:"slide-logo",onError:t[1]||(t[1]=e=>(e=>{console.log(`[HeroSlider] Logo failed to load for item: ${e}`),V.value.add(e),F.value.delete(e)})(d.items[_.value].Id))},null,40,Re)):(v(),i("h1",{key:1,class:"slide-title",style:g({fontSize:d.titleSize})},m(d.items[_.value].Name),5)),o("div",Fe,[d.items[_.value]?.ProductionYear?(v(),i("span",Ve,m(d.items[_.value]?.ProductionYear),1)):c("",!0),d.items[_.value]?.CommunityRating?(v(),i("span",$e," ⭐ "+m(d.items[_.value]?.CommunityRating?.toFixed(1)),1)):c("",!0),d.items[_.value]?.OfficialRating?(v(),i("span",Ke,m(d.items[_.value]?.OfficialRating),1)):c("",!0),d.items[_.value]?.RunTimeTicks?(v(),i("span",qe,m(I(O)(d.items[_.value]?.RunTimeTicks)),1)):c("",!0)]),d.items[_.value]?.Genres?(v(),i("div",Be,[(v(!0),i(n,null,r(d.items[_.value]?.Genres?.slice(0,3),e=>(v(),i("span",{key:e,class:"genre-tag"},m(e),1))),128))])):c("",!0),d.items[_.value]?.Overview?(v(),i("p",Ge,m(d.items[_.value]?.Overview?.substring(0,150))+"... ",1)):c("",!0),o("div",We,[o("button",{tabindex:"-1",class:s(["btn-play",{focused:"play"===T.value}]),onClick:t[2]||(t[2]=e=>W(d.items[_.value]))},[o("i",{class:s(["fas",X.value])},null,2),P(" "+m(Q.value),1)],2),d.showFavoriteButton?(v(),i("button",{key:0,tabindex:"-1",class:s(["btn-favorite",{focused:"favorite"===T.value}]),onClick:t[3]||(t[3]=e=>H(d.items[_.value]))},[...t[4]||(t[4]=[o("i",{class:"fas fa-heart"},null,-1),P(" Add to Favorites ",-1)])],2)):c("",!0)])],2)])):c("",!0)];var a}),_:1})]),o("div",He,[(v(!0),i(n,null,r(d.items,(e,a)=>(v(),i("button",{key:e.Id,tabindex:"-1",class:s(["indicator",{active:_.value===a}]),onClick:e=>(e=>{e>=0&&e<d.items.length&&(_.value=e,T.value="slider")})(a),"aria-label":`Go to slide ${a+1}`},null,10,ze))),128))])],12,De)]))}}),[["__scopeId","data-v-09fa30cf"]]),je={class:"card-image"},Ye=["src","alt"],Qe={key:1,class:"placeholder-image"},Xe={key:2,class:"placeholder-image"},Je={key:3,class:"watched-badge",title:"Watched"},Ze={key:4,class:"rating-badges"},ea=["title"],aa=["title"],ta={key:5,class:"streaming-providers"},la=["src","alt","title"],ia=["title"],sa={class:"card-info min-h-16"},oa={class:"card-title"},na={key:0,class:"card-year"},ra=se(e({__name:"MediaCard",props:{item:{},imageUrl:{},streamingProviders:{}},emits:["click"],setup(e,{emit:t}){const l=e,u=t,d=a(),g=a(!1);A(d,{threshold:.01,rootMargin:"200px",onEnter:()=>{g.value=!0}});const f=e=>"Id"in e&&"Name"in e,y=e=>"title"in e&&!("name"in e),b=e=>"name"in e&&"first_air_date"in e,h=S(()=>f(l.item)?l.item.Name:y(l.item)?l.item.title:b(l.item)?l.item.name:""),k=S(()=>(console.log("item::",l.item),f(l.item)?l.item.ProductionYear?.toString()||null:y(l.item)?l.item.release_date?new Date(l.item.release_date).getFullYear().toString():null:b(l.item)&&l.item.first_air_date?new Date(l.item.first_air_date).getFullYear().toString():null)),w=S(()=>l.imageUrl?l.imageUrl:f(l.item)?l.item.ImageUrl:null),I=S(()=>f(l.item)&&l.item.CommunityRating?{value:l.item.CommunityRating,display:`${(10*l.item.CommunityRating).toFixed(0)}%`}:!f(l.item)&&l.item.vote_average?{value:l.item.vote_average,display:`${(10*l.item.vote_average).toFixed(0)}%`}:null),x=S(()=>f(l.item)&&l.item.CriticRating?{value:l.item.CriticRating,display:`${l.item.CriticRating}%`}:null),C=S(()=>null!==I.value||null!==x.value),E=S(()=>!!f(l.item)&&!0===l.item.UserData?.Played),P=S(()=>{if(f(l.item)){if("Movie"===l.item.Type)return"movie";if("Series"===l.item.Type)return"tv"}else{if(y(l.item))return"movie";if(b(l.item))return"tv"}return null}),_=S(()=>l.streamingProviders?.slice(0,3)||[]);return(a,t)=>(v(),i("div",{ref_key:"cardRef",ref:d,class:"media-card",tabindex:"0",onClick:t[0]||(t[0]=a=>u("click",e.item)),onKeydown:t[1]||(t[1]=p(a=>u("click",e.item),["enter"]))},[o("div",je,[g.value&&w.value?(v(),i("img",{key:0,src:w.value,alt:h.value,loading:"lazy",decoding:"async"},null,8,Ye)):g.value?(v(),i("div",Xe,m(h.value),1)):(v(),i("div",Qe," Loading... ")),E.value?(v(),i("div",Je,[...t[2]||(t[2]=[o("span",null,"Watched",-1)])])):c("",!0),C.value?(v(),i("div",Ze,[I.value?(v(),i("div",{key:0,class:"rating-badge community",title:`Audience Score: ${I.value.display}`},[t[3]||(t[3]=o("i",{class:"fas fa-users"},null,-1)),o("span",null,m(I.value.display),1)],8,ea)):c("",!0),x.value?(v(),i("div",{key:1,class:"rating-badge critic",title:`Critics Score: ${x.value.display}`},[t[4]||(t[4]=o("i",{class:"fas fa-star"},null,-1)),o("span",null,m(x.value.display),1)],8,aa)):c("",!0)])):c("",!0),_.value.length>0?(v(),i("div",ta,[(v(!0),i(n,null,r(_.value,e=>{return v(),i("img",{key:e.provider_id,src:(a=e.logo_path,`https://image.tmdb.org/t/p/original${a}`),alt:e.provider_name,title:`Available on ${e.provider_name}`,class:"provider-logo"},null,8,la);var a}),128))])):c("",!0),P.value?(v(),i("div",{key:6,class:"media-type-icon",title:"movie"===P.value?"Movie":"TV Show"},[o("i",{class:s("movie"===P.value?"fas fa-film":"fas fa-tv")},null,2)],8,ia)):c("",!0)]),o("div",sa,[o("h3",oa,m(h.value),1),k.value?(v(),i("div",na,m(k.value),1)):c("",!0)])],544))}}),[["__scopeId","data-v-27f561d5"]]),ca={class:"media-row","data-nav-zone":"media-row"},ua={class:"row-container","data-nav-container":"media-row"},da={key:0,class:"loading-state"},va=se(e({__name:"MediaRow",props:{items:{},loading:{type:Boolean},getImageUrl:{type:Function},loop:{type:Boolean}},emits:["itemClick","nearEnd"],setup(e,{emit:s}){const u=e,d=s,m=e=>"embyItem"in e&&"tmdbData"in e,p=e=>"Id"in e&&"Name"in e&&!("title"in e)&&!("name"in e),g=S(()=>u.loop&&0!==u.items.length?[...u.items,...u.items,...u.items]:u.items),y=a();let b=!1;const h=e=>{if(!y.value)return;const a=.8*y.value.clientWidth,t=y.value.scrollLeft+("right"===e?a:-a);y.value.scrollTo({left:t,behavior:"smooth"})},k=()=>{if(!y.value||b)return;const{scrollLeft:e,scrollWidth:a,clientWidth:t}=y.value;if(u.loop&&u.items.length>0){const t=a/3;e>=2*t?(b=!0,y.value.scrollLeft=e-t,setTimeout(()=>{b=!1},50)):e<=.1*t&&(b=!0,y.value.scrollLeft=e+t,setTimeout(()=>{b=!1},50))}else{(e+t)/a>=.7&&d("nearEnd")}},w=()=>{if(!y.value||u.loop)return;const{scrollWidth:e,clientWidth:a}=y.value;e<=a&&d("nearEnd")},I=()=>{if(y.value&&u.loop&&u.items.length>0){const e=y.value.scrollWidth/3;y.value.scrollLeft=e}};return f(()=>u.items,async()=>{await T(),setTimeout(w,100)},{immediate:!1}),t(()=>{y.value&&(y.value.addEventListener("scroll",k,{passive:!0}),setTimeout(I,100),setTimeout(w,150))}),l(()=>{y.value&&y.value.removeEventListener("scroll",k)}),(a,t)=>(v(),i("div",ca,[o("div",ua,[o("button",{class:"scroll-btn scroll-btn-left",tabindex:"-1",onClick:t[0]||(t[0]=e=>h("left")),"aria-label":"Scroll left"},[...t[2]||(t[2]=[o("i",{class:"fas fa-chevron-left"},null,-1)])]),o("div",{ref_key:"scrollContainer",ref:y,class:"row-content","data-nav-scrollable":"true"},[e.loading?(v(),i("div",da,[(v(),i(n,null,r(6,e=>o("div",{key:e,class:"media-card-skeleton"})),64))])):c("",!0),(v(!0),i(n,null,r(g.value,(a,t)=>(v(),i(n,{key:`${m(a)?a.embyId:p(a)?a.Id:a.id}-${t}`},[m(a)?(v(),_(ra,{key:0,item:a.embyItem,"image-url":e.getImageUrl(a.tmdbData)||void 0,"streaming-providers":a.streamingProviders,onClick:e=>d("itemClick",a.tmdbData)},null,8,["item","image-url","streaming-providers","onClick"])):p(a)?(v(),_(ra,{key:1,item:a,"image-url":e.getImageUrl(a)||void 0,onClick:e=>d("itemClick",a)},null,8,["item","image-url","onClick"])):(v(),_(ra,{key:2,item:a,"image-url":e.getImageUrl(a)||void 0,onClick:e=>d("itemClick",a)},null,8,["item","image-url","onClick"]))],64))),128))],512),o("button",{class:"scroll-btn scroll-btn-right",tabindex:"-1",onClick:t[1]||(t[1]=e=>h("right")),"aria-label":"Scroll right"},[...t[3]||(t[3]=[o("i",{class:"fas fa-chevron-right"},null,-1)])])])]))}}),[["__scopeId","data-v-c99390b6"]]),ma={class:"genre-filter","data-nav-zone":"genre-filter"},pa={class:"filter-container"},ga=["onClick","onKeydown","onFocus"],fa=se(e({__name:"GenreFilter",props:{genres:{},selectedGenres:{default:()=>[]},maxVisible:{default:8}},emits:["update:selectedGenres"],setup(e,{emit:t}){const l=e,c=t,u=a(),d=a([]),p=a(-1),g=e=>{const a=[...l.selectedGenres],t=a.indexOf(e);t>-1?a.splice(t,1):a.push(e),c("update:selectedGenres",a)},f=()=>{c("update:selectedGenres",[])},y=S(()=>l.selectedGenres.length>0),b=e=>{if(!u.value||!d.value[e])return;const a=d.value[e],t=u.value,l=a.offsetLeft,i=l+a.offsetWidth,s=t.scrollLeft,o=t.clientWidth;l<s?t.scrollTo({left:l-20,behavior:"smooth"}):i>s+o&&t.scrollTo({left:i-o+20,behavior:"smooth"})},h=(e,a,t)=>{const i=l.genres.length+1;switch(e.key){case"ArrowLeft":0===a||(e.preventDefault(),e.stopPropagation(),p.value=a-1,T(()=>{d.value[p.value]?.focus(),b(p.value)}));break;case"ArrowRight":e.preventDefault(),e.stopPropagation(),a<i-1&&(p.value=a+1,T(()=>{d.value[p.value]?.focus(),b(p.value)}));break;case"ArrowUp":case"ArrowDown":break;case"Enter":case" ":e.preventDefault(),e.stopPropagation(),0===a?f():void 0!==t&&g(t)}},k=e=>{p.value=e},w=(e,a)=>{e&&(d.value[a]=e)};return(a,t)=>(v(),i("div",ma,[o("div",pa,[o("div",{ref_key:"scrollContainer",ref:u,class:"genres-list"},[o("button",{ref:e=>w(e,0),class:s(["genre-pill",{active:!y.value}]),tabindex:"0",onClick:f,onKeydown:t[0]||(t[0]=e=>h(e,0)),onFocus:t[1]||(t[1]=e=>k(0))}," All ",34),(v(!0),i(n,null,r(e.genres,(e,a)=>{return v(),i("button",{key:e.id,ref_for:!0,ref:e=>w(e,a+1),class:s(["genre-pill",{active:(t=e.id,l.selectedGenres.includes(t))}]),tabindex:"0",onClick:a=>g(e.id),onKeydown:t=>h(t,a+1,e.id),onFocus:e=>k(a+1)},m(e.name),43,ga);var t}),128))],512)])]))}}),[["__scopeId","data-v-4ea3843b"]]),ya={class:"modal-container"},ba={class:"modal-body"},ha={key:0,class:"error-message"},ka={class:"form-group"},wa=se(e({__name:"TmdbApiKeyModal",emits:["close","submit"],setup(e,{emit:t}){const l=t,s=a(""),n=a(""),r=()=>{console.log("[TmdbApiKeyModal] handleSubmit called with:",s.value),s.value.trim()?s.value.trim().length<32?n.value="API key appears to be invalid (too short)":(console.log("[TmdbApiKeyModal] Emitting submit event"),l("submit",s.value.trim())):n.value="Please enter a valid API key"},d=()=>{l("close")};return(e,a)=>(v(),i("div",{class:"modal-overlay",onClick:u(d,["self"])},[o("div",ya,[o("div",{class:"modal-header"},[a[2]||(a[2]=o("h2",null,"TMDB API Key Required",-1)),o("button",{class:"close-button",onClick:d},[...a[1]||(a[1]=[o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M18 6L6 18M6 6l12 12","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),o("div",ba,[a[6]||(a[6]=o("p",{class:"description"}," To display trending movies and TV shows, we need a TMDB (The Movie Database) API key. This service is free and provides rich media information. ",-1)),n.value?(v(),i("div",ha,m(n.value),1)):c("",!0),o("form",{onSubmit:u(r,["prevent"])},[o("div",ka,[a[3]||(a[3]=o("label",{for:"tmdb-api-key"},"API Key",-1)),y(o("input",{id:"tmdb-api-key","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),type:"text",placeholder:"Enter your TMDB API key",autocomplete:"off",spellcheck:"false"},null,512),[[b,s.value]])]),a[5]||(a[5]=o("div",{class:"info-section"},[o("p",{class:"info-text"},[P(" Don't have an API key? "),o("a",{href:"https://www.themoviedb.org/settings/api",target:"_blank",rel:"noopener noreferrer",class:"register-link"}," Register for free on TMDB ")]),o("p",{class:"info-text small"}," After registering, you can find your API key in your account settings under the API section. ")],-1)),o("div",{class:"button-group"},[o("button",{type:"button",class:"btn-secondary",onClick:d}," Skip for Now "),a[4]||(a[4]=o("button",{type:"submit",class:"btn-primary"}," Save API Key ",-1))])],32)])])]))}}),[["__scopeId","data-v-5a9c93db"]]),Sa={key:0,class:"movie-grid-container"},Ia={key:0,class:"grid-title"},xa={class:"grid",style:{position:"relative"},"data-nav-zone":"movie-grid"},Ca=e({__name:"MovieGrid",props:{items:{},title:{},getImageUrl:{type:Function}},emits:["itemClick"],setup(e,{emit:l}){const s=e,u=l,d=a(),p=a(0),f=a(600),y=S(()=>{if(!d.value)return 4;const e=d.value.clientWidth;return Math.max(1,Math.floor(e/196))}),b=S(()=>Math.ceil(f.value/336)+2),h=S(()=>Math.max(0,Math.floor(p.value/336)-1)),k=S(()=>{const e=h.value+b.value;return Math.min(Math.ceil(s.items.length/y.value),e)}),w=S(()=>{const e=h.value*y.value,a=k.value*y.value;return s.items.slice(e,a)}),I=S(()=>336*h.value),x=e=>{console.log("HandleScroll",e);const a=e.target;p.value=a.scrollTop,f.value=a.clientHeight};return t(()=>{d.value&&(f.value=d.value.clientHeight)}),(a,t)=>w.value?(v(),i("div",Sa,[e.title?(v(),i("h2",Ia,m(e.title),1)):c("",!0),o("div",{ref_key:"gridContainer",ref:d,class:"grid-wrapper",onScroll:x},[o("div",xa,[o("div",{style:g({transform:`translateY(${I.value}px)`})},[(v(!0),i(n,null,r(e.items,a=>(v(),_(ra,{key:a.Id,item:a,"image-url":e.getImageUrl?e.getImageUrl(a.Id):a.ImageUrl,onClick:e=>u("itemClick",a)},null,8,["item","image-url","onClick"]))),128))],4)])],544)])):c("",!0)}}),Ea={class:"details-hero"},Pa={class:"hero-content"},_a=["src","alt"],Ta={key:1,class:"hero-title"},La={class:"hero-actions"},Ma={class:"hero-meta"},Ua={key:0,class:"meta-item"},Da={key:1,class:"meta-item meta-rating-badge"},Na={key:2,class:"meta-item"},Aa={key:3,class:"meta-item meta-star-rating"},Ra={key:2,class:"hero-genres"},Fa={key:0},Va={key:3,class:"hero-overview"},$a={class:"hero-extra-actions"},Ka=["title"],qa=se(e({__name:"MovieDetails",props:{item:{},imageUrl:{},backdropUrl:{},logoUrl:{}},emits:["play","back","browse","removeFromContinueWatching","markAsUnwatched"],setup(e,{emit:l}){const u=e,d=l,p=a(!1);t(()=>{const e=document.querySelector(".btn-hero-play");e&&e.focus()});const{formatRuntime:g,formatRating:y}=N(),b=S(()=>"BoxSet"===u.item.Type),h=S(()=>!0===u.item.UserData?.Played),k=()=>{console.log(`[MovieDetails] Logo failed to load for item: ${u.item.Name}`),p.value=!0};f(()=>[u.item.Id,u.logoUrl],()=>{p.value=!1});const w=()=>{const e=document.querySelector(".main-content");e&&e.scrollTo({top:0,behavior:"smooth"})},x=(e,a)=>{if(e.key.startsWith("Arrow"))switch(e.preventDefault(),e.stopPropagation(),e.key){case"ArrowLeft":if("play"===a){const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}else if("back"===a){const e=document.querySelector(".btn-hero-play");e?.focus()}else if("mark"===a){const e=document.querySelector(".sidebar .nav-item");e&&e.focus()}break;case"ArrowRight":if("play"===a){const e=document.querySelector(".btn-hero-secondary");e?.focus()}else if("back"===a){const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");e?.focus()}break;case"ArrowDown":if("play"===a||"back"===a){const e=document.querySelector(".hero-extra-actions .btn-hero-secondary");if(e)e.focus();else{const e=document.querySelector(".season-buttons button"),a=document.querySelector(".similar-titles .media-card");e?e.focus():a&&a.focus()}}else if("mark"===a){const e=document.querySelector(".season-buttons button"),a=document.querySelector(".similar-titles .media-card");e?e.focus():a&&a.focus()}break;case"ArrowUp":if("mark"===a){const e=document.querySelector(".btn-hero-play");e?.focus()}}};return(a,t)=>(v(),i("div",Ea,[o("div",Pa,[e.logoUrl&&!p.value?(v(),i("img",{key:0,src:e.logoUrl,alt:e.item.Name,class:"hero-logo",onError:k},null,40,_a)):(v(),i("h1",Ta,m(e.item.Name),1)),o("div",La,[b.value?(v(),i("button",{key:1,class:"btn-hero-play",onClick:t[2]||(t[2]=a=>d("browse",e.item)),onKeydown:t[3]||(t[3]=e=>x(e,"play")),onFocus:w},[...t[9]||(t[9]=[o("i",{class:"fas fa-folder-open"},null,-1),P(" Browse Collection ",-1)])],32)):(v(),i("button",{key:0,class:"btn-hero-play",tabindex:"0",onClick:t[0]||(t[0]=a=>d("play",e.item)),onKeydown:t[1]||(t[1]=e=>x(e,"play")),onFocus:w},[...t[8]||(t[8]=[o("i",{class:"fas fa-play"},null,-1),P(" Play Now ",-1)])],32)),o("button",{class:"btn-hero-secondary",tabindex:"0",onClick:t[4]||(t[4]=e=>d("back")),onKeydown:t[5]||(t[5]=e=>x(e,"back")),onFocus:w},[...t[10]||(t[10]=[o("i",{class:"fas fa-info-circle"},null,-1),P(" More Information ",-1)])],32)]),o("div",Ma,[e.item.ProductionYear?(v(),i("span",Ua,m(e.item.ProductionYear),1)):c("",!0),e.item.OfficialRating?(v(),i("span",Da,m(e.item.OfficialRating),1)):c("",!0),e.item.RunTimeTicks?(v(),i("span",Na,m(I(g)(e.item.RunTimeTicks)),1)):c("",!0),e.item.CommunityRating?(v(),i("span",Aa,[t[11]||(t[11]=o("i",{class:"fas fa-star"},null,-1)),P(" "+m(I(y)(e.item.CommunityRating)),1)])):c("",!0)]),e.item.Genres&&e.item.Genres.length?(v(),i("div",Ra,[(v(!0),i(n,null,r(e.item.Genres.slice(0,3),(a,t)=>(v(),i("span",{key:a},[P(m(a),1),t<Math.min(e.item.Genres.length,3)-1?(v(),i("span",Fa," • ")):c("",!0)]))),128))])):c("",!0),e.item.Overview?(v(),i("p",Va,m(e.item.Overview),1)):c("",!0),o("div",$a,[b.value?c("",!0):(v(),i("button",{key:0,class:"btn-hero-secondary",tabindex:"0",onClick:t[6]||(t[6]=a=>h.value?d("markAsUnwatched",e.item):d("removeFromContinueWatching",e.item)),onKeydown:t[7]||(t[7]=e=>x(e,"mark")),onFocus:w,title:h.value?"Mark as Unwatched":"Mark as Watched"},[P(m(h.value?"Mark as Unwatched":"Mark as Watched")+" ",1),o("i",{class:s(h.value?"fas fa-times":"fas fa-check")},null,2)],40,Ka))])])]))}}),[["__scopeId","data-v-d2ca501c"]]),Ba={class:"player-container"},Ga={key:0,class:"player-overlay"},Wa={class:"error-message"},Ha={key:1,class:"skip-intro-container","data-nav-zone":"skip-controls"},za=["aria-label"],Oa={key:2,class:"media-sidebar","data-nav-zone":"media-sidebar"},ja={class:"media-card-player"},Ya={class:"media-poster"},Qa=["src","alt"],Xa={class:"media-info"},Ja={key:0,class:"show-logo-container"},Za=["src","alt"],et={key:1,class:"show-title"},at={class:"show-genres"},tt={key:0},lt={class:"show-description"},it={class:"up-next-section"},st={class:"up-next-list"},ot={class:"up-next-thumbnail"},nt=["src","alt"],rt={class:"up-next-details"},ct={class:"up-next-episode"},ut={class:"top-bar"},dt={class:"top-bar-info"},vt={class:"episode-label"},mt={class:"episode-title"},pt={class:"top-bar-actions"},gt={class:"volume-menu-container"},ft={key:0,class:"context-menu volume-menu"},yt={class:"volume-slider-container"},bt=["value"],ht={class:"volume-percentage"},kt={class:"bottom-controls"},wt={class:"control-buttons-row"},St={class:"subtitle-menu-container"},It={key:0,class:"context-menu subtitle-menu"},xt={key:0,class:"fas fa-check"},Ct=["onClick","onKeydown"],Et={key:0,class:"fas fa-check"},Pt={class:"quality-menu-container"},_t={key:0,class:"context-menu quality-menu"},Tt=["onClick","onKeydown"],Lt={key:0,class:"fas fa-check"},Mt=["aria-label"],Ut={class:"progress-bar-track"},Dt={class:"time-display"},Nt={class:"time-current"},At={class:"time-remaining"},Rt={class:"timezone-time"},Ft={class:"playback-buttons","data-nav-zone":"player-controls"},Vt=["aria-label","title"],$t=["aria-label"],Kt=["aria-label","title"],qt=se(e({__name:"VideoPlayer",props:{item:{},streamUrl:{}},emits:["close","progress","playbackStart","playbackStop","switchEpisode"],setup(e,{emit:u}){const d=e,f=U(),y=R(),b=u,h=a(null),k=S(()=>d.streamUrl),w=a(0),x=a(0),C=S(()=>0===x.value?0:w.value/x.value*100),E=a(!0);let _=null;const T=a(!1),L=a(1),M=a(!1),D=a(!1),N=a(!1),A=a([]),V=a([]),$=a(null),K=a("Auto"),q=a(null),B=a(!1),G=a(null),W=a(!1),H=a("Skip Intro");let z=null;const O=a(null),j=a(null),Y=S(()=>"Episode"===d.item.Type&&d.item.SeriesId),Q=e=>e/1e7,X=e=>Math.floor(1e7*e),{isPlaying:J,errorMessage:Z,handlePlayPause:ee,handleStop:ae,handleSeek:te}=F(h,k,{onProgress:(e,a)=>{b("progress",e,a)},onPlaybackStart:()=>{b("playbackStart")},onPlaybackStop:e=>{b("playbackStop",e)}}),le=()=>{h.value&&(w.value=h.value.currentTime,x.value=h.value.duration||0,ie())},ie=()=>{if(!h.value)return B.value=!1,void(W.value=!1);const e=X(w.value);if(q.value){const{IntroStart:a,IntroEnd:t}=q.value;if(e>=a&&e<=t)return B.value=!0,W.value=!1,void(H.value="Skip Intro")}if(G.value){const{CreditsStart:a,CreditsEnd:t}=G.value;if(e>=a&&e<=t)return B.value=!1,W.value=!0,void(H.value="Skip Credits")}B.value=!1,W.value=!1},se=()=>{if(h.value){if(B.value&&q.value){const e=Q(q.value.IntroEnd);h.value.currentTime=e,B.value=!1,console.log("[VideoPlayer] Skipped intro to",e)}else if(W.value&&G.value){if(Y.value&&O.value)return console.log("[VideoPlayer] Skipping credits and going to next episode:",O.value.Name),void ne();const e=Q(G.value.CreditsEnd);h.value.currentTime=e,W.value=!1,console.log("[VideoPlayer] Skipped credits to",e)}ge()}},oe=()=>{j.value&&(console.log("[VideoPlayer] Navigating to previous episode:",j.value.Name),b("switchEpisode",j.value.Id))},ne=()=>{O.value&&(console.log("[VideoPlayer] Navigating to next episode:",O.value.Name),b("switchEpisode",O.value.Id))},re=e=>{if(!isFinite(e))return"0:00";const a=Math.floor(e/3600),t=Math.floor(e%3600/60),l=Math.floor(e%60);return a>0?`${a}:${t.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${t}:${l.toString().padStart(2,"0")}`},ce=e=>{if(!e)return"";const a=e.ImageTags?.Primary||e.SeriesPrimaryImageTag,t=e.ImageTags?.Primary?e.Id:e.SeriesId||e.Id;return a&&f.serverUrl.value?`${f.serverUrl.value}/emby/Items/${t}/Images/Primary?tag=${a}&maxWidth=400`:""},ue=a(!1),de=e=>e&&f.serverUrl.value?ue.value?"":e.SeriesId?f.getImageUrl(e.SeriesId,"Logo",500):f.getImageUrl(e.Id,"Logo",500):"",ve=()=>{console.log("[VideoPlayer] Logo not available, showing title instead"),ue.value=!0},me=()=>{if(!h.value)return"";const e=new Date,a=new Date(e),t=new Date(e.getTime()+1e3*(x.value-w.value)),l=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;return`${l(a)} - ${l(t)}`},pe=e=>{if(!h.value)return;const a=e.currentTarget.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*x.value;h.value.currentTime=t,ge()},ge=()=>{E.value=!0,null!==_&&clearTimeout(_),_=window.setTimeout(()=>{E.value=!1},3e3)},fe=()=>{ge()},ye=e=>{const a=e.target;a.closest(".subtitle-menu-container")||a.closest(".quality-menu-container")||a.closest(".volume-menu-container")||(D.value=!1,N.value=!1,M.value=!1)},be=()=>{ae(),b("close")},he=async()=>{const e=document.querySelector(".player-container");if(e){try{document.fullscreenElement?(await document.exitFullscreen(),T.value=!1):(await e.requestFullscreen(),T.value=!0)}catch(a){console.error("[VideoPlayer] Fullscreen error:",a)}ge()}},ke=()=>{T.value=!!document.fullscreenElement},we=e=>{const a=e.target,t=parseFloat(a.value);L.value=t,h.value&&(h.value.volume=t),ge()},Se=()=>{M.value=!M.value,M.value&&(D.value=!1,N.value=!1),ge()},Ie=()=>{D.value=!D.value,D.value&&(N.value=!1,M.value=!1),ge()},xe=()=>{N.value=!N.value,N.value&&(D.value=!1,M.value=!1),ge()},Ce=e=>{if($.value=e,!h.value)return;const a=h.value.textTracks;for(let t=0;t<a.length;t++)a[t].mode="disabled";null!==e&&a[e]&&(a[e].mode="showing"),D.value=!1,ge(),console.log("[VideoPlayer] Subtitle selected:",null===e?"Off":A.value[e]?.DisplayTitle)},Ee=e=>{K.value=e,N.value=!1,ge(),console.log("[VideoPlayer] Quality selected:",e)},Pe=()=>{le(),setTimeout(()=>{console.log("[VideoPlayer] Starting credits detection after delay"),(async()=>{try{if(!h.value||!h.value.duration)return void console.log("[VideoPlayer] Video not ready for credits detection");const e=h.value.duration;if(d.streamUrl.includes("BigBuckBunny")||d.streamUrl.includes("commondatastorage")){const a=Math.max(0,e-30),t=e;return G.value={CreditsStart:X(a),CreditsEnd:X(t),confidence:1,detectionMethod:"manual"},void console.log("[VideoPlayer] Demo mode: Using simulated credits markers:",{start:a,end:t,duration:e})}const a=await y.getCreditsMarker(d.item.Id,d.item.SeriesId,null);if(a)return G.value=a,void console.log("[VideoPlayer] Credits markers loaded from cache:",{start:Q(a.CreditsStart),end:Q(a.CreditsEnd),confidence:a.confidence,method:a.detectionMethod});console.log("[VideoPlayer] Starting passive credits detection"),z=y.detectCreditsPassively(h.value,e=>{G.value=e,console.log("[VideoPlayer] Credits detected and saved:",{start:Q(e.CreditsStart),end:Q(e.CreditsEnd),confidence:e.confidence}),d.item.SeriesId&&y.saveCreditsToStorage(d.item.SeriesId,d.item.Id,e),z&&(z(),z=null)})}catch(e){console.error("[VideoPlayer] Failed to fetch credits markers:",e)}})()},5e3)};return t(()=>{h.value&&(h.value.addEventListener("timeupdate",le),h.value.addEventListener("loadedmetadata",Pe),h.value.volume=L.value),document.addEventListener("mousemove",fe),document.addEventListener("focusin",fe),document.addEventListener("click",ye),document.addEventListener("fullscreenchange",ke),ge(),(async()=>{try{const e=await f.getIntroSkipMarkers(d.item.Id);q.value=e,e&&console.log("[VideoPlayer] Intro markers loaded:",{start:Q(e.IntroStart),end:Q(e.IntroEnd)})}catch(e){console.error("[VideoPlayer] Failed to fetch intro markers:",e)}})(),(async()=>{if(Y.value)try{const[e,a]=await Promise.all([f.getNextEpisode(d.item),f.getPreviousEpisode(d.item)]);O.value=e,j.value=a,console.log("[VideoPlayer] Adjacent episodes loaded:",{previous:a?.Name||"None",next:e?.Name||"None"})}catch(e){console.error("[VideoPlayer] Failed to fetch adjacent episodes:",e)}})(),(async()=>{try{const e=await f.getMediaSources(d.item.Id);if(e.length>0){const a=e[0];if(a.MediaStreams){A.value=a.MediaStreams.filter(e=>"Subtitle"===e.Type);const e=A.value.findIndex(e=>e.IsDefault);-1!==e&&($.value=e),console.log("[VideoPlayer] Available subtitles:",A.value);const t=a.MediaStreams.filter(e=>"Video"===e.Type);if(t.length>0){const e=t[0],a=[{label:"Auto",bitrate:14e7}];e.Height&&(e.Height>=2160?(a.push({label:"4K",bitrate:12e7,height:2160}),a.push({label:"1080p",bitrate:4e7,height:1080}),a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):e.Height>=1080?(a.push({label:"1080p",bitrate:4e7,height:1080}),a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):e.Height>=720?(a.push({label:"720p",bitrate:1e7,height:720}),a.push({label:"480p",bitrate:3e6,height:480})):a.push({label:"480p",bitrate:3e6,height:480})),V.value=a,console.log("[VideoPlayer] Available qualities:",V.value)}}}}catch(e){console.error("[VideoPlayer] Failed to fetch media info:",e)}})(),setTimeout(()=>{const e=document.querySelector(".control-btn-large");e&&e.focus()},100)}),l(()=>{h.value&&(h.value.removeEventListener("timeupdate",le),h.value.removeEventListener("loadedmetadata",Pe)),document.removeEventListener("mousemove",fe),document.removeEventListener("focusin",fe),document.removeEventListener("click",ye),document.removeEventListener("fullscreenchange",ke),null!==_&&clearTimeout(_),z&&(z(),z=null)}),(a,t)=>(v(),i("div",Ba,[o("video",{ref_key:"videoElement",ref:h,class:"video-player",crossorigin:"anonymous"}," Your browser does not support the video tag. ",512),o("div",{class:s(["controls-gradient-backdrop",{"controls-hidden":!E.value}])},null,2),I(Z)?(v(),i("div",Ga,[o("div",Wa," ⚠️ "+m(I(Z)),1)])):c("",!0),B.value||W.value?(v(),i("div",Ha,[o("button",{type:"button",onClick:se,onKeydown:p(se,["enter"]),tabindex:"0",class:"skip-intro-btn player-control-btn","aria-label":H.value},[t[8]||(t[8]=o("i",{class:"fas fa-forward"},null,-1)),P(" "+m(H.value),1)],40,za)])):c("",!0),I(J)?c("",!0):(v(),i("div",Oa,[o("div",ja,[o("div",Ya,[o("img",{src:ce(e.item),alt:e.item.Name},null,8,Qa)]),o("div",Xa,[de(e.item)&&!ue.value?(v(),i("div",Ja,[o("img",{src:de(e.item),alt:e.item.SeriesName||e.item.Name,class:"show-logo",onError:ve},null,40,Za)])):(v(),i("h2",et,m(e.item.SeriesName||e.item.Name),1)),o("div",at,[e.item.Genres&&e.item.Genres.length?(v(),i("span",tt,m(e.item.Genres.join(" • ")),1)):c("",!0)]),o("p",lt,m(e.item.Overview||"No description available."),1)]),o("div",it,[t[12]||(t[12]=o("h3",{class:"up-next-title"},"UP NEXT",-1)),o("div",st,[(v(),i(n,null,r(2,a=>o("div",{key:a,class:"up-next-item"},[o("div",ot,[o("img",{src:ce(e.item),alt:`Episode ${a+6}`},null,8,nt)]),o("div",rt,[t[9]||(t[9]=o("span",{class:"up-next-duration"},"20:18 - 20:48",-1)),o("span",ct,"Episode "+m(a+6),1),t[10]||(t[10]=o("h4",{class:"up-next-episode-title"},"Episode Title Goes Here",-1)),t[11]||(t[11]=o("button",{class:"add-watchlist-btn","aria-label":"Add to watchlist"},[o("i",{class:"fas fa-plus"}),P(" Add to watchlist ")],-1))])])),64))])])])])),o("div",{class:s(["player-controls",{"controls-hidden":!E.value}])},[o("div",ut,[o("button",{type:"button",onClick:be,class:"back-btn player-control-btn","aria-label":"Back"},[...t[13]||(t[13]=[o("i",{class:"fas fa-arrow-left"},null,-1)])]),o("div",dt,[o("span",vt,m(e.item.SeriesName)+" Season "+m(e.item.ParentIndexNumber)+" Episode "+m(e.item.IndexNumber),1),o("h2",mt,m(e.item.Name),1)]),o("div",pt,[o("div",gt,[o("button",{type:"button",onClick:Se,onKeydown:p(Se,["enter"]),tabindex:"0",class:"icon-btn player-control-btn","aria-label":"Volume"},[o("i",{class:s(0===L.value?"fas fa-volume-mute":L.value<.5?"fas fa-volume-down":"fas fa-volume-up")},null,2)],32),M.value?(v(),i("div",ft,[t[16]||(t[16]=o("div",{class:"menu-header"},"Volume",-1)),o("div",yt,[t[14]||(t[14]=o("i",{class:"fas fa-volume-up volume-icon-small"},null,-1)),o("input",{type:"range",min:"0",max:"1",step:"0.01",value:L.value,onInput:we,class:"volume-slider-vertical","aria-label":"Volume slider"},null,40,bt),t[15]||(t[15]=o("i",{class:"fas fa-volume-down volume-icon-small"},null,-1))]),o("div",ht,m(Math.round(100*L.value))+"%",1)])):c("",!0)]),t[17]||(t[17]=o("button",{type:"button",class:"icon-btn player-control-btn","aria-label":"Cast"},[o("i",{class:"fas fa-cast"})],-1))])]),o("div",kt,[o("div",wt,[o("div",St,[o("button",{type:"button",onClick:Ie,onKeydown:p(Ie,["enter"]),tabindex:"0",class:s(["icon-btn player-control-btn",{active:null!==$.value}]),"aria-label":"Subtitles"},[...t[18]||(t[18]=[o("i",{class:"fas fa-closed-captioning"},null,-1)])],34),D.value?(v(),i("div",It,[t[20]||(t[20]=o("div",{class:"menu-header"},"Subtitles",-1)),o("button",{type:"button",onClick:t[0]||(t[0]=e=>Ce(null)),onKeydown:t[1]||(t[1]=p(e=>Ce(null),["enter"])),class:s(["menu-item",{active:null===$.value}])},[null===$.value?(v(),i("i",xt)):c("",!0),t[19]||(t[19]=o("span",null,"Off",-1))],34),(v(!0),i(n,null,r(A.value,(e,a)=>(v(),i("button",{key:a,type:"button",onClick:e=>Ce(a),onKeydown:p(e=>Ce(a),["enter"]),class:s(["menu-item",{active:$.value===a}])},[$.value===a?(v(),i("i",Et)):c("",!0),o("span",null,m(e.DisplayTitle||e.Language||`Track ${a+1}`),1)],42,Ct))),128))])):c("",!0)]),o("div",Pt,[o("button",{type:"button",onClick:xe,onKeydown:p(xe,["enter"]),tabindex:"0",class:"icon-btn player-control-btn","aria-label":"Quality"},[...t[21]||(t[21]=[o("i",{class:"fas fa-cog"},null,-1)])],32),N.value?(v(),i("div",_t,[t[22]||(t[22]=o("div",{class:"menu-header"},"Quality",-1)),(v(!0),i(n,null,r(V.value,e=>(v(),i("button",{key:e.label,type:"button",onClick:a=>Ee(e.label),onKeydown:p(a=>Ee(e.label),["enter"]),class:s(["menu-item",{active:K.value===e.label}])},[K.value===e.label?(v(),i("i",Lt)):c("",!0),o("span",null,m(e.label),1)],42,Tt))),128))])):c("",!0)]),o("button",{type:"button",onClick:he,onKeydown:p(he,["enter"]),tabindex:"0",class:"icon-btn player-control-btn","aria-label":T.value?"Exit fullscreen":"Enter fullscreen"},[o("i",{class:s(T.value?"fas fa-compress":"fas fa-expand")},null,2)],40,Mt)]),o("div",{class:"progress-bar-container",onClick:pe},[o("div",Ut,[o("div",{class:"progress-bar-fill",style:g({width:C.value+"%"})},null,4)])]),o("div",Dt,[o("span",Nt,m(re(w.value)),1),o("span",At,m(re(x.value)),1)]),o("div",Rt,m(me()),1),o("div",Ft,[Y.value&&j.value?(v(),i("button",{key:0,type:"button",onClick:oe,onKeydown:p(oe,["enter"]),tabindex:"0",class:"control-btn player-control-btn","aria-label":`Previous episode: ${j.value.Name}`,title:`Previous: ${j.value.Name}`},[...t[23]||(t[23]=[o("i",{class:"fas fa-step-backward"},null,-1)])],40,Vt)):c("",!0),o("button",{type:"button",onClick:t[2]||(t[2]=e=>I(te)(-10)),onKeydown:t[3]||(t[3]=p(e=>I(te)(-10),["enter"])),tabindex:"0",class:"control-btn player-control-btn","aria-label":"Rewind 10 seconds"},[...t[24]||(t[24]=[o("i",{class:"fas fa-backward"},null,-1)])],32),o("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>I(ee)&&I(ee)(...e)),onKeydown:t[5]||(t[5]=p((...e)=>I(ee)&&I(ee)(...e),["enter"])),tabindex:"0",class:"control-btn control-btn-large player-control-btn","aria-label":I(J)?"Pause":"Play"},[o("i",{class:s(I(J)?"fas fa-pause":"fas fa-play")},null,2)],40,$t),o("button",{type:"button",onClick:t[6]||(t[6]=e=>I(te)(10)),onKeydown:t[7]||(t[7]=p(e=>I(te)(10),["enter"])),tabindex:"0",class:"control-btn player-control-btn","aria-label":"Forward 10 seconds"},[...t[25]||(t[25]=[o("i",{class:"fas fa-forward"},null,-1)])],32),Y.value&&O.value?(v(),i("button",{key:1,type:"button",onClick:ne,onKeydown:p(ne,["enter"]),tabindex:"0",class:"control-btn player-control-btn","aria-label":`Next episode: ${O.value.Name}`,title:`Next: ${O.value.Name}`},[...t[26]||(t[26]=[o("i",{class:"fas fa-step-forward"},null,-1)])],40,Kt)):c("",!0)])])],2)]))}}),[["__scopeId","data-v-c10318ef"]]);export{K as C,fa as G,Oe as H,he as L,va as M,wa as T,qt as V,se as _,Ca as a,qa as b,ra as c,Le as d};

import{d as e,k as a,r as i,l as o,m as l,o as r,c as s,A as t,f as n,p as d,C as u,b as v,i as c,t as m,u as g,g as y}from"./vue-vendor.B0WUDMXT.js";import{H as b,G as h,M as I,T as w,C as p,_ as T}from"./components.BQNxwHwS.js";import{u as L,l as f,m as M,n as H,c as C,a as D,o as N,p as k,q as P,r as S,s as q,t as G,v as _,b as x,w as E}from"./composables.CNmb4RHD.js";const F={id:"content-container"},V={key:1,class:"hero-skeleton"},A={key:3,class:"trending-section"},B={class:"trending-movies-section"},U={class:"trending-tv-section"},R={key:0,class:"because-you-watched-section"},j={class:"ml-0 mb-3.75 text-7"},O={key:1,class:"daily-movies-section"},W={class:"ml-0 mb-3.75 text-7"},Y={key:2,class:"daily-tv-section"},J={class:"ml-0 mb-3.75 text-7"},K=T(e({__name:"HomePage",setup(e){const T=g(),K=o(),z=D(),Q=x(),X=L(),Z=E(),$=f(),ee=M(),ae=H(),ie=C(Q,X,z.isDemoMode),oe=N(Q,X,$,ee,z.isDemoMode,true),le=k($,Q,ae,z.isDemoMode),re=P(),se=S(),te=_();q("Home");const ne=a(()=>le.trendingMovies.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),de=a(()=>le.trendingTvShows.value.map(e=>({genre_ids:e.tmdbData.genre_ids||[]}))),ue=G($,ne),ve=G($,de),ce=i([]),me=i(!1),ge=i(""),ye=async()=>{$.isConfigured&&await Promise.all([ue.loadGenres("movie"),ve.loadGenres("tv")])},be=ue.availableGenres,he=ve.availableGenres,Ie=async()=>{await le.loadTrendingContent({onShow:()=>window.dispatchEvent(new Event("show-splash")),onHide:()=>window.dispatchEvent(new Event("hide-splash"))})},we=async()=>{await re.loadDailyContent(Q,z.isDemoMode.value)},pe=async()=>{z.isDemoMode.value||await se.loadBecauseYouWatched(Q)},Te=a(()=>le.filterMoviesByGenres(ue.selectedGenres.value)),Le=a(()=>le.filterTvShowsByGenres(ve.selectedGenres.value)),fe=e=>{if("Id"in e&&"Name"in e&&!("tmdbData"in e))return ie.getImageUrl(e.Id,"Primary",p.MEDIA_CARD_DEFAULT);const a="tmdbData"in e?e.tmdbData:e;return $.getPosterUrl(a.poster_path,"w500")},Me=async e=>{if("Id"in e&&"Name"in e)return void De(e);const a="title"in e?e.title:e.name;console.log("[HomePage] TMDB item clicked:",a);const i=[...le.trendingMovies.value,...le.trendingTvShows.value,...re.dailyMovies.value,...re.dailyTvShows.value].find(a=>a.tmdbData.id===e.id);if(!i)return void console.error("[HomePage] Could not find merged item for TMDB item");const o={};oe.currentLibrary.value&&(o.sourceLibraryId=oe.currentLibrary.value.Id,o.sourceLibraryName=oe.currentLibrary.value.Name||"",oe.currentLibrary.value.CollectionType&&(o.sourceLibraryType=oe.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",o,{itemId:i.embyId}),T.push({name:"Details",params:{itemId:i.embyId},query:o})},He=async e=>{if(await oe.loadFeaturedItems(e,le.trendingMovies.value,le.trendingTvShows.value),oe.featuredItems.value.length>0){const e=oe.featuredItems.value[0];ge.value=await ke(e.Id),ie.preloadImage(ge.value)}},Ce=async()=>{Z.pushToHistory("Home");const e=await oe.loadLibraries();ce.value=e,z.isDemoMode.value||await He(e)},De=e=>{if(e.CollectionType||"CollectionFolder"===e.Type)(async e=>{console.log("[HomePage] loadLibraryItems called with:",e);const a={view:e.CollectionType||e.Type||"",libraryId:e.Id,libraryName:e.Name||""};Z.pushToHistory("Home",a),T.push({name:"Home",query:a});const i=await oe.loadLibraryItems(e);ce.value=i})(e);else if("BoxSet"===e.Type)Ne(e);else{const a={};oe.currentLibrary.value&&(a.sourceLibraryId=oe.currentLibrary.value.Id,a.sourceLibraryName=oe.currentLibrary.value.Name||"",oe.currentLibrary.value.CollectionType&&(a.sourceLibraryType=oe.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",a,{itemId:e.Id}),T.push({name:"Details",params:{itemId:e.Id},query:a})}},Ne=async e=>{oe.currentLibrary.value=e,oe.currentView.value="items";const a={view:"collection",libraryId:e.Id,libraryName:e.Name||""};if(Z.pushToHistory("Home",a),T.push({name:"Home",query:a}),z.isDemoMode.value)ce.value=X.getCollectionItems(e.Id);else try{ce.value=await Q.getCollectionItems(e.Id)}catch(i){console.error("Failed to load collection items:",i)}},ke=async e=>await ie.getHeroImageUrl(e,oe.featuredItems.value),Pe=a(()=>"libraries"===oe.currentView.value&&!K.query.view),Se=async e=>{console.log("[HomePage] Hero item clicked:",e.Name),"Series"===e.Type?qe(e):T.push({name:"Player",params:{itemId:e.Id}})},qe=e=>{console.log("[HomePage] Hero navigate clicked:",e.Name);const a={};oe.currentLibrary.value&&(a.sourceLibraryId=oe.currentLibrary.value.Id,a.sourceLibraryName=oe.currentLibrary.value.Name||"",oe.currentLibrary.value.CollectionType&&(a.sourceLibraryType=oe.currentLibrary.value.CollectionType)),Z.pushToHistory("Details",a,{itemId:e.Id}),T.push({name:"Details",params:{itemId:e.Id},query:a})},Ge=e=>{console.log("Added to favorites:",e.Name)},_e=()=>{!le.isLoadingMoreMovies.value&&le.hasMoreMovies.value&&(console.log("[HomePage] Near end of trending movies - preloading next page"),le.loadMoreMovies())},xe=()=>{!le.isLoadingMoreTv.value&&le.hasMoreTv.value&&(console.log("[HomePage] Near end of trending TV shows - preloading next page"),le.loadMoreTvShows())},Ee=()=>{!re.isLoadingMoreMovies.value&&re.hasMoreMovies.value&&(console.log("[HomePage] Near end of daily movies - preloading next page"),re.loadMoreMovies(Q,z.isDemoMode.value))},Fe=()=>{!re.isLoadingMoreTv.value&&re.hasMoreTv.value&&(console.log("[HomePage] Near end of daily TV shows - preloading next page"),re.loadMoreTvShows(Q,z.isDemoMode.value))};te.registerSidebarNavigation(async e=>"Home"!==K.name?(console.log("[HomePage] Not on Home route, ignoring sidebar navigation"),!1):("home"===e&&await Ce(),!0));const Ve=async()=>{const e=K.query.view,a=K.query.libraryId,i=K.query.libraryName;if(e&&a){if(console.log("[HomePage] Restoring view from query:",{view:e,libraryId:a,libraryName:i}),"collection"===e)try{const e=await Q.getItemDetails(a);return oe.currentLibrary.value=e,oe.currentView.value="items",void(z.isDemoMode.value?ce.value=X.getCollectionItems(e.Id):ce.value=await Q.getCollectionItems(e.Id))}catch(o){return console.error("[HomePage] Failed to restore collection view:",o),void Ce()}const l=oe.allLibraries.value.find(e=>e.Id===a);if(l)if(oe.currentLibrary.value=l,oe.currentView.value="items",z.isDemoMode.value)ce.value=X.getLibraryItems(l.Id);else try{let e=null;"movies"===l.CollectionType?e="Movie":"tvshows"===l.CollectionType?e="Series":"collections"===l.CollectionType&&(e="BoxSet");const a=await Q.getItems(l.Id,e);ce.value=a}catch(o){console.error("[HomePage] Failed to restore library view:",o),ce.value=[]}else if(z.isDemoMode.value){const o={Id:a,Name:i||e,Type:"CollectionFolder",CollectionType:e};oe.currentLibrary.value=o,oe.currentView.value="items",ce.value=X.getLibraryItems(o.Id)}else console.warn("[HomePage] Could not find library with ID:",a),Ce()}else Ce()};l(()=>K.query,async(e,a)=>{JSON.stringify(e)!==JSON.stringify(a)&&(console.log("[HomePage] Route query changed, restoring view:",e),e.view&&e.libraryId?await Ve():0===Object.keys(e).length&&(oe.currentView.value="libraries",oe.currentLibrary.value=null,ce.value=oe.allLibraries.value,await He(oe.allLibraries.value)))}),l(()=>K.name,async(e,a)=>{"Home"===e&&a&&"Home"!==a&&(console.log("[HomePage] Returned to Home from",a),0!==Object.keys(K.query).length&&(K.query.view||K.query.libraryId)||("libraries"!==oe.currentView.value&&(oe.currentView.value="libraries",oe.currentLibrary.value=null,ce.value=oe.allLibraries.value),oe.allLibraries.value.length>0&&(console.log("[HomePage] Reloading featured items after returning from",a),await He(oe.allLibraries.value))))}),l(()=>le.isLoadingTrending.value,async(e,a)=>{a&&!e&&0===oe.featuredItems.value.length&&(le.trendingMovies.value.length>0||le.trendingTvShows.value.length>0)&&(console.log("[HomePage] Trending loaded, updating featured items for hero slider"),await He(oe.allLibraries.value))});const Ae=async e=>{console.log("Api Key Set"),$.setApiKey(e),me.value=!1,window.location.reload()},Be=()=>{me.value=!1};return r(async()=>{$.isConfigured||(me.value=!0),await Ce(),await Promise.all([ye(),Ie()]),setTimeout(async()=>{await Promise.all([we(),pe()])},100),await Ve(),console.log("Mounted!")}),(e,a)=>(y(),s("div",F,[me.value?(y(),t(w,{key:0,onSubmit:Ae,onClose:Be})):n("",!0),Pe.value&&d(oe).isLoadingFeatured.value?(y(),s("div",V,[...a[3]||(a[3]=[u('<div class="hero-skeleton-content" data-v-9a53a2f0><div class="skeleton-title" data-v-9a53a2f0></div><div class="skeleton-meta" data-v-9a53a2f0></div><div class="skeleton-description" data-v-9a53a2f0></div><div class="skeleton-buttons" data-v-9a53a2f0><div class="skeleton-button" data-v-9a53a2f0></div><div class="skeleton-button" data-v-9a53a2f0></div></div></div>',1)])])):n("",!0),Pe.value&&!d(oe).isLoadingFeatured.value&&d(oe).featuredItems.value.length>0?(y(),t(b,{key:2,items:d(oe).featuredItems.value,"get-image-url":ke,"slider-id":"Hero",onPlay:Se,onFavorite:Ge,onNavigate:qe},null,8,["items"])):n("",!0),Pe.value&&d($).isConfigured?(y(),s("div",A,[v("div",B,[a[4]||(a[4]=v("h3",{class:"ml-0 mb-3.75 text-7"},"Trending Movies",-1)),d(be).length>0?(y(),t(h,{key:0,genres:d(be),"selected-genres":d(ue).selectedGenres.value,"onUpdate:selectedGenres":a[0]||(a[0]=e=>d(ue).selectedGenres.value=e)},null,8,["genres","selected-genres"])):n("",!0),d(le).trendingMovies.value.length>0||d(le).isLoadingTrending.value?(y(),t(I,{key:1,items:Te.value,loading:d(le).isLoadingTrending.value,"get-image-url":fe,onItemClick:Me,onNearEnd:_e},null,8,["items","loading"])):n("",!0)]),v("div",U,[a[5]||(a[5]=v("h3",{class:"ml-0 mb-3.75 text-7"},"Trending TV Shows",-1)),d(he).length>0?(y(),t(h,{key:0,genres:d(he),"selected-genres":d(ve).selectedGenres.value,"onUpdate:selectedGenres":a[1]||(a[1]=e=>d(ve).selectedGenres.value=e)},null,8,["genres","selected-genres"])):n("",!0),d(le).trendingTvShows.value.length>0||d(le).isLoadingTrending.value?(y(),t(I,{key:1,items:Le.value,loading:d(le).isLoadingTrending.value,"get-image-url":fe,onItemClick:Me,onNearEnd:xe},null,8,["items","loading"])):n("",!0)]),d(se).hasRecommendations.value?(y(),s("div",R,[v("h3",j," Because you watched: "+m(d(se).becauseYouWatchedItem.value?.referenceItem.name),1),c(I,{items:d(se).becauseYouWatchedItem.value?.recommendations||[],"get-image-url":e=>{return a=e.Id,ie.getImageUrl(a,"Primary",p.MEDIA_CARD_DEFAULT);var a},onItemClick:a[2]||(a[2]=e=>De(e))},null,8,["items","get-image-url"])])):n("",!0),d(re).dailyMovies.value.length>0?(y(),s("div",O,[v("h3",W,m(d(re).movieThemeTitle),1),c(I,{items:d(re).dailyMovies.value,loading:d(re).isLoading.value,"get-image-url":fe,onItemClick:Me,onNearEnd:Ee},null,8,["items","loading"])])):n("",!0),d(re).dailyTvShows.value.length>0?(y(),s("div",Y,[v("h3",J,m(d(re).tvThemeTitle),1),c(I,{items:d(re).dailyTvShows.value,loading:d(re).isLoading.value,"get-image-url":fe,onItemClick:Me,onNearEnd:Fe},null,8,["items","loading"])])):n("",!0)])):n("",!0)]))}}),[["__scopeId","data-v-9a53a2f0"]]);export{K as default};
